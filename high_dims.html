<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; High Dimension Data Strategies – Introduction to Machine Learning and AI for Health Sciences</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./clustering.html" rel="next">
<link href="./intro_missing.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.11.0/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./high_dims.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">High Dimension Data Strategies</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Machine Learning and AI for Health Sciences</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction_AI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to AI and Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supervised_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Supervised Learning: Regression tasks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./three_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Supervised Learning: Tree Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./neural_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Neural networks and deep learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introd_bayesian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Bayesian methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_missing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to missing data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./high_dims.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">High Dimension Data Strategies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Clustering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interpretable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Interpretable AI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./genai_foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">GenAI: Foundations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./genai_app.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">GenAI: Applications</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivational-example" id="toc-motivational-example" class="nav-link active" data-scroll-target="#motivational-example"><span class="header-section-number">7.1</span> Motivational example</a></li>
  <li><a href="#what-is-a-dimension" id="toc-what-is-a-dimension" class="nav-link" data-scroll-target="#what-is-a-dimension"><span class="header-section-number">7.2</span> What is a dimension?</a></li>
  <li><a href="#measuring-distances-in-high-dimensional-space" id="toc-measuring-distances-in-high-dimensional-space" class="nav-link" data-scroll-target="#measuring-distances-in-high-dimensional-space"><span class="header-section-number">7.3</span> Measuring Distances in High-Dimensional Space</a>
  <ul class="collapse">
  <li><a href="#euclidean-distance-between-two-points-in-two-dimensions" id="toc-euclidean-distance-between-two-points-in-two-dimensions" class="nav-link" data-scroll-target="#euclidean-distance-between-two-points-in-two-dimensions"><span class="header-section-number">7.3.1</span> Euclidean Distance Between Two Points in Two Dimensions</a></li>
  <li><a href="#euclidean-distance-in-three-dimensions" id="toc-euclidean-distance-in-three-dimensions" class="nav-link" data-scroll-target="#euclidean-distance-in-three-dimensions"><span class="header-section-number">7.3.2</span> Euclidean Distance in Three Dimensions</a></li>
  <li><a href="#euclidean-distance-in-p-dimensions" id="toc-euclidean-distance-in-p-dimensions" class="nav-link" data-scroll-target="#euclidean-distance-in-p-dimensions"><span class="header-section-number">7.3.3</span> Euclidean Distance in <span class="math inline">\(p\)</span> Dimensions</a></li>
  <li><a href="#beyond-euclidean-distance-alternative-metrics-for-high-dimensional-data" id="toc-beyond-euclidean-distance-alternative-metrics-for-high-dimensional-data" class="nav-link" data-scroll-target="#beyond-euclidean-distance-alternative-metrics-for-high-dimensional-data"><span class="header-section-number">7.3.4</span> Beyond Euclidean Distance: Alternative Metrics for High-Dimensional Data</a></li>
  <li><a href="#distances-in-a-nutshell" id="toc-distances-in-a-nutshell" class="nav-link" data-scroll-target="#distances-in-a-nutshell"><span class="header-section-number">7.3.5</span> Distances in a nutshell!</a></li>
  </ul></li>
  <li><a href="#techniques-for-visualizing-multiple-dimensions-in-a-single-graphic" id="toc-techniques-for-visualizing-multiple-dimensions-in-a-single-graphic" class="nav-link" data-scroll-target="#techniques-for-visualizing-multiple-dimensions-in-a-single-graphic"><span class="header-section-number">7.4</span> Techniques for Visualizing Multiple Dimensions in a Single Graphic</a>
  <ul class="collapse">
  <li><a href="#lattice-graphics-for-multivariate-data" id="toc-lattice-graphics-for-multivariate-data" class="nav-link" data-scroll-target="#lattice-graphics-for-multivariate-data"><span class="header-section-number">7.4.1</span> Lattice graphics for multivariate data</a></li>
  </ul></li>
  <li><a href="#the-curse-of-dimensionality" id="toc-the-curse-of-dimensionality" class="nav-link" data-scroll-target="#the-curse-of-dimensionality"><span class="header-section-number">7.5</span> The curse of dimensionality</a>
  <ul class="collapse">
  <li><a href="#collinearity" id="toc-collinearity" class="nav-link" data-scroll-target="#collinearity"><span class="header-section-number">7.5.1</span> Collinearity</a></li>
  </ul></li>
  <li><a href="#collinearity-and-redundancy-in-high-dimensions" id="toc-collinearity-and-redundancy-in-high-dimensions" class="nav-link" data-scroll-target="#collinearity-and-redundancy-in-high-dimensions"><span class="header-section-number">7.6</span> Collinearity and Redundancy in High Dimensions</a></li>
  <li><a href="#principal-component-analysis" id="toc-principal-component-analysis" class="nav-link" data-scroll-target="#principal-component-analysis"><span class="header-section-number">7.7</span> Principal Component Analysis</a>
  <ul class="collapse">
  <li><a href="#building-your-first-pca-model" id="toc-building-your-first-pca-model" class="nav-link" data-scroll-target="#building-your-first-pca-model"><span class="header-section-number">7.7.1</span> Building your first PCA model</a></li>
  <li><a href="#fitting-pca-using-factominer" id="toc-fitting-pca-using-factominer" class="nav-link" data-scroll-target="#fitting-pca-using-factominer"><span class="header-section-number">7.7.2</span> Fitting PCA Using FactoMineR</a></li>
  <li><a href="#scores-and-loadings-what-they-represent-and-how-to-extract-them" id="toc-scores-and-loadings-what-they-represent-and-how-to-extract-them" class="nav-link" data-scroll-target="#scores-and-loadings-what-they-represent-and-how-to-extract-them"><span class="header-section-number">7.7.3</span> Scores and Loadings: What They Represent and How to Extract Them</a></li>
  <li><a href="#identifying-the-most-important-variables-for-each-component" id="toc-identifying-the-most-important-variables-for-each-component" class="nav-link" data-scroll-target="#identifying-the-most-important-variables-for-each-component"><span class="header-section-number">7.7.4</span> Identifying the Most Important Variables for Each Component</a></li>
  <li><a href="#interpreting-positive-and-negative-loadings-within-each-component" id="toc-interpreting-positive-and-negative-loadings-within-each-component" class="nav-link" data-scroll-target="#interpreting-positive-and-negative-loadings-within-each-component"><span class="header-section-number">7.7.5</span> Interpreting Positive and Negative Loadings Within Each Component</a></li>
  <li><a href="#interpretation-unifying-contributions-and-loadings-signals" id="toc-interpretation-unifying-contributions-and-loadings-signals" class="nav-link" data-scroll-target="#interpretation-unifying-contributions-and-loadings-signals"><span class="header-section-number">7.7.6</span> Interpretation Unifying Contributions and Loadings Signals</a></li>
  <li><a href="#geometric-visualisation-through-scores" id="toc-geometric-visualisation-through-scores" class="nav-link" data-scroll-target="#geometric-visualisation-through-scores"><span class="header-section-number">7.7.7</span> Geometric Visualisation Through Scores</a></li>
  <li><a href="#visualising-variable-structure-the-correlation-circle-pc1pc2-focus" id="toc-visualising-variable-structure-the-correlation-circle-pc1pc2-focus" class="nav-link" data-scroll-target="#visualising-variable-structure-the-correlation-circle-pc1pc2-focus"><span class="header-section-number">7.7.8</span> Visualising Variable Structure: The Correlation Circle (PC1–PC2 Focus)</a></li>
  </ul></li>
  <li><a href="#introducing-another-example-of-interest-for-the-next-methods" id="toc-introducing-another-example-of-interest-for-the-next-methods" class="nav-link" data-scroll-target="#introducing-another-example-of-interest-for-the-next-methods"><span class="header-section-number">7.8</span> Introducing another example of interest for the next methods</a></li>
  <li><a href="#t-sne-recovering-local-biological-neighbourhoods-in-the-digital-clinical-trial-dataset" id="toc-t-sne-recovering-local-biological-neighbourhoods-in-the-digital-clinical-trial-dataset" class="nav-link" data-scroll-target="#t-sne-recovering-local-biological-neighbourhoods-in-the-digital-clinical-trial-dataset"><span class="header-section-number">7.9</span> t-SNE: Recovering Local Biological Neighbourhoods in the Digital Clinical Trial Dataset</a></li>
  <li><a href="#implementing-t-sne" id="toc-implementing-t-sne" class="nav-link" data-scroll-target="#implementing-t-sne"><span class="header-section-number">7.10</span> Implementing t-SNE</a>
  <ul class="collapse">
  <li><a href="#interpreting-the-t-sne-embedding" id="toc-interpreting-the-t-sne-embedding" class="nav-link" data-scroll-target="#interpreting-the-t-sne-embedding"><span class="header-section-number">7.10.1</span> Interpreting the t-SNE embedding</a></li>
  <li><a href="#faceted-t-sne-examining-individual-variable-gradients" id="toc-faceted-t-sne-examining-individual-variable-gradients" class="nav-link" data-scroll-target="#faceted-t-sne-examining-individual-variable-gradients"><span class="header-section-number">7.10.2</span> Faceted t-SNE: examining individual variable gradients</a></li>
  </ul></li>
  <li><a href="#uniform-manifold-approximation-and-projection-umap" id="toc-uniform-manifold-approximation-and-projection-umap" class="nav-link" data-scroll-target="#uniform-manifold-approximation-and-projection-umap"><span class="header-section-number">7.11</span> Uniform Manifold Approximation and Projection (UMAP)</a>
  <ul class="collapse">
  <li><a href="#three-hyperparameters-control-how-umap-views-the-data" id="toc-three-hyperparameters-control-how-umap-views-the-data" class="nav-link" data-scroll-target="#three-hyperparameters-control-how-umap-views-the-data"><span class="header-section-number">7.11.1</span> Three hyperparameters control how UMAP views the data:</a></li>
  <li><a href="#implementing-umap" id="toc-implementing-umap" class="nav-link" data-scroll-target="#implementing-umap"><span class="header-section-number">7.11.2</span> Implementing UMAP</a></li>
  <li><a href="#interpreting-the-umap-embedding" id="toc-interpreting-the-umap-embedding" class="nav-link" data-scroll-target="#interpreting-the-umap-embedding"><span class="header-section-number">7.11.3</span> Interpreting the UMAP embedding</a></li>
  <li><a href="#comparing-t-sne-and-umap" id="toc-comparing-t-sne-and-umap" class="nav-link" data-scroll-target="#comparing-t-sne-and-umap"><span class="header-section-number">7.11.4</span> Comparing t-SNE and UMAP</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">High Dimension Data Strategies</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="motivational-example" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="motivational-example"><span class="header-section-number">7.1</span> Motivational example</h2>
<p>To anchor the ideas in this chapter, we begin with a example dataset inspired by advanced therapeutic technologies in dermatology. The clinical setting is moderate-to-severe psoriasis, a chronic inflammatory skin disease characterised by keratinocyte hyperproliferation, immune dysregulation involving the IL-17/IL-23 axis, and substantial patient-to-patient heterogeneity. Psoriasis is particularly well suited for illustrating high-dimensional data challenges because its biology spans multiple layers: immune signalling in the skin, microbial community shifts, and environmental triggers that modulate disease activity.</p>
<p>Imagine a cohort of patients who initiate treatment with an anti–IL-17 biologic. Before therapy begins, an extensive set of measurements is collected. These measurements include gene expression profiles from lesional skin—about fifteen hundred genes capturing inflammatory pathways, barrier function, and cellular differentiation. Each gene defines one axis in the data space, and the genomics block alone positions each patient as a point in a fifteen-hundred-dimensional cloud.</p>
<p>Alongside the genomic layer, the dataset incorporates three hundred features derived from the skin microbiome. These represent aggregated amplicon sequence variants describing the relative abundance of microbial taxa. Psoriasis frequently shows alterations in the cutaneous microbiota, with some patients displaying a more dysbiotic pattern and others retaining a commensal-dominant profile. These microbial dimensions interact with, but do not mirror, the genomic axes, increasing the complexity of the data geometry.</p>
<p>To capture external influences, the dataset includes environmental exposure variables such as NO₂, PM₁₀, ultraviolet index, local temperature, and humidity. Psoriasis severity and treatment response often fluctuate with environmental and seasonal factors, and this exposome block provides a complementary source of structured variability.</p>
<p>Clinical and biochemical markers provide additional anchors to the dataset: baseline PASI scores, dermatology-specific quality-of-life indices, and a panel of cytokines reflecting local immune activation. These lower-dimensional features help ground the high-dimensional layers in clinically interpretable signals.</p>
<p>The outcome of interest is the change in PASI after twelve weeks of therapy. This continuous measurement captures individual response to treatment and allows us to relate the high-dimensional predictors to a meaningful clinical endpoint.</p>
<p>This dataset is intentionally heterogeneous and high dimensional, placing each patient in a space with nearly two thousand axes. As we move to the next section, this geometric perspective motivates the need to reduce dimensionality: high-dimensional spaces behave counterintuitively, distances become unstable, and noisy or redundant variables obscure meaningful structure. The challenges of this dataset naturally set the stage for understanding the curse of dimensionality and why dimensionality reduction becomes essential.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a> df<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/att_ai_ml/data/Dermato_ATT_simulated.rds"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">str</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   200 obs. of  1852 variables:
 $ patient_id    : chr  "P1" "P2" "P3" "P4" ...
 $ Outcome_PASI12: num  19.06 1.93 2.54 13.49 3.31 ...
 $ PASI_baseline : num  9.35 13.65 13.96 9.95 13.15 ...
 $ DLQI          : num  12.67 9.22 11.74 11.92 7.66 ...
 $ cytokine_1    : num  -2.613 0.222 3.56 -3.648 0.474 ...
 $ cytokine_2    : num  -2.06625 -0.21861 0.7805 -4.52195 -0.00698 ...
 $ cytokine_3    : num  -1.8888 0.411 -0.0255 -4.3303 0.577 ...
 $ cytokine_4    : num  -0.76 -0.981 2.755 -4.133 1.466 ...
 $ cytokine_5    : num  -3.402 -0.271 2.994 -5.152 1.477 ...
 $ cytokine_6    : num  -2.2422 1.4799 3.2168 -4.2629 0.0581 ...
 $ cytokine_7    : num  -3.288 -0.406 1.064 -5.879 0.327 ...
 $ cytokine_8    : num  -3.4514 -0.0117 0.4019 -5.0254 1.1754 ...
 $ cytokine_9    : num  -3.7626 0.6743 3.7283 -4.362 0.0832 ...
 $ cytokine_10   : num  -4.49 1.13 2.95 -5.21 1.48 ...
 $ cytokine_11   : num  -1.252 0.136 2.162 -5.204 0.858 ...
 $ cytokine_12   : num  -4.231 -0.257 0.443 -3.814 1.864 ...
 $ cytokine_13   : num  -3.105 1.83 1.159 -5.5 0.268 ...
 $ cytokine_14   : num  -1.96 -0.397 1.813 -3.58 1.262 ...
 $ cytokine_15   : num  -3.68 1.45 1.82 -2.84 1.41 ...
 $ cytokine_16   : num  -3.118 0.824 1.923 -5.446 0.753 ...
 $ cytokine_17   : num  -3.43 0.855 2.541 -3.279 1.203 ...
 $ cytokine_18   : num  -2.33 2.14 3.27 -4.5 2.86 ...
 $ NO2           : num  22.3 34.5 14.2 25.9 31.1 ...
 $ PM10          : num  12.67 13.81 15.17 20.88 9.57 ...
 $ UV_index      : num  4.52 4.37 3.64 3.69 5.63 ...
 $ temperature   : num  9.16 19.23 10.56 18.58 19.86 ...
 $ humidity      : num  69.6 73.3 71.4 54.3 63.6 ...
 $ expo_6        : num  2.49638 0.10679 -0.45004 0.00785 1.68004 ...
 $ expo_7        : num  0.813 -0.246 -0.349 0.906 -0.607 ...
 $ expo_8        : num  0.835 -1.528 -1.241 0.842 -1.4 ...
 $ expo_9        : num  -0.85287 -0.99771 -0.00603 -0.81976 -0.10098 ...
 $ expo_10       : num  2.528 0.203 -1.108 -1.319 2.991 ...
 $ expo_11       : num  -0.737 0.221 1.033 -0.13 -0.458 ...
 $ expo_12       : num  0.0812 0.1011 -0.4487 -1.9899 -0.521 ...
 $ expo_13       : num  -2.296 -0.276 0.482 0.876 -1.178 ...
 $ expo_14       : num  0.253 -1.479 1.033 0.626 1.153 ...
 $ expo_15       : num  1.114 -0.328 1.022 0.942 0.852 ...
 $ expo_16       : num  -1.356 0.689 -1.275 1.394 1.236 ...
 $ expo_17       : num  0.6997 -0.4043 -0.5038 -0.0914 -0.6555 ...
 $ expo_18       : num  0.033 0.349 0.122 0.211 0.72 ...
 $ expo_19       : num  1.202 -2.756 1.041 -0.625 1.678 ...
 $ expo_20       : num  0.9554 -0.8974 1.352 0.0425 0.6997 ...
 $ expo_21       : num  -1.885 0.458 -1.782 -0.546 2.11 ...
 $ expo_22       : num  -1.567 -1.076 -0.805 1.129 1.501 ...
 $ expo_23       : num  0.17 -0.795 -0.794 0.371 0.354 ...
 $ expo_24       : num  0.18 -1.847 1.091 -0.926 -2.242 ...
 $ expo_25       : num  1.3289 -0.0789 -1.9444 0.5659 1.8 ...
 $ expo_26       : num  0.6275 1.2035 -1.8594 -0.3295 -0.0342 ...
 $ expo_27       : num  2.188 1.451 -0.158 1.091 0.433 ...
 $ expo_28       : num  0.00325 0.08153 0.84316 -0.30213 -0.54475 ...
 $ expo_29       : num  0.221 -0.427 0.344 -0.138 0.655 ...
 $ expo_30       : num  2.447 -0.511 -0.776 -0.364 1.47 ...
 $ gene_1        : num  -0.0341 0.7265 0.8737 0.1497 1.2999 ...
 $ gene_2        : num  -1.071 0.043 0.355 -1.318 -0.136 ...
 $ gene_3        : num  -0.917 1.98 0.223 -1.293 0.719 ...
 $ gene_4        : num  -0.786 0.202 0.59 0.205 0.782 ...
 $ gene_5        : num  -1.009 0.231 1.44 -2.541 0.41 ...
 $ gene_6        : num  -0.0519 0.5597 1.9868 -1.2325 0.1317 ...
 $ gene_7        : num  -0.665 1.257 1.516 -2.056 1.147 ...
 $ gene_8        : num  0.128 0.634 0.259 0.241 0.656 ...
 $ gene_9        : num  -0.894 0.681 0.278 -1.199 0.133 ...
 $ gene_10       : num  -0.0476 0.6626 0.5964 -2.159 0.8182 ...
 $ gene_11       : num  -0.3866 0.9519 -0.0379 -0.5661 0.865 ...
 $ gene_12       : num  -0.865 0.471 0.534 -0.229 0.277 ...
 $ gene_13       : num  -0.6372 -0.0453 1.2612 -1.0254 0.4567 ...
 $ gene_14       : num  0.1027 0.5721 -0.0718 -0.0231 0.2311 ...
 $ gene_15       : num  -0.0256 1.1792 1.6511 -0.7759 0.1092 ...
 $ gene_16       : num  -0.116 1.194 0.995 -0.597 0.338 ...
 $ gene_17       : num  -1.264 0.512 0.732 -2.302 0.066 ...
 $ gene_18       : num  -1.053 0.29 0.941 -1.262 0.693 ...
 $ gene_19       : num  -0.715 0.667 0.641 -1.18 1.13 ...
 $ gene_20       : num  -0.7627 0.8478 1.4797 -1.4841 -0.0193 ...
 $ gene_21       : num  -0.107 0.451 0.922 -0.495 1.177 ...
 $ gene_22       : num  2.06e-01 9.17e-01 1.19 -1.87 -2.23e-05 ...
 $ gene_23       : num  -0.186 -0.133 0.952 -1.064 0.518 ...
 $ gene_24       : num  -0.666 0.552 0.474 -0.989 0.692 ...
 $ gene_25       : num  -0.381 0.912 1.676 -1.537 0.697 ...
 $ gene_26       : num  -0.809 -0.371 1.211 -1.426 0.191 ...
 $ gene_27       : num  -0.766 0.722 1.698 -1.528 0.298 ...
 $ gene_28       : num  -0.471 2.368 0.258 -1.767 1.252 ...
 $ gene_29       : num  0.144 0.746 0.424 -0.963 -0.231 ...
 $ gene_30       : num  -0.0554 0.7709 1.1042 -1.023 0.9466 ...
 $ gene_31       : num  -0.000831 1.001845 0.503228 -0.629817 0.835488 ...
 $ gene_32       : num  0.564 0.462 0.309 -0.199 0.362 ...
 $ gene_33       : num  -0.325 -0.407 0.135 -1.704 -0.095 ...
 $ gene_34       : num  -1.356 0.78 0.94 -0.907 1.105 ...
 $ gene_35       : num  -0.571 0.283 1.748 -0.917 -0.276 ...
 $ gene_36       : num  -1.185 0.704 2.394 -2.08 1.937 ...
 $ gene_37       : num  -0.66 1.08 1.01 -2.39 1.01 ...
 $ gene_38       : num  -0.1021 -0.0143 0.6307 -1.8735 0.2224 ...
 $ gene_39       : num  -1.129 1.435 0.609 -1.087 0.567 ...
 $ gene_40       : num  -0.971 0.543 1.691 -1.642 0.549 ...
 $ gene_41       : num  -0.474 -0.174 1.028 -1.187 0.502 ...
 $ gene_42       : num  -0.946 0.707 0.853 -1.725 -0.135 ...
 $ gene_43       : num  -0.55 0.282 0.41 -0.991 0.853 ...
 $ gene_44       : num  -0.0674 0.2369 0.5463 -0.831 0.6119 ...
 $ gene_45       : num  -0.234 0.114 1.184 -0.39 0.13 ...
 $ gene_46       : num  -0.659 0.289 1.178 -1.236 0.267 ...
 $ gene_47       : num  0.642 1.545 1.061 -1.265 0.455 ...
  [list output truncated]</code></pre>
</div>
</div>
</section>
<section id="what-is-a-dimension" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="what-is-a-dimension"><span class="header-section-number">7.2</span> What is a dimension?</h2>
<p>In short a dimension is each of the features present in a dataset. In other words the dimension of a dataset is identical to the number of variables (or columns) it contains.</p>
<p>When working with multivariate datasets, it is often helpful to visualize how observations occupy space when only a handful of dimensions are considered. Although we cannot directly visualize the genomic, microbial, and exposome components of the psoriasis dataset—which together span nearly two thousand axes—we <em>can</em> project selected pairs or triplets of variables into two- or three-dimensional plots. These visualizations help reinforce the geometric interpretation of dimensions introduced above.</p>
<p>In low dimensions, distance, neighbourhood structure, and separation between patients behave intuitively. As more variables are added, this intuition quickly breaks down. Before we explore why this happens, the examples below illustrate how a dataset “looks” when restricted to two and three axes. These small visual slices help anchor the abstract notion of dimensions in concrete graphics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'plotly'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    last_plot</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> PASI_baseline,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> NO2,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> Outcome_PASI12)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Patients represented in two dimensions"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Baseline PASI"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"NO₂ exposure"</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">"ΔPASI 12 weeks"</span>) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This 2D view shows how each variable defines one axis in the space.<br>
</p>
<p>In reality, the dataset contains thousands of such axes simultaneously—something impossible to visualize directly, but essential for understanding the geometry of high-dimensional data.</p>
<p>With three variables, each patient can be seen as a point in a three-dimensional cloud.<br>
</p>
<p>The example below uses <strong>PASI_baseline</strong>, <strong>NO₂</strong>, and a single gene (gene_1).<br>
</p>
<p>In an HTML Quarto book, this produces an <strong>interactive 3D plot</strong> that the student can rotate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  df,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>PASI_baseline,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="sc">~</span>NO2,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="sc">~</span>gene_1,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="sc">~</span>Outcome_PASI12,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">colorscale =</span> <span class="st">"Viridis"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"scatter3d"</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">opacity =</span> <span class="fl">0.7</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Patients represented in three dimensions"</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Baseline PASI"</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"NO₂"</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"gene_1"</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 'scatter3d' objects don't have these attributes: 'colorscale'
Valid attributes include:
'connectgaps', 'customdata', 'customdatasrc', 'error_x', 'error_y', 'error_z', 'hoverinfo', 'hoverinfosrc', 'hoverlabel', 'hovertemplate', 'hovertemplatesrc', 'hovertext', 'hovertextsrc', 'ids', 'idssrc', 'legendgroup', 'legendgrouptitle', 'legendrank', 'line', 'marker', 'meta', 'metasrc', 'mode', 'name', 'opacity', 'projection', 'scene', 'showlegend', 'stream', 'surfaceaxis', 'surfacecolor', 'text', 'textfont', 'textposition', 'textpositionsrc', 'textsrc', 'texttemplate', 'texttemplatesrc', 'transforms', 'type', 'uid', 'uirevision', 'visible', 'x', 'xcalendar', 'xhoverformat', 'xsrc', 'y', 'ycalendar', 'yhoverformat', 'ysrc', 'z', 'zcalendar', 'zhoverformat', 'zsrc', 'key', 'set', 'frame', 'transforms', '_isNestedKey', '_isSimpleKey', '_isGraticule', '_bbox'</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-615cc9fb0ce60fb32e0d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-615cc9fb0ce60fb32e0d">{"x":{"visdat":{"af651da95494":["function () ","plotlyVisDat"]},"cur_data":"af651da95494","attrs":{"af651da95494":{"x":{},"y":{},"z":{},"colorscale":"Viridis","mode":"markers","marker":{"size":3,"opacity":0.69999999999999996},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Patients represented in three dimensions","scene":{"xaxis":{"title":"Baseline PASI"},"yaxis":{"title":"NO₂"},"zaxis":{"title":"gene_1"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[9.3537773278056431,13.64908670626132,13.962244937838717,9.9531272201890584,13.149241782910094,12.780617600381168,5.5135211623214309,13.049920355181937,14.26514450297714,15.662332560306508,8.1970399939516447,12.414161902988628,9.7583636684690127,12.967728369660092,11.59582295992484,16.661135346255449,11.091333259993748,12.363525192226836,12.160958774478207,11.663877281301987,9.9377650746069985,5.2964142532927836,10.098046151137583,14.921462111706239,16.545537632730564,12.807748166971141,8.8244463108789137,6.9272995485268476,4.7537613888797114,11.660837375907443,17.996687910465042,10.234540219477257,9.1358316283010872,12.738088108951583,11.3014402289564,17.33065728444689,12.232019781557044,10.752134963612052,10.461585638842422,11.818899415892021,16.936907491800955,11.21516385985859,10.009318487284673,8.9461390937340184,10.724546519089619,10.903355865596563,13.950923347887972,12.213003864802332,12.27752499693786,9.2762056928726366,9.9899554855509738,13.409597927202022,9.3543432622249227,9.4865550700976211,14.771939339031558,12.094461337895067,7.2852549919710743,7.45482390844988,15.810512610804572,10.248469591904527,13.334662136674872,13.109042731397958,14.231870557292375,10.084170086815607,13.308850339503225,13.204173351009906,10.858547703034032,16.397573845909395,13.685798263492369,15.169699484730051,12.031000491339844,6.8349168136652718,14.861366927620216,9.3166513842128573,12.83862172746724,12.564840462012816,7.8934205670058262,8.5164325023089855,7.8178097551491508,10.657910032498219,9.323703064211486,8.6440530859324589,8.091103926801356,9.8750446205626563,10.609814737059523,10.656914067874615,6.6711430246695951,19.519684510035919,11.603960073496738,7.9769779609694513,10.439793835595321,13.169821703680574,6.8980729339919984,8.7846522324274829,8.2570712723197666,9.2937368735418264,16.467979168122781,12.38459124824106,13.963521494480105,18.398766309235061,10.025907197681466,16.100014688329427,15.081070525895504,11.631554579130098,15.203961241632932,11.441396005933875,15.642622519507439,8.5165797248093984,14.073162960413224,8.5291331365210858,16.133030867757036,17.898981614957599,12.708718787673282,10.725454581884167,15.276148439694039,13.817784388348491,15.437835090467679,11.479412184547144,9.3477429858848122,6.5319427952584919,8.0368591458560061,16.567876313301849,13.384770073536354,14.976746889649563,11.743000885049426,9.0272384545253459,14.592583909664816,17.555952722783594,11.276744395180108,9.9423751878587971,10.611077487542691,14.181600430615813,17.247671530211971,13.360872354360904,8.7630654259014875,17.577672403561557,10.034264964855737,14.699223178958382,13.017615706420161,8.3202920771262914,13.346294272947935,12.028363572586507,7.0743305445462763,13.093769405912605,5.7760495136094736,11.947115310964044,9.2458648402499541,7.5948727657530171,15.413115199161577,12.874201589992717,11.9724243796504,9.3819974710754259,9.3508112290092757,9.7997937723180026,18.28767783865003,11.17475376269738,10.948264985980103,11.517573354002693,12.424760757938149,13.598670298930447,9.4164177371239468,6.1676089951420856,9.4468919411924706,11.650705314971031,7.4082322187077523,12.719964112172656,18.118721250336851,8.912665414532098,12.153875529274037,10.985082250156861,11.407051672645061,12.777531590870161,12.020446569990225,18.734433069305698,16.792862253561946,7.9877821761407644,12.213725424294982,6.2363261047544949,9.4819222477185559,12.317722827341461,13.373933663172927,11.290630076262872,16.612244292495582,10.788260063911823,8.6320253639850417,5.2487867621920783,9.462099639041055,11.604873728884417,15.627253814442682,14.282059585727499,16.417367310348009,9.7345729759393613,8.9182504492494346,13.79607687241298,10.218667094909833,6.6762443750308975,16.982830938053663,6.1986742460239954,10.203512286395354,13.525029966330868],"y":[22.296073505324035,34.454833617495531,14.180390876804948,25.890678428037756,31.065196407227901,21.407730024444703,11.592428914360895,24.994179659810385,34.079808801289019,32.738041302914347,26.008996758579102,30.605499706641165,31.779988391226098,21.017278718203226,16.715235866349996,14.243684187797164,45.701939903626752,34.711256970969181,28.118246963295196,25.343150273664744,11.497509888700662,24.423222684934341,39.772042876810914,32.714883705188569,16.932118340711217,25.382275824796945,26.149491190011336,29.27458748027194,16.671786198231946,21.478920483117502,10.442941461994875,16.921344507697572,8.9779149408867625,11.164086677508751,29.649572404866475,32.292320184391627,27.691883504842039,25.16605665132326,17.42450152419292,29.17338974121585,22.42228372917722,26.888196401134358,31.03660669033561,25.372493496905491,34.194287617027591,24.951707241754782,15.772850874264678,19.510738267395492,28.329825524686608,16.654180859035794,20.193231171968591,31.851692281362219,24.899472007857941,11.724170576448801,13.255590379981928,20.709859994904406,27.161163514660075,26.768760030293461,18.483881798940224,29.745905066091787,30.500608843477206,14.419716948313861,45.339734676661351,25.342262924101565,21.582493656700251,20.415782644621732,18.001442701176334,20.468898663751816,20.322730779491959,28.712212893747353,27.858629644847767,11.259805562249948,23.622467072286046,24.470339139043777,16.361863905634994,26.433566674275951,16.656197068275564,34.239613110177125,25.915944588842986,38.519712085620768,25.393110228936138,21.197602446040744,17.248792429290088,17.005574205017545,25.207475931006822,34.406585973438851,11.659057310449656,29.920027628788354,26.653129861466947,15.394051997129587,12.755644234360565,26.814343874309465,22.552033653518599,28.758211713317834,30.654488458626513,42.462389775165775,30.227907962760227,33.669570545542634,21.964842474420312,18.311736381660324,19.855336446404731,15.945092713240747,29.126747023767237,27.116585595835275,24.487638314851647,24.90319778407429,32.781312651903953,13.944159213704097,32.979731309897062,18.731354226596025,18.469509953701991,22.536073543686616,17.333849077434387,14.524224826807748,24.203079446787541,24.874332399100375,13.080332440011311,35.737253503878748,39.688181277911923,34.628457383029172,24.41870878063844,22.520059024834907,40.197948454088277,16.002865936364927,19.926124692871824,24.475143046750702,17.021331606731394,22.618103649197749,26.117689136369922,19.793993469556447,35.286092373678528,22.144379284506421,33.647638207621085,13.015090438575307,21.485852263596165,14.6731141535363,22.995533460225381,19.640403022080108,12.467855538186994,23.948095942449502,33.990714301834302,27.424158341543276,19.886635326889095,31.253274211537217,11.752211728878894,27.480010781776002,13.2802337162701,18.982040017233267,31.284280842293711,29.965106456238438,23.0939818098724,33.636619157424775,25.116264033261505,20.677562178679509,41.213539618319516,29.218251979308281,22.796442717268455,35.211547741912689,22.188700913605011,13.341737183779507,32.292098006827182,15.962318205925861,28.767520959203644,34.447786119047834,16.484001443574712,17.401290230518544,21.772785533979537,42.077396120948706,23.74771466640583,12.820540759852321,19.716687299398338,19.462293121177204,18.777004016510794,35.233503700896442,10.330119848415009,6.1273282769045174,16.125851513718484,11.999570832521918,29.291543899605365,22.804768715553745,37.533630560696665,32.490365746658874,48.336764644824513,24.691277879138621,19.899368313184944,29.625068709113933,31.104036233323427,29.112393505744794,34.644004888510537,33.419534386917974,32.892578609231919,34.180479903265933,25.719721833549052,25.977069182657445,30.194313481416497,24.038334334342416,34.19542572493247,26.572806091565308,39.416446687385431,27.173172779552026],"z":[-0.034129181289494701,0.72654080440814095,0.87373536590073275,0.14965354470834025,1.2999181770350976,1.1693284838674773,1.063436186570476,1.0016729409319183,-0.24598332813844084,-1.7784071139271034,-0.52242949721905863,-0.40151606263294221,1.4105880921797778,-1.4574098615225237,-0.30749291042935012,0.20507961927114132,-0.86596054775712683,-1.2587001715738748,-0.71710049057029845,1.7161883782495937,0.85545752955222509,0.67971519337252073,0.74466799371839532,2.3551956149649853,0.86447796693624879,-1.0493678788552245,2.2572840713316866,0.5524582098552655,-1.8224409698010602,0.45984230506951318,0.67098549355369108,-1.1376896096513394,-0.8269292975342204,-0.1644907753227933,-0.35862179848452974,-1.6367053306545443,-3.8446020590000725,-0.31537602846166413,-0.49655580463191662,-1.1837364188874555,1.5337611097890322,-1.1161507014915715,-1.1753175126934119,0.55053827748510042,0.38985769962751637,0.37937786667893808,0.75701084451199196,0.031971690698944566,-0.47481914151996052,0.1372289087198435,-0.45665714249817435,1.0576911795836241,0.29903381934211143,-0.026291123062781169,-1.7593319063360648,-0.67489090829546539,1.6984390237587361,-1.3661059181922877,0.594825368891714,-0.10076889147510096,1.7921265379366336,0.59851533978892923,0.46355402553683345,-2.0335433638683726,0.12794935925109394,-0.043234188711322508,-0.71274168030515039,-0.72027344169279583,1.4898534393629701,0.75643539804053839,0.046396634687799032,2.2813959314750574,0.70788404827390339,0.39266533348942856,2.1964417718862546,-0.86062593247193719,0.55617835010554795,0.42429542798309638,-0.036598920257105441,0.37392021431321454,-0.99366136070806321,0.36692643841985229,-1.3812744038592473,1.2233514889491515,-0.40432917630968501,0.77574313971175346,-0.28581944689390332,-0.24873078206285196,-1.3739114485998654,-0.95153428035515231,2.0249997703183329,0.54338444919339124,-1.4708992023279195,0.69632399314810511,1.1891823038627491,2.5704097394379994,-1.121902775290283,-0.082068050227911166,0.79860438717053117,0.86486513988953018,-1.3089418948384288,-1.5364501457220627,-0.10626169034303795,0.5283827970224011,0.012340985781507163,-0.68278240066038431,-1.4467165281242811,1.1401363845276216,-1.4434324792094555,1.1167389802531535,1.5236650602233124,0.23694877342981085,-0.8341150005812149,0.54736002489690405,-0.76339904750264176,0.84690805158684523,-0.67632314252744297,1.2613313846798055,0.016212995570376615,-0.26768036982480403,-0.5437081558876099,-1.1126070498003438,1.1045323156913713,-1.7190989572425155,0.27943915868847868,-0.62547589164045581,0.031611766302663491,-1.382986973463268,0.37471876693687667,0.16683583960861731,-0.04683551659178542,1.3097850190575304,-1.214783643883107,1.8626061794779647,-1.0532331468774416,-1.7396344198764397,-0.68196895179583339,0.63723611242391764,0.10996440791239578,-1.3739349908834035,-0.25083700227367728,1.0175322802154168,-0.057603910175155093,0.21751589571880048,-0.50555840198348267,1.6667924666707992,-0.085084794535293357,-2.1494925367818674,0.52453222789067877,-0.87790075914181087,-1.2380787319869715,0.43778319406103583,-0.71033886586576356,-1.0579542399674735,-1.5576864029111421,1.400662415465979,1.5270154445430608,-1.7349844338557221,-1.0425655367948825,1.9642662153804618,0.416569575236034,1.7950566060821462,-0.27733767265355636,-0.96380617513106892,0.21250966829769247,1.6674021933230778,0.33924500174551853,1.1199934724271681,-0.1163575529812302,2.6297691561118284,-1.0524542679751663,-1.3839578237572776,-0.011829521448656163,-0.1417172686774415,-0.4416149684354293,0.29410181932777274,-1.1253572738857271,0.55666586111077432,0.71150433524304746,0.078081434994226873,-3.0191506650469799,-1.9607110116511977,0.71072740785804611,1.4113199840371637,0.60551808204618418,1.9856177739914869,1.9513191586714729,-0.23612170585175976,-1.0490371747864975,0.39523831854667124,1.0912366308245027,-4.7769911450696467,-1.1874112543052937,1.6632173611281327,0.72024425571693085,0.49936489924357347,0.32694101647259832,-0.64767496674821334,-0.26570558049769705,-0.47248068368740048],"colorscale":"Viridis","mode":"markers","marker":{"colorbar":{"title":"Outcome_PASI12","ticklen":2},"cmin":-10.519319347160483,"cmax":20.828785893840262,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333334","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[19.060965047967837,1.9322333123932298,2.535440293259394,13.489481832714381,3.3132007058704991,12.555004107526866,19.93704112728669,8.5715468240360817,6.6119648475098272,3.4893929614953691,6.7956845882084771,0.35307244060307852,2.6694313557813265,6.5346169000591701,7.6303336365611756,10.724667536452539,-4.2529277403231971,7.5292811406864306,8.4813919458187161,0.49196740600431821,15.977543090159015,7.4747876946564364,2.1743308480989647,2.0306471301550406,9.7750350804508273,15.017731619144691,5.4558313578222331,11.870165152168171,10.826271783315599,11.109662369861343,13.077491672292274,10.36071722600192,20.368166236232867,10.117953891540699,9.0862394173856451,8.2148993850005105,9.73295598062683,8.1074772989456676,7.6016391875208491,-2.6376325722869716,9.2981759216424233,6.7513526430576203,6.4764036214154199,14.506933238819851,6.1631417585288304,10.939016617844054,11.211278676135377,7.3559761161767305,10.465953657323144,12.17556971666877,13.049422974470172,8.2638145636266351,13.977901866173536,17.146722815942493,14.956937242303376,9.191542525513178,5.6315537791859969,8.6543813878176614,11.501485104483079,13.54687800465928,1.1217298438797227,11.233489526650413,-3.1926423963990551,10.658289846731437,4.8485667075168726,3.5435663792313008,18.243802549025038,5.5704811613516068,5.5107413770176858,2.5372112017231703,5.1274320164353542,13.260436801405802,16.422529522648524,6.9582592665725578,10.309408848748095,7.543553855482843,15.573160963640829,15.283139398124341,0.42654959691673966,2.7512187238871495,1.0214064043828692,9.5837241038068264,17.23419115125742,16.522927184770786,4.60342827173102,-1.1119721809367191,10.928174835577078,-3.5860825049484433,3.0662193664967567,11.49321081352802,17.387140214545923,2.7291380621226278,9.1476776272802987,-1.0849612050420123,2.5499567005985666,-2.7112946650216125,10.29376839389499,-3.8140623806690237,7.6700445248737958,9.6108849181583587,12.965433098104,13.408279607252679,-1.7119535403068582,8.0347212511918542,2.2514297311497167,6.7436670295838832,4.615704528730511,11.989685862955739,1.5465494442802719,11.898531776519476,7.1709060142852925,16.31933344530357,15.142457209493612,6.4585452658710958,1.3562711493984843,4.4372567064488653,17.735755275907458,-2.9657953712511231,-0.99017766387730521,0.073146349585449411,12.725646763231374,14.968137761486609,-10.519319347160483,17.112581002925122,6.0843932676400154,10.178091091655004,17.185992255107212,8.8948302177276251,-0.59349838732635618,9.2883508699917154,1.6547791066096698,11.881978284051126,5.3634636008398253,9.2926966671175393,13.776403262154588,18.161798957970515,14.31076602237353,9.4478947063131482,6.6367692670103224,7.8027208598556026,2.9623181203642366,3.7688629594880236,13.131868522921195,7.6705322653526613,13.19175427377275,1.9629342200472353,13.19658854637574,8.9252238925068017,2.3727056596719756,1.0027004962562209,13.677059021499137,0.32918362163498749,6.0464315033285132,10.751538429954632,-1.5523251701301797,1.6165829901123177,6.4802810354352172,0.057611405553776418,5.002412884561501,11.028848011917582,-0.066077119568233478,11.958839205063263,13.49013163970179,4.6716112672096752,10.040503645527982,11.034045095749994,7.4751838119436043,-1.5640390495300291,9.5955826732665344,12.494259544788614,12.246699612623566,5.9202300255044031,16.969506776826652,3.0081679463769131,14.3145827207876,20.828785893840262,12.917012232923351,11.235733694967696,1.5244157217594223,13.96394095186632,2.207492928653672,3.4713526236297021,-4.9687724522298709,9.8061996830841398,7.8613860100606185,-0.93579613165761,8.3818659180123731,-1.8547467747392163,3.6705834934812862,4.9101973361284399,3.1549823579772842,11.568692190025489,3.406108667527258,7.8505512602210539,2.7365925844538683,7.7520210478429012,1.6322920232875193,3.0213514934247092,-2.7160293800769901,14.892777511280133],"size":3,"opacity":0.69999999999999996,"line":{"colorbar":{"title":"","ticklen":2},"cmin":-10.519319347160483,"cmax":20.828785893840262,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333334","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[19.060965047967837,1.9322333123932298,2.535440293259394,13.489481832714381,3.3132007058704991,12.555004107526866,19.93704112728669,8.5715468240360817,6.6119648475098272,3.4893929614953691,6.7956845882084771,0.35307244060307852,2.6694313557813265,6.5346169000591701,7.6303336365611756,10.724667536452539,-4.2529277403231971,7.5292811406864306,8.4813919458187161,0.49196740600431821,15.977543090159015,7.4747876946564364,2.1743308480989647,2.0306471301550406,9.7750350804508273,15.017731619144691,5.4558313578222331,11.870165152168171,10.826271783315599,11.109662369861343,13.077491672292274,10.36071722600192,20.368166236232867,10.117953891540699,9.0862394173856451,8.2148993850005105,9.73295598062683,8.1074772989456676,7.6016391875208491,-2.6376325722869716,9.2981759216424233,6.7513526430576203,6.4764036214154199,14.506933238819851,6.1631417585288304,10.939016617844054,11.211278676135377,7.3559761161767305,10.465953657323144,12.17556971666877,13.049422974470172,8.2638145636266351,13.977901866173536,17.146722815942493,14.956937242303376,9.191542525513178,5.6315537791859969,8.6543813878176614,11.501485104483079,13.54687800465928,1.1217298438797227,11.233489526650413,-3.1926423963990551,10.658289846731437,4.8485667075168726,3.5435663792313008,18.243802549025038,5.5704811613516068,5.5107413770176858,2.5372112017231703,5.1274320164353542,13.260436801405802,16.422529522648524,6.9582592665725578,10.309408848748095,7.543553855482843,15.573160963640829,15.283139398124341,0.42654959691673966,2.7512187238871495,1.0214064043828692,9.5837241038068264,17.23419115125742,16.522927184770786,4.60342827173102,-1.1119721809367191,10.928174835577078,-3.5860825049484433,3.0662193664967567,11.49321081352802,17.387140214545923,2.7291380621226278,9.1476776272802987,-1.0849612050420123,2.5499567005985666,-2.7112946650216125,10.29376839389499,-3.8140623806690237,7.6700445248737958,9.6108849181583587,12.965433098104,13.408279607252679,-1.7119535403068582,8.0347212511918542,2.2514297311497167,6.7436670295838832,4.615704528730511,11.989685862955739,1.5465494442802719,11.898531776519476,7.1709060142852925,16.31933344530357,15.142457209493612,6.4585452658710958,1.3562711493984843,4.4372567064488653,17.735755275907458,-2.9657953712511231,-0.99017766387730521,0.073146349585449411,12.725646763231374,14.968137761486609,-10.519319347160483,17.112581002925122,6.0843932676400154,10.178091091655004,17.185992255107212,8.8948302177276251,-0.59349838732635618,9.2883508699917154,1.6547791066096698,11.881978284051126,5.3634636008398253,9.2926966671175393,13.776403262154588,18.161798957970515,14.31076602237353,9.4478947063131482,6.6367692670103224,7.8027208598556026,2.9623181203642366,3.7688629594880236,13.131868522921195,7.6705322653526613,13.19175427377275,1.9629342200472353,13.19658854637574,8.9252238925068017,2.3727056596719756,1.0027004962562209,13.677059021499137,0.32918362163498749,6.0464315033285132,10.751538429954632,-1.5523251701301797,1.6165829901123177,6.4802810354352172,0.057611405553776418,5.002412884561501,11.028848011917582,-0.066077119568233478,11.958839205063263,13.49013163970179,4.6716112672096752,10.040503645527982,11.034045095749994,7.4751838119436043,-1.5640390495300291,9.5955826732665344,12.494259544788614,12.246699612623566,5.9202300255044031,16.969506776826652,3.0081679463769131,14.3145827207876,20.828785893840262,12.917012232923351,11.235733694967696,1.5244157217594223,13.96394095186632,2.207492928653672,3.4713526236297021,-4.9687724522298709,9.8061996830841398,7.8613860100606185,-0.93579613165761,8.3818659180123731,-1.8547467747392163,3.6705834934812862,4.9101973361284399,3.1549823579772842,11.568692190025489,3.406108667527258,7.8505512602210539,2.7365925844538683,7.7520210478429012,1.6322920232875193,3.0213514934247092,-2.7160293800769901,14.892777511280133]}},"type":"scatter3d","frame":null},{"x":[4.7537613888797114,19.519684510035919],"y":[6.1273282769045174,48.336764644824513],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"Outcome_PASI12","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":-10.519319347160483,"cmax":20.828785893840262,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333334","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[-10.519319347160483,20.828785893840262],"line":{"color":"rgba(255,127,14,1)"}},"z":[-4.7769911450696467,2.6297691561118284],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The two introductory plots provide a first glimpse of how patients in our simulated psoriasis cohort distribute themselves when represented in only a handful of variables. These figures are intentionally simple: they show what happens when we restrict attention to two or three axes of variation and attempt to visualize clinical and environmental information directly.</p>
<p>In the two-dimensional plot, each patient is positioned according to baseline PASI and NO₂ exposure, with the treatment response (ΔPASI after twelve weeks) encoded through colour. Although the scatter suggests a broad spread along both axes, no obvious groupings emerge. Patients with similar clinical outcomes are dispersed throughout the space, and improvement or worsening does not align cleanly with either baseline severity or pollution levels. This lack of visible structure is not surprising. Disease burden, environmental exposures, and treatment response arise from highly multivariate processes, and a projection onto only two variables often hides most of the relevant variation.</p>
<p>The three-dimensional representation adds gene expression into the picture by using one inflammatory gene as an additional axis. Even with this extra dimension, the overall shape remains a diffuse cloud rather than a set of compact, separable groups. The colouring by ΔPASI again shows subtle gradients but no clear partitioning. A single molecular feature, even when combined with clinical and environmental measures, carries only a small fraction of the information available in the full dataset. When thousands of genomic and microbiome variables coexist with dozens of environmental and clinical covariates, any low-dimensional projection will necessarily obscure important structure.</p>
<p>These two figures serve as a useful reminder of the limits of direct visualization. Human intuition is well suited to perceiving structure in two or three dimensions, but modern datasets routinely occupy spaces with hundreds or thousands of variables. Within such spaces, distances behave differently, densities fall, collinearity increases, and meaningful patterns often reside in directions that are not aligned with any single observed variable. The diffuse appearance of both plots illustrates these issues clearly: even though the dataset contains strong simulated relationships, they are not apparent when viewed through only two or three coordinates.</p>
<p>For this reason, dimension-reduction methods become essential. Techniques such as principal component analysis, t-SNE, UMAP, self-organizing maps, and locally linear embedding allow us to project high-dimensional data into spaces where structure becomes visible. Before developing these methods in detail, it is important to understand what is meant by a “dimension” in a statistical sense and why high-dimensional settings pose unique challenges. Before moving to the methods of dimension reduction lets discuss a lit bit more on visualization of multivariate datasets.</p>
</section>
<section id="measuring-distances-in-high-dimensional-space" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="measuring-distances-in-high-dimensional-space"><span class="header-section-number">7.3</span> Measuring Distances in High-Dimensional Space</h2>
<p>Measuring Distances in High-Dimensional Space Understanding how distances are computed is the geometric foundation of every technique in this chapter. Whether the goal is PCA, clustering, t-SNE, UMAP, SOM or LLE, everything begins with a single, essential question:</p>
<p>How far apart are two observations? In all introductory examples, we begin with the Euclidean distance, the straight-line distance familiar from basic geometry.</p>
<p>In two or three dimensions, Euclidean distance matches our intuition well: points that look close really are close.</p>
<p>But once the number of variables reaches dozens, hundreds, or thousands-as in multi-omics dermatology datasets-the behaviour of Euclidean distance changes dramatically.</p>
<p>This section builds intuition step-by-step:</p>
<ol type="1">
<li>Euclidean distance in 2D</li>
<li>Euclidean distance in 3D</li>
<li>Euclidean distance in <span class="math inline">\(p\)</span> dimensions</li>
<li>Why Euclidean distance breaks down in high dimensions</li>
<li>Why alternative distance metrics become necessary</li>
</ol>
<section id="euclidean-distance-between-two-points-in-two-dimensions" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="euclidean-distance-between-two-points-in-two-dimensions"><span class="header-section-number">7.3.1</span> Euclidean Distance Between Two Points in Two Dimensions</h3>
<p>Suppose two patients are represented by two quantitative variables-for example, PASI_baseline and <span class="math inline">\(\mathbf{N O}_{\mathbf{2}}\)</span> exposure.</p>
<p>Each patient is a point in a 2-dimensional space. The straight-line (Euclidean) distance is:</p>
<p><span class="math display">\[
d(A, B)=\sqrt{\left(x_B-x_A\right)^2+\left(y_B-y_A\right)^2} .
\]</span></p>
<p>The plot below illustrates this geometry:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Two points A and B in 2D</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>df_points <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(A[<span class="dv">1</span>], B[<span class="dv">1</span>]),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(A[<span class="dv">2</span>], B[<span class="dv">2</span>]),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_points, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">colour =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.1</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dashed horizontal/vertical components</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> A[<span class="dv">1</span>], <span class="at">y =</span> A[<span class="dv">2</span>],</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> B[<span class="dv">1</span>], <span class="at">yend =</span> A[<span class="dv">2</span>]),</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> B[<span class="dv">1</span>], <span class="at">y =</span> A[<span class="dv">2</span>],</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> B[<span class="dv">1</span>], <span class="at">yend =</span> B[<span class="dv">2</span>]),</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># straight-line Euclidean distance</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> A[<span class="dv">1</span>], <span class="at">y =</span> A[<span class="dv">2</span>],</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> B[<span class="dv">1</span>], <span class="at">yend =</span> B[<span class="dv">2</span>]),</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">colour =</span> <span class="st">"blue"</span>,</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">"cm"</span>))</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.4</span>, <span class="at">y =</span> <span class="fl">2.1</span>,</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Euclidean distance"</span>,</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Euclidean distance between two points in 2D"</span>,</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Var 1"</span>, <span class="at">y =</span> <span class="st">"Var 2"</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = A[1], y = A[2], xend = B[1], yend = A[2]), : All aesthetics have length 1, but the data has 2 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = B[1], y = A[2], xend = B[1], yend = B[2]), : All aesthetics have length 1, but the data has 2 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = A[1], y = A[2], xend = B[1], yend = B[2]), : All aesthetics have length 1, but the data has 2 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The dashed lines represent the horizontal and vertical components:</p>
<p><span class="math display">\[
\Delta x=x_B-x_A, \quad \Delta y=y_B-y_A,
\]</span></p>
<p>and the blue arrow represents the Euclidean distance.</p>
<p>To compute the number in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>((B[<span class="dv">1</span>] <span class="sc">-</span> A[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (B[<span class="dv">2</span>] <span class="sc">-</span> A[<span class="dv">2</span>])<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.605551</code></pre>
</div>
</div>
</section>
<section id="euclidean-distance-in-three-dimensions" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="euclidean-distance-in-three-dimensions"><span class="header-section-number">7.3.2</span> Euclidean Distance in Three Dimensions</h3>
<p>Now suppose patients are described by three measurements-say PASI_baseline, <span class="math inline">\(\mathbf{N O}_{\mathbf{2}}\)</span>, and gene_1. Each patient becomes a point in 3D space, and Euclidean distance generalises to:</p>
<p><span class="math display">\[
d(A, B)=\sqrt{\left(x_B-x_A\right)^2+\left(y_B-y_A\right)^2+\left(z_B-z_A\right)^2} .
\]</span></p>
<p>A geometric illustration:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define three 3D points</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>points <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(A[<span class="dv">1</span>], B[<span class="dv">1</span>], C[<span class="dv">1</span>]),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(A[<span class="dv">2</span>], B[<span class="dv">2</span>], C[<span class="dv">2</span>]),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">c</span>(A[<span class="dv">3</span>], B[<span class="dv">3</span>], C[<span class="dv">3</span>]),</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to draw a segment between two points</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>segment3d <span class="ot">&lt;-</span> <span class="cf">function</span>(P, Q, <span class="at">color=</span><span class="st">"blue"</span>) {</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(P[<span class="dv">1</span>], Q[<span class="dv">1</span>]),</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(P[<span class="dv">2</span>], Q[<span class="dv">2</span>]),</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="fu">c</span>(P[<span class="dv">3</span>], Q[<span class="dv">3</span>]),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span>color, <span class="at">width=</span><span class="dv">6</span>),</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">FALSE</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_markers</span>(</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> points,</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>z,</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="sc">~</span>label, <span class="at">textposition =</span> <span class="st">"top center"</span>,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">8</span>,</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"green"</span>, <span class="st">"orange"</span>)),</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">FALSE</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="fu">segment3d</span>(A, B, <span class="at">color=</span><span class="st">"blue"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="fu">segment3d</span>(A, C, <span class="at">color=</span><span class="st">"red"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="fu">segment3d</span>(C, B, <span class="at">color=</span><span class="st">"darkgreen"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Triangle in 3D: Distances Between Points A, B, and C"</span>,</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title=</span><span class="st">"Var 1"</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">6</span>)),</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title=</span><span class="st">"Var 2"</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">6</span>)),</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title=</span><span class="st">"Var 3"</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">6</span>)),</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">aspectmode=</span><span class="st">"cube"</span>,</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">camera=</span><span class="fu">list</span>(<span class="at">eye=</span><span class="fu">list</span>(<span class="at">x=</span><span class="fl">1.7</span>,<span class="at">y=</span><span class="fl">1.7</span>,<span class="at">z=</span><span class="fl">1.5</span>))</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: No trace type specified and no positional attributes specified</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No scatter mode specifed:
  Setting the mode to markers
  Read more about this attribute -&gt; https://plotly.com/r/reference/#scatter-mode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: No trace type specified and no positional attributes specified</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No scatter mode specifed:
  Setting the mode to markers
  Read more about this attribute -&gt; https://plotly.com/r/reference/#scatter-mode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: No trace type specified and no positional attributes specified</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No scatter mode specifed:
  Setting the mode to markers
  Read more about this attribute -&gt; https://plotly.com/r/reference/#scatter-mode</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-533566078af0bbeec305" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-533566078af0bbeec305">{"x":{"visdat":{"af651412ae8e":["function () ","plotlyVisDat"],"af655681f6ed":["function () ","data"]},"cur_data":"af655681f6ed","attrs":{"af655681f6ed":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"markers","text":{},"textposition":"top center","marker":{"size":8,"color":["purple","green","orange"]},"showlegend":false,"inherit":true},"af655681f6ed.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"inherit":true},"af655681f6ed.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"inherit":true},"af655681f6ed.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Triangle in 3D: Distances Between Points A, B, and C","scene":{"xaxis":{"title":"Var 1","range":[0,6]},"yaxis":{"title":"Var 2","range":[0,6]},"zaxis":{"title":"Var 3","range":[0,6]},"aspectmode":"cube","camera":{"eye":{"x":1.7,"y":1.7,"z":1.5}}},"xaxis":{"domain":[0,1],"automargin":true},"yaxis":{"domain":[0,1],"automargin":true},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,4,2],"y":[1,3,4],"z":[1,2,3],"type":"scatter3d","mode":"markers","text":["A","B","C"],"textposition":["top center","top center","top center"],"marker":{"color":["purple","green","orange"],"size":8,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":false,"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null},{"type":"scatter","mode":"markers","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"markers","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"markers","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="euclidean-distance-in-p-dimensions" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="euclidean-distance-in-p-dimensions"><span class="header-section-number">7.3.3</span> Euclidean Distance in <span class="math inline">\(p\)</span> Dimensions</h3>
<p>If each patient is represented by <span class="math inline">\(p\)</span> quantitative variables:</p>
<p><span class="math display">\[
A=\left(x_1^{(A)}, \ldots, x_p^{(A)}\right), \quad B=\left(x_1^{(B)}, \ldots, x_p^{(B)}\right),
\]</span></p>
<p>then Euclidean distance becomes:</p>
<p><span class="math display">\[
d(A, B)=\sqrt{\sum_{j=1}^p\left(x_j^{(B)}-x_j^{(A)}\right)^2} .
\]</span></p>
<p>This is exactly the same formula-just extended over more coordinates.</p>
<p>However, as <span class="math inline">\(p\)</span> grows: - Distances increase automatically - Small differences accumulate across hundreds or thousands of dimensions - Nearest and farthest neighbours become almost the same distance away</p>
<p>This distance instability is one of the core reasons PCA and nonlinear methods become necessary. Example in R :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>A_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.5</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>B_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="fl">1.1</span>, <span class="dv">5</span>, <span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">3</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">sum</span>((B_vec <span class="sc">-</span> A_vec)<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.828427</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dist</span>(<span class="fu">rbind</span>(A_vec, B_vec))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         A_vec
B_vec 2.828427</code></pre>
</div>
</div>
<section id="why-euclidean-distance-breaks-down-in-high-dimensions" class="level4" data-number="7.3.3.1">
<h4 data-number="7.3.3.1" class="anchored" data-anchor-id="why-euclidean-distance-breaks-down-in-high-dimensions"><span class="header-section-number">7.3.3.1</span> Why Euclidean Distance Breaks Down in High Dimensions</h4>
<p>The formulas above generalise cleanly to any number of dimensions, but the geometry does not. As the number of variables increases—even when each variable is informative and well behaved—Euclidean distances become counterintuitive.</p>
<p>Two phenomena are responsible:</p>
<p>Distance expansion Every additional dimension adds another squared difference. Even tiny differences accumulate.</p>
<p>Distance concentration The ratio between the smallest and largest pairwise distances approaches 1. In other words, everything becomes equally far apart.</p>
<p>Both behaviours arise even in perfectly clean, simulated data, which makes the effect unavoidable in real multi-omics datasets containing thousands of features.</p>
<p>The following simulation illustrates distance concentration using random Gaussian points:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>dims <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">500</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>n_points <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>distance_summary <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dims, <span class="cf">function</span>(p) {</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate n points in p dimensions</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n_points <span class="sc">*</span> p), <span class="at">nrow =</span> n_points)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute all pairwise Euclidean distances</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  D <span class="ot">&lt;-</span> <span class="fu">dist</span>(X)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">dimension =</span> p,</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_dist  =</span> <span class="fu">min</span>(D),</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_dist  =</span> <span class="fu">max</span>(D),</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratio     =</span> <span class="fu">min</span>(D) <span class="sc">/</span> <span class="fu">max</span>(D)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>distance_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  dimension min_dist max_dist   ratio
      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1         2   0.0121     7.35 0.00165
2         5   0.277      7.94 0.0348 
3        10   1.20       8.76 0.137  
4        50   6.06      14.7  0.411  
5       100  10.3       18.4  0.559  
6       500  26.7       35.4  0.755  </code></pre>
</div>
</div>
<p>Which can be view with the help of this graphic</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(distance_summary, <span class="fu">aes</span>(<span class="at">x =</span> dimension, <span class="at">y =</span> ratio)) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"darkblue"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">colour =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans =</span> <span class="st">"log10"</span>) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distance concentration in high dimensions"</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of dimensions (log scale)"</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"min(distance) / max(distance)"</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As dimension increases from 2 to 500, the smallest and largest distances become almost indistinguishable. In such settings, the meaning of “closest neighbour” becomes nearly arbitrary.</p>
<p>This motivates the transition from Euclidean distance to alternative definitions of similarity.</p>
</section>
</section>
<section id="beyond-euclidean-distance-alternative-metrics-for-high-dimensional-data" class="level3" data-number="7.3.4">
<h3 data-number="7.3.4" class="anchored" data-anchor-id="beyond-euclidean-distance-alternative-metrics-for-high-dimensional-data"><span class="header-section-number">7.3.4</span> Beyond Euclidean Distance: Alternative Metrics for High-Dimensional Data</h3>
<p>High-dimensional geometry requires distance measures that remain meaningful even when many variables contribute noise, redundancy, or irrelevant variation. Here we introduce three widely used metrics and illustrate them using small, interpretable examples.</p>
<ol type="1">
<li>Manhattan distance (L1 norm)</li>
<li>Cosine distance (angular similarity)</li>
<li>Mahalanobis distance (correlation-adjusted)</li>
</ol>
<p>Each has a different geometric interpretation and different strengths in multi-omics settings.</p>
<p>Manhattan Distance (L1) Manhattan distance replaces the <span class="math inline">\(\sqrt{ }\)</span> (sum of squares) with the sum of absolute differences:</p>
<p><span class="math display">\[
d_{\operatorname{Man}}(A, B)=\sum_{j=1}^p\left|x_j^{(B)}-x_j^{(A)}\right| .
\]</span></p>
<p>It tends to behave more robustly when many dimensions include noise because differences do not get squared.</p>
<p>Example with three variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df_small <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">PASI  =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>),</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">NO2   =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">55</span>),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">gene1 =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dist</span>(df_small, <span class="at">method =</span> <span class="st">"manhattan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     1
2 37.8</code></pre>
</div>
</div>
<p>Manhattan distance often produces more stable neighbour relationships in high-dimensional spaces than Euclidean distance. Cosine Distance (Angular Similarity) Cosine distance measures angle, not absolute magnitude. Two observations are considered similar when they point in the same direction in high-dimensional space —even if their overall magnitude differs.</p>
<p><span class="math display">\[
d_{\cos }(A, B)=1-\frac{A \cdot B}{\|A\|\|B\|} .
\]</span></p>
<p>This metric is extremely common in gene expression, text data, microbiome compositional profiles, and sparse features.</p>
<p>Example (using the Isa package):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lsa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: SnowballC</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df_small <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">PASI  =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">NO2   =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">55</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">gene1 =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>cosine_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(a)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(b)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(a <span class="sc">*</span> b) <span class="sc">/</span> (<span class="fu">sqrt</span>(<span class="fu">sum</span>(a<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(b<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cosine_distance</span>(df_small[<span class="dv">1</span>,], df_small[<span class="dv">2</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03086137</code></pre>
</div>
</div>
<p>Cosine distance is not affected by overall scaling-only by relative patterns.</p>
<p>Mahalanobis Distance: A Correlation-Aware Metric Mahalanobis distance accounts for: - correlations among variables, - differences in scale, - redundant dimensions.</p>
<p>It rescales the space by the inverse covariance matrix so that correlated variables do not artificially inflate distance.</p>
<p><span class="math display">\[
d_{\mathrm{Mah}}(A, B)=\sqrt{(A-B)^{\top} \Sigma^{-1}(A-B)} .
\]</span></p>
<p>This metric is especially powerful in multi-omics settings, where large blocks of correlated genes or microbial taxa dominate Euclidean distance.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)   <span class="co"># for ginv()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:plotly':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Small example dataset (3 variables, 3 observations)</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This guarantees that the covariance matrix is singular.</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>df_small <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">PASI  =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">18</span>),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">NO2   =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">55</span>, <span class="dv">45</span>),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">gene1 =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.5</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to matrix so rows behave as numeric vectors</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(df_small)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Covariance matrix of the variables</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: With only 3 observations, Sigma is singular (non-invertible)</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">cov</span>(X)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect Sigma</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>Sigma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          PASI NO2 gene1
PASI  17.33333  35  0.40
NO2   35.00000 325  7.00
gene1  0.40000   7  0.16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract two patient vectors A and B</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> X[<span class="dv">1</span>, ]</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> X[<span class="dv">2</span>, ]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Mahalanobis distance with pseudoinverse</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># solve(Sigma) would fail here because Sigma is singular.</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># We use the Moore–Penrose pseudoinverse instead.</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>invSigma <span class="ot">&lt;-</span> <span class="fu">ginv</span>(Sigma)   <span class="co"># always safe, even if Sigma is singular</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>d_mahal <span class="ot">&lt;-</span> <span class="fu">sqrt</span>( <span class="fu">t</span>(A <span class="sc">-</span> B) <span class="sc">%*%</span> invSigma <span class="sc">%*%</span> (A <span class="sc">-</span> B) )</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>d_mahal</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,]    2</code></pre>
</div>
</div>
</section>
<section id="distances-in-a-nutshell" class="level3" data-number="7.3.5">
<h3 data-number="7.3.5" class="anchored" data-anchor-id="distances-in-a-nutshell"><span class="header-section-number">7.3.5</span> Distances in a nutshell!</h3>
<p>Each distance metric encodes a different notion of similarity, and in high-dimensional biomedical datasets these differences become substantial rather than cosmetic. Euclidean distance measures absolute differences along every axis, Manhattan accumulates deviations linearly, cosine distance emphasises direction rather than magnitude, and Mahalanobis adjusts for correlations and redundant structure in the data.</p>
<p>In low dimensions, these metrics often agree, but in multi-omics settings the neighbourhood structure can change dramatically depending on which one is used. Two patients may lie close under Euclidean distance yet appear far apart under cosine distance if their expression levels differ in magnitude but share the same pattern. Conversely, a block of highly correlated genomic variables can inflate Euclidean distances while Mahalanobis explicitly discounts such redundancy.</p>
<p>The three-variable example introduced earlier illustrates these contrasts. Euclidean distance reacts most strongly to large shifts in a single axis (e.g.&nbsp;NO₂), Manhattan evaluates overall divergence, cosine focuses on relative shapes, and Mahalanobis amplifies differences along decorrelated directions while down-weighting correlated ones. This diversity of geometric emphasis explains why PCA, t-SNE and UMAP uncover different structural views of the same dataset: each implicitly relies on a different distance behaviour.</p>
<p>As dimensionality grows, Euclidean distance deteriorates due to expansion and concentration: all points become far from one another, and nearest neighbours become indistinguishable. Neighbourhood-based methods then operate on unstable geometry. Although alternative metrics alleviate some problems, none escape the curse of dimensionality entirely; reducing the dimension of the data becomes unavoidable.</p>
<p>To visualise how different metrics behave, we can compare their distance matrices for the small toy dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lsa)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>df_small <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">PASI  =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">18</span>),</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">NO2   =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">55</span>, <span class="dv">45</span>),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gene1 =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.5</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(df_small)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Euclidean</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>D_euc <span class="ot">&lt;-</span> <span class="fu">dist</span>(X, <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Manhattan</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>D_man <span class="ot">&lt;-</span> <span class="fu">dist</span>(X, <span class="at">method =</span> <span class="st">"manhattan"</span>)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Cosine</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>cosine_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) <span class="dv">1</span> <span class="sc">-</span> <span class="fu">cosine</span>(a, b)</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>D_cos <span class="ot">&lt;-</span> <span class="fu">outer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>               <span class="fu">Vectorize</span>(<span class="cf">function</span>(i, j) <span class="fu">cosine_distance</span>(X[i, ], X[j, ])))</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Mahalanobis using pseudoinverse</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">cov</span>(X)</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>invSigma <span class="ot">&lt;-</span> <span class="fu">ginv</span>(Sigma)</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>d_mahal_pair <span class="ot">&lt;-</span> <span class="cf">function</span>(i, j) {</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> X[i, ] <span class="sc">-</span> X[j, ]</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">t</span>(diff) <span class="sc">%*%</span> invSigma <span class="sc">%*%</span> diff)</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>D_mah <span class="ot">&lt;-</span> <span class="fu">outer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">Vectorize</span>(d_mahal_pair))</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>D_euc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1        2
2 35.06622         
3 26.25186 11.66876</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>D_man</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     1    2
2 37.8     
3 33.4 16.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>D_cos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]       [,2]        [,3]
[1,] 0.000000000 0.03086137 0.003471099
[2,] 0.030861366 0.00000000 0.013708971
[3,] 0.003471099 0.01370897 0.000000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>D_mah</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    0    2    2
[2,]    2    0    2
[3,]    2    2    0</code></pre>
</div>
</div>
<p>Even in this tiny example the matrices differ meaningfully; in a dataset with thousands of variables, the differences become dramatic. Because PCA, t-SNE, UMAP, SOM and LLE are all distance-driven methods—each constructing neighbourhoods in its own way—any distortion in the metric propagates directly into the final embedding.</p>
<p>Linear PCA implicitly assumes Euclidean geometry; t-SNE converts Euclidean distances into local Gaussian similarities; UMAP constructs a fuzzy nearest-neighbour graph; SOM updates lattice neurons using Euclidean distance; and LLE reconstructs each point from its neighbours. If the distance metric becomes unstable, PCA may emphasise noise, t-SNE may fragment the space arbitrarily, UMAP may form spurious clusters, SOM may impose patterns, and LLE may fail to unfold manifolds.</p>
<p>Understanding the geometry of distance is therefore not optional: it determines the validity, stability and interpretability of all nonlinear representations that follow.</p>
</section>
</section>
<section id="techniques-for-visualizing-multiple-dimensions-in-a-single-graphic" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="techniques-for-visualizing-multiple-dimensions-in-a-single-graphic"><span class="header-section-number">7.4</span> Techniques for Visualizing Multiple Dimensions in a Single Graphic</h2>
<p>As the number of variables in a dataset increases, direct visualization becomes progressively more challenging. While simple scatterplots or pairs plots can depict relationships among a handful of variables, they quickly lose interpretability once dozens or hundreds of measurements are involved. A few multivariate visualization techniques extend the capacity of graphical exploration and allow many dimensions to be represented simultaneously, each preserving different aspects of the underlying structure.</p>
<p>One approach is the <strong>parallel coordinate plot</strong>, in which each variable is drawn as a vertical axis and each observation is represented as a polyline crossing all axes. When many observations follow similar multivariate patterns, their lines tend to form coherent bundles, whereas unusual or distinct profiles appear as diverging trajectories. This style of plot is particularly useful for identifying latent groupings or outliers across large sets of features. In R, the GGally package provides convenient functions for producing such plots:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>df_small <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(PASI_baseline, NO2, PM10, gene_1, gene_2, Outcome_PASI12)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggparcoord</span>(</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_small,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="st">"std"</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">alphaLines =</span> <span class="fl">0.4</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Parallel coordinate plot of selected variables"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="lattice-graphics-for-multivariate-data" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="lattice-graphics-for-multivariate-data"><span class="header-section-number">7.4.1</span> Lattice graphics for multivariate data</h3>
<p>The lattice system in R provides an alternative framework for displaying multivariate relationships, structured around the idea of conditioning plots. Rather than attempting to represent many dimensions within a single panel, lattice graphics show how the relationship between two variables changes across levels or ranges of a third. This approach is particularly useful in high-dimensional clinical or molecular datasets, where interactions among patient characteristics, environmental exposures, and molecular markers may vary across subgroups.</p>
<p>Lattice plots are built on the notion of <em>trellis displays</em>: grids of panels, each panel corresponding to a subset of the data defined by conditioning variables. In a dataset combining genomic expression, exposome profiles, and clinical severity, conditioning can be used to reveal how associations differ across patient segments. For example, one may examine how NO₂ exposure relates to baseline PASI stratified by quartiles of an inflammatory gene, or how exposure–response patterns differ across microbiome clusters. This form of visualization is especially effective when the structure being investigated is not globally linear but instead varies across local regions of the dataset.</p>
<p>The following illustration uses lattice to examine the relationship between baseline PASI and NO₂ exposure, conditioned on quartiles of an inflammatory gene:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct gene-based strata for conditioning</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>df_lattice <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gene_band =</span> <span class="fu">ntile</span>(gene_1, <span class="dv">4</span>))</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  NO2 <span class="sc">~</span> PASI_baseline <span class="sc">|</span> <span class="fu">factor</span>(gene_band),</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_lattice,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">layout =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"darkred"</span>,</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Baseline PASI"</span>,</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"NO₂ exposure"</span>,</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Conditioned scatterplots by quartiles of gene_1 expression"</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In each panel, the basic exposure–severity pattern is retained, but the distribution shifts according to the gene expression stratum. This helps illustrate how a third variable, which might not be easy to represent directly in low-dimensional space, can modulate an otherwise diffuse relationship.</p>
<p>The lattice framework also supports multivariate conditioning with smoothers, which can help highlight structure that is not visually apparent in raw scatterplots. For instance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  NO2 <span class="sc">~</span> PASI_baseline <span class="sc">|</span> <span class="fu">factor</span>(gene_band),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_lattice,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">layout =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel =</span> <span class="cf">function</span>(x, y, ...) {</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">panel.xyplot</span>(x, y, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"gray40"</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">panel.loess</span>(x, y, <span class="at">col =</span> <span class="st">"darkblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Baseline PASI"</span>,</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"NO₂ exposure"</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>By adding a panel-specific smoother, each facet displays a local trend, making differences across strata easier to compare.</p>
<p>Finally, lattice can also be used for conditioned density plots or conditioned histograms, which are valuable when exploring differences in molecular or environmental distributions across clinical outcome groups. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">densityplot</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> gene_1 <span class="sc">|</span> <span class="fu">cut</span>(Outcome_PASI12, <span class="at">breaks =</span> <span class="dv">3</span>),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.points =</span> <span class="cn">FALSE</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"purple"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Gene 1 expression (scaled)"</span>,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Conditioned density plots of inflammatory gene expression"</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Taken together, lattice graphics offer a flexible way to explore high-dimensional data through structured, conditioned displays. Although they do not circumvent the dimensionality problem, they provide an interpretable set of tools for examining how relationships among variables differ across biologically meaningful subspaces. These displays complement the dimension-reduction techniques introduced later in the chapter by offering an intermediate step: they preserve the original variables while still revealing structure that single-panel plots would miss.</p>
</section>
</section>
<section id="the-curse-of-dimensionality" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="the-curse-of-dimensionality"><span class="header-section-number">7.5</span> The curse of dimensionality</h2>
<p>High-dimensional datasets behave in ways that differ fundamentally from the low-dimensional settings we can visualize. As the number of variables increases, the geometry of the underlying data space changes in counterintuitive ways. Points become sparse, distances lose discriminatory power, correlations proliferate, and meaningful structure often becomes hidden along directions that are not directly observable. This collection of phenomena is known as the <em>curse of dimensionality</em>, a term originally associated with numerical approximation but now widely used to describe a broad suite of challenges in statistical learning.</p>
<p>To understand why high-dimensional analysis becomes so difficult, it helps to examine how distance, volume, and neighbourhood structure evolve as the dimension grows. In ordinary two- or three-dimensional spaces, intuition works reasonably well: nearby points truly feel close, clusters are compact, and the geometry is navigable. But in very high dimensions—such as those produced by genomic expression matrices, microbiome abundance vectors, or exposome profiles—these intuitive notions break down.</p>
<p>In high dimensions, the distance between the closest pair of points and the distance between the most distant pair become nearly identical. This undermines methods that rely on relative distances—nearest-neighbour classification, clustering, kernel methods, or manifold estimation—because the contrast between “near” and “far” disappears.</p>
<p>The simulation below illustrates this phenomenon: as we increase the number of dimensions p, the ratio between the minimum and maximum pairwise distances approaches one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>dims <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">500</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>n_points <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>distance_summary <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dims, <span class="cf">function</span>(p) {</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n_points <span class="sc">*</span> p), <span class="at">nrow =</span> n_points)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  D <span class="ot">&lt;-</span> <span class="fu">dist</span>(X)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">dimension =</span> p,</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_dist =</span> <span class="fu">min</span>(D),</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_dist =</span> <span class="fu">max</span>(D),</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratio =</span> <span class="fu">min</span>(D) <span class="sc">/</span> <span class="fu">max</span>(D)</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>distance_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  dimension min_dist max_dist   ratio
      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1         2   0.0198     5.58 0.00355
2         5   0.327      7.42 0.0440 
3        10   1.27       8.45 0.150  
4        50   6.53      14.3  0.458  
5       100  10.3       17.9  0.578  
6       500  28.1       35.2  0.797  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(distance_summary, <span class="fu">aes</span>(<span class="at">x =</span> dimension, <span class="at">y =</span> ratio)) <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.1</span>, <span class="at">colour =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans =</span> <span class="st">"log10"</span>) <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Concentration of distances in high dimensions"</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Dimension (log scale)"</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"min(distance) / max(distance)"</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This abstract simulation reflects precisely what happens in our psoriasis dataset. Although each patient lives in a space defined by nearly two thousand variables, the raw Euclidean distance between patients is dominated by noise contributed by unrelated dimensions. The genomic block alone—1500 correlated genes—causes distances to be large and nearly homogeneous across patients. The addition of microbiome features and exposome variables further increases the dimensionality, pushing distances toward a narrow band where meaningful biological differences no longer translate into measurable separation. Even patients with very different underlying inflammatory signatures may end up appearing similarly distant when measured in the full raw feature space.</p>
<p>Another consequence of high dimensionality is the rise of collinearity. Biological systems contain modules of coordinated activity: groups of genes co-regulated by the same pathway, microbial taxa that track together, or environmental exposures that co-vary seasonally. As the number of variables increases, so does the probability that many of them are redundant, linearly dependent, or nearly so. This reduces the effective dimensionality of the dataset, creates numerical instability, and complicates interpretation. In the psoriasis example, the IL-17/IL-23 axis produces clusters of highly correlated genes, and microbial communities often form compositional modules. These structures amplify the curse of dimensionality by introducing broad corridors of dependency within a vast space.</p>
<section id="collinearity" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1" class="anchored" data-anchor-id="collinearity"><span class="header-section-number">7.5.1</span> Collinearity</h3>
<p>Taken together, these effects—sparsity, distance concentration, and collinearity—make high-dimensional spaces difficult to navigate and even harder to model. Visual inspection becomes uninformative, distances lose meaning, and the most relevant biological structure can remain hidden along composite directions that are not aligned with any single variable. For these reasons, reducing the dimensionality of the data becomes essential. Dimensionality reduction seeks to identify low-dimensional representations that preserve the key structure of the dataset—variation, neighbourhood relationships, clusters, or manifold geometry—while eliminating noise and redundancy. In other words reduction dimension techniques makes possible to represent the same information in a dataset with new created variables, in number lower than the original number of features.</p>
<p>Before turning to specific techniques such as principal component analysis, it is helpful to examine more closely how collinearity interacts with the curse of dimensionality and why addressing it is a natural first step in any high-dimensional workflow.</p>
</section>
</section>
<section id="collinearity-and-redundancy-in-high-dimensions" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="collinearity-and-redundancy-in-high-dimensions"><span class="header-section-number">7.6</span> Collinearity and Redundancy in High Dimensions</h2>
<p>Collinearity refers to the situation in which two or more variables convey overlapping information because they move together in a systematic way. Formally, a set of predictors</p>
<p><span class="math display">\[
X_1, X_2, \ldots, X_p
\]</span></p>
<p>is collinear when one or more of them can be expressed as an approximately linear combination of the others. In matrix notation, this means the covariance matrix</p>
<p><span class="math display">\[
\Sigma=\frac{1}{n} X^{\top} X
\]</span></p>
<p>contains near-redundant columns, leading to high pairwise correlations or even near-zero eigenvalues. The geometric implication is that the data cloud occupies a much lower-dimensional subspace than the number of measured variables would suggest.</p>
<p>Collinearity is a defining feature of multi-omics data. Gene expression modules often arise from common transcriptional programs, generating blocks of highly correlated genes. Microbiome abundance features exhibit strong dependencies due to compositional constraints and ecological co-occurrence patterns. Exposome variables often move together through seasonal influences or shared environmental conditions. When such blocks coexist within the same dataset, the result is a geometry dominated by a handful of latent processes embedded in a very large number of measured variables.</p>
<p>In the psoriasis example, the IL-17/IL-23 inflammatory axis drives coordinated expression across dozens of genes, many of which contribute redundant information. To illustrate this, consider the correlation structure of the first 50 genes in the genomic block:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>gene_subset <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"gene_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>cor_mat <span class="ot">&lt;-</span> <span class="fu">cor</span>(gene_subset)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>cor_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(cor_mat)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cor_df, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Correlation heatmap of 50 genomic features"</span>,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Correlation"</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The heatmap reveals correlated genes, reflecting shared underlying regulatory signals rather than independent biological drivers. When scaled to the full 1500-gene space, this dependence creates long corridors of redundancy where many axes contribute little unique information.</p>
<p>Collinearity also manifests in the microbiome block. Even though microbial abundance features are generated independently in the simulation, they are anchored to latent dysbiosis and commensal signatures. This induces patterns that resemble ecological modules. A simple visualization using the first 30 microbiome features shows similar structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>micro_subset <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"ASV_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>micro_cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(micro_subset)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>micro_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(micro_cor)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(micro_df, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Correlation heatmap of 30 microbiome features"</span>,</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Correlation"</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These dependencies have several consequences. Regressions that use raw variables become unstable because small perturbations in the data can lead to large changes in estimated coefficients. Distance-based procedures weigh correlated dimensions repeatedly, distorting neighbourhood structure. Clustering algorithms may split or merge groups based on redundant patterns rather than true latent structure. Interpretability also suffers: when many variables carry essentially the same information, it becomes difficult to discern which dimensions reflect genuine biological signals.</p>
<p>Despite these challenges, collinearity offers a key opportunity: it reveals that the data often lie near a low-dimensional subspace. In other words, even though the measured feature space spans thousands of axes, the underlying variation is driven by a much smaller number of latent processes. Dimensionality-reduction methods exploit this fact. By identifying directions along which the data vary most, or by seeking low-dimensional manifolds that preserve neighbourhood relations, these techniques both stabilize analysis and reveal interpretable structure.</p>
<p>The presence of strong collinearity therefore provides a natural bridge to dimensionality reduction. Principal component analysis (PCA), in particular, is designed to extract the dominant axes of variation from high-dimensional spaces. Before applying nonlinear methods such as t-SNE, UMAP, or self-organizing maps, PCA offers the first principled approach to summarizing structure, stabilizing computations, and mitigating the effects of the curse of dimensionality.</p>
</section>
<section id="principal-component-analysis" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="principal-component-analysis"><span class="header-section-number">7.7</span> Principal Component Analysis</h2>
<p>Principal Component Analysis (PCA) is a method for re-expressing high-dimensional data in terms of a smaller set of orthogonal axes that capture the dominant patterns of variation. It is built on a simple geometric idea: in any cloud of points occupying a high-dimensional space—such as our Dermato-ATT dataset, which contains gene expression, microbiome profiles, exposome measurements, and inflammatory biomarkers—some directions contain far more variability than others. PCA identifies these directions and rotates the coordinate system so that the first axis aligns with the greatest possible variance, the next axis captures the largest remaining variance under the constraint of orthogonality, and subsequent axes continue this pattern.</p>
<p>The following Figure llustrates this idea using a simple two-dimensional slice of a multivariate dataset. The original coordinate axes are fixed, but the point cloud stretches more strongly along an oblique direction. PCA identifies this dominant direction of spread (PC1) and the largest remaining orthogonal direction (PC2). These new axes are not selected variables but linear combinations of them, and they form the rotated coordinate system that best captures the intrinsic geometry of the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a correlated cloud (so rotation is visible)</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="fl">2.7</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">2.7</span>, <span class="dv">3</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>df_2 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">300</span>,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Sigma =</span> Sigma) <span class="sc">%&gt;%</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>))</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit PCA</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>pca_fit_2 <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(df_2, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>rot <span class="ot">&lt;-</span> pca_fit_2<span class="sc">$</span>rotation</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>prop_var <span class="ot">&lt;-</span> pca_fit_2<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sum</span>(pca_fit_2<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Length of arrows</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>scale_factor <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>PC1 <span class="ot">&lt;-</span> rot[,<span class="dv">1</span>] <span class="sc">*</span> scale_factor</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>PC2 <span class="ot">&lt;-</span> rot[,<span class="dv">2</span>] <span class="sc">*</span> scale_factor</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Original axes</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> scale_factor, <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> scale_factor),</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PCA axes</span></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> PC1[<span class="dv">1</span>], <span class="at">yend =</span> PC1[<span class="dv">2</span>]),</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)),</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">1.4</span>) <span class="sc">+</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> PC2[<span class="dv">1</span>], <span class="at">yend =</span> PC2[<span class="dv">2</span>]),</span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)),</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">1.4</span>) <span class="sc">+</span></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> PC1[<span class="dv">1</span>]<span class="sc">*</span><span class="fl">1.1</span>, <span class="at">y =</span> PC1[<span class="dv">2</span>]<span class="sc">*</span><span class="fl">1.1</span>,</span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(prop_var[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">"%)"</span>),</span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">5.2</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> PC2[<span class="dv">1</span>]<span class="sc">*</span><span class="fl">1.1</span>, <span class="at">y =</span> PC2[<span class="dv">2</span>]<span class="sc">*</span><span class="fl">1.1</span>,</span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(prop_var[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">"%)"</span>),</span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">5.2</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Geometric interpretation of PCA as a rotation"</span>,</span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PC1 aligns with the direction of maximal spread; PC2 is orthogonal and captures the next largest variation"</span>,</span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Original axis 1"</span>,</span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Original axis 2"</span></span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 0, y = 0, xend = scale_factor, yend = 0), : All aesthetics have length 1, but the data has 300 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 0, y = 0, xend = 0, yend = scale_factor), : All aesthetics have length 1, but the data has 300 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 0, y = 0, xend = PC1[1], yend = PC1[2]), : All aesthetics have length 1, but the data has 300 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = 0, y = 0, xend = PC2[1], yend = PC2[2]), : All aesthetics have length 1, but the data has 300 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From a geometric point of view, the operation is a rotation of the data cloud. If each patient is represented as a point in a space where every molecular or environmental variable forms an axis of its own, the cloud of points spreads more extensively along certain directions than others. PCA finds these directions and uses them as new axes. The resulting “principal components’’ are not simply chosen variables; they are linear combinations of the originals and correspond to slanted directions in the original multidimensional space. These combinations are constructed so that the first component captures the broadest overall spread, the second captures the broadest remaining spread orthogonally, and subsequent components continue the pattern.</p>
<p>Algebraically, PCA corresponds to computing the eigen decomposition of the covariance (or correlation) matrix of the standardized variables. Each eigenvector gives the coefficients of a principal component, and each eigenvalue gives the amount of variance encoded by that direction. Because the eigenvectors are orthogonal, each component adds genuinely new information not captured by earlier components.</p>
<p>In the psoriasis dataset, this geometric rotation often reveals interpretable biological structure. A dominant inflammatory axis typically emerges, blending IL-17 pathway genes, cytokine concentrations, and sometimes specific microbial signatures associated with dysbiosis. A separate axis may isolate environmental gradients, mixing ultraviolet exposure, particulate matter, temperature, and humidity. Although PCA does not know anything about treatment response, these principal directions often correlate with disease activity or therapeutic improvement, making the representation clinically informative.</p>
<section id="building-your-first-pca-model" class="level3" data-number="7.7.1">
<h3 data-number="7.7.1" class="anchored" data-anchor-id="building-your-first-pca-model"><span class="header-section-number">7.7.1</span> Building your first PCA model</h3>
<p>Before fitting a PCA model it is essential to select appropriate variables. PCA can only process quantitative variables because it depends on the computation of variances and covariances in Euclidean space; categorical variables do not have meaningful numerical variance and cannot be incorporated directly. Identifiers, treatment labels, diagnostic categories, and any other non-numeric columns must either be removed or handled using dedicated extension methods such as MCA or FAMD.</p>
<p>For the Dermato-ATT dataset, we therefore begin by selecting the quantitative predictors—gene expression markers, microbial profiles, exposome features, and biochemical biomarkers. The 12-week PASI improvement is excluded because PCA is unsupervised. Standardisation is also essential. Without scaling, variables with very large units or natural ranges would dominate the computation of covariance, forcing PCA to align itself with measurement scale rather than with biological structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>df_pca <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>patient_id, <span class="sc">-</span>Outcome_PASI12) <span class="sc">%&gt;%</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), scale))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fitting-pca-using-factominer" class="level3" data-number="7.7.2">
<h3 data-number="7.7.2" class="anchored" data-anchor-id="fitting-pca-using-factominer"><span class="header-section-number">7.7.2</span> Fitting PCA Using FactoMineR</h3>
<p>We now fit PCA using the FactoMineR package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>res.pca <span class="ot">&lt;-</span> <span class="fu">PCA</span>(df_pca, <span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#str(res.pca)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code above shows that FactoMineR organises the entire PCA output into a coherent structure that mirrors the geometry of the method. The eigenvalues quantify how much variance each principal component captures, while the associated proportions indicate the relative importance of the axes. The variables are represented through their coordinates on the components, the quality of their representation (cos²), and their contributions to each axis, all of which help reveal which molecular or environmental features shape the underlying structure. Individuals are described in parallel, with their coordinates, cos² values, and contributions providing insight into how patients are positioned in the new latent space. The correlation circle summarises the relationships among variables by projecting them into the component space, and optional supplementary individuals or variables can be projected onto the existing axes without influencing their construction.</p>
<p>The variance explained is by each PC is obtained via <code>res.pca$eig</code> of which we show the firt 6 elements below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res.pca<span class="sc">$</span>eig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        eigenvalue percentage of variance cumulative percentage of variance
comp 1 1184.427938             64.0231318                          64.02313
comp 2  203.856623             11.0192769                          75.04241
comp 3   47.985837              2.5938290                          77.63624
comp 4    6.143177              0.3320636                          77.96830
comp 5    4.143578              0.2239772                          78.19228
comp 6    4.060046              0.2194620                          78.41174</code></pre>
</div>
</div>
<p>To visualize the variance structure we can use a graphic name scree plot like the one below that represents the percentage of explained variances by each PC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_screeplot</span>(res.pca, <span class="at">ncp =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_bar(stat = "identity", fill = barfill, color = barcolor, :
Ignoring empty aesthetic: `width`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="scores-and-loadings-what-they-represent-and-how-to-extract-them" class="level3" data-number="7.7.3">
<h3 data-number="7.7.3" class="anchored" data-anchor-id="scores-and-loadings-what-they-represent-and-how-to-extract-them"><span class="header-section-number">7.7.3</span> Scores and Loadings: What They Represent and How to Extract Them</h3>
<p>Once a PCA model has been fitted, two sets of quantities become central for interpretation: the scores and the loadings. Scores give the coordinates of each individual in the new component space. They show where each patient sits along the latent axes of variation uncovered by PCA, making it possible to visualise biological separation, identify clusters, or explore relationships with clinical outcomes. Loadings describe how each principal component is constructed from the original variables. Each loading is a coefficient in the linear combination that forms the component, and variables with large absolute loadings are those that most strongly influence its orientation.</p>
<p>FactoMineR stores these quantities within the <code>res.pca$ind</code> and <code>res.pca$var</code> lists. The coordinates of individuals are found in <code>res.pca$ind$coord</code>, while the coordinates of variables—often interpreted as loadings in PCA with scaling—are stored in <code>res.pca$var$coord</code>. These coordinates are essential for building interpretability: they clarify which biological modules dominate each axis and how individuals project onto them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scores (individual coordinates)</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> res.pca<span class="sc">$</span>ind<span class="sc">$</span>coord</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loadings (variable coordinates)</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>loadings <span class="ot">&lt;-</span> res.pca<span class="sc">$</span>var<span class="sc">$</span>coord</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because all variables were standardised before PCA, each loading can be interpreted directly as the correlation between the variable and the component. Larger absolute values reflect stronger association with the PC axis.</p>
<p>To see the variance structure of the components, a scree plot provides an immediate overview of how much information each axis retains. This is especially useful in high-dimensional multi-omics settings, where only a handful of components represent most of the meaningful covariance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_screeplot</span>(res.pca, <span class="at">ncp =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_bar(stat = "identity", fill = barfill, color = barcolor, :
Ignoring empty aesthetic: `width`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="identifying-the-most-important-variables-for-each-component" class="level3" data-number="7.7.4">
<h3 data-number="7.7.4" class="anchored" data-anchor-id="identifying-the-most-important-variables-for-each-component"><span class="header-section-number">7.7.4</span> Identifying the Most Important Variables for Each Component</h3>
<p>Understanding which variables drive a principal component requires examining their contributions. FactoMineR directly provides contributions (in %) through res.pca<span class="math inline">\(var\)</span>contrib, which quantify how much each variable participates in forming each axis. Higher contribution values indicate more influential variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>contrib <span class="ot">&lt;-</span> res.pca<span class="sc">$</span>var<span class="sc">$</span>contrib</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 for PC1, PC2, PC3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the later matrix in <code>res.pca$var$contrib</code>, we can extract the ten most important variables for any component. Below is a general approach to obtain the top contributors for the first three components.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(ggplot2)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'patchwork'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MASS':

    area</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># top10_vars(): Extract the Top 10 contributing variables for a PCA component</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This helper function retrieves the variables that contribute</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># most strongly to a given principal component.</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="co"># INPUT:</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   component  -&gt; integer (1 = PC1, 2 = PC2, etc.)</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># INTERNALS:</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   contrib is a matrix from FactoMineR:</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     rows   = variables</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     cols   = principal components</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="co"># STEPS:</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   1. Select the column corresponding to the chosen PC.</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   2. Sort contributions from highest to lowest.</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   3. Keep only the top 10 variables.</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   4. Convert to a tidy tibble for easy plotting.</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   5. Reverse factor order so barplots appear in descending order.</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a><span class="co"># OUTPUT:</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   A tibble with two columns:</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     - variable: variable name</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     - contribution: percentage contribution to the selected PC</span></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>top10_vars <span class="ot">&lt;-</span> <span class="cf">function</span>(component) {</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>  contrib[, component] <span class="sc">|&gt;</span>                       <span class="co"># extract contributions for the given PC</span></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span>                  <span class="co"># order from strongest to weakest</span></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span>                                 <span class="co"># keep the top 10</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"variable"</span>,                  <span class="co"># convert vector to tibble</span></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">value =</span> <span class="st">"contribution"</span>) <span class="sc">|&gt;</span></span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">factor</span>(variable,          <span class="co"># ensures barplot ordering</span></span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">rev</span>(variable)))</span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_top10(): Barplot of the top 10 contributors to one PC</span></span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a><span class="co"># This function visualises the output of top10_vars().</span></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a><span class="co"># CHOICES:</span></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Horizontal bars (coord_flip) improve label readability,</span></span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a><span class="co">#     especially for gene or ASV names.</span></span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Steelblue bars + minimal theme give a clean textbook look.</span></span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a><span class="co"># OUTPUT:</span></span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   A ggplot object.</span></span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a>plot_top10 <span class="ot">&lt;-</span> <span class="cf">function</span>(component) {</span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">top10_vars</span>(component)</span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> contribution)) <span class="sc">+</span></span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span>              <span class="co"># barplot</span></span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span>                              <span class="co"># horizontal orientation</span></span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 10 Variable Contributions to PC"</span>, component),</span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Variable"</span>,</span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Contribution (%)"</span></span>
<span id="cb88-61"><a href="#cb88-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb88-62"><a href="#cb88-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-63"><a href="#cb88-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-64"><a href="#cb88-64" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb88-65"><a href="#cb88-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate barplots for PC1, PC2, and PC3</span></span>
<span id="cb88-66"><a href="#cb88-66" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb88-67"><a href="#cb88-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Each plot shows the 10 most influential variables for the</span></span>
<span id="cb88-68"><a href="#cb88-68" aria-hidden="true" tabindex="-1"></a><span class="co"># corresponding principal component.</span></span>
<span id="cb88-69"><a href="#cb88-69" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb88-70"><a href="#cb88-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Patchwork syntax (p1 / p2 / p3) stacks the three plots vertically,</span></span>
<span id="cb88-71"><a href="#cb88-71" aria-hidden="true" tabindex="-1"></a><span class="co"># producing a coherent combined figure for the textbook.</span></span>
<span id="cb88-72"><a href="#cb88-72" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb88-73"><a href="#cb88-73" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot_top10</span>(<span class="dv">1</span>)   <span class="co"># PC1 top contributors</span></span>
<span id="cb88-74"><a href="#cb88-74" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot_top10</span>(<span class="dv">2</span>)   <span class="co"># PC2 top contributors</span></span>
<span id="cb88-75"><a href="#cb88-75" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">plot_top10</span>(<span class="dv">3</span>)   <span class="co"># PC3 top contributors</span></span>
<span id="cb88-76"><a href="#cb88-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-77"><a href="#cb88-77" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create reusable objects containing the top contributors</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for the first three principal components.</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co"># These objects are used later for:</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   - reduced correlation circles</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   - reduced biplots</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   - multi-panel figures combining barplots + loadings</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co"># By computing them here, we ensure they exist globally</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="co"># throughout the chapter and avoid rendering errors.</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>top10_PC1 <span class="ot">&lt;-</span> <span class="fu">top10_vars</span>(<span class="dv">1</span>)</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>top10_PC2 <span class="ot">&lt;-</span> <span class="fu">top10_vars</span>(<span class="dv">2</span>)</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>top10_PC3 <span class="ot">&lt;-</span> <span class="fu">top10_vars</span>(<span class="dv">3</span>)</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print to confirm structure (optional)</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>top10_PC1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   variable  contribution
   &lt;fct&gt;            &lt;dbl&gt;
 1 gene_538        0.0779
 2 gene_364        0.0779
 3 gene_862        0.0776
 4 gene_415        0.0775
 5 gene_404        0.0774
 6 gene_988        0.0771
 7 gene_1247       0.0770
 8 gene_50         0.0770
 9 gene_97         0.0769
10 gene_897        0.0769</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>top10_PC2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   variable contribution
   &lt;fct&gt;           &lt;dbl&gt;
 1 ASV_10          0.394
 2 ASV_235         0.394
 3 ASV_71          0.390
 4 ASV_268         0.389
 5 ASV_292         0.389
 6 ASV_76          0.387
 7 ASV_300         0.385
 8 ASV_264         0.384
 9 ASV_246         0.384
10 ASV_225         0.383</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>top10_PC3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   variable    contribution
   &lt;fct&gt;              &lt;dbl&gt;
 1 cytokine_5         0.831
 2 cytokine_9         0.819
 3 cytokine_6         0.784
 4 cytokine_13        0.774
 5 cytokine_4         0.769
 6 cytokine_1         0.762
 7 cytokine_10        0.753
 8 cytokine_18        0.743
 9 cytokine_15        0.742
10 cytokine_8         0.738</code></pre>
</div>
</div>
</section>
<section id="interpreting-positive-and-negative-loadings-within-each-component" class="level3" data-number="7.7.5">
<h3 data-number="7.7.5" class="anchored" data-anchor-id="interpreting-positive-and-negative-loadings-within-each-component"><span class="header-section-number">7.7.5</span> Interpreting Positive and Negative Loadings Within Each Component</h3>
<p>For each principal component, variables may contribute in the same direction or in opposite directions, and this polarity becomes biologically meaningful once the geometry of PCA is understood. A variable with a large positive loading reinforces the orientation of the component, pushing individuals with high values of that variable toward the positive side of the axis. Conversely, a variable with a large negative loading exerts an influence in the opposite direction, pulling individuals toward the negative side. Positive and negative loadings therefore reflect opposing biological tendencies encoded along the same latent dimension.</p>
<p>In multi-omics settings, such as the Dermato-ATT dataset, these opposing directions often correspond to antagonistic biological processes. For example, inflammatory gene modules might define the positive direction of PC1, while barrier-restoration transcripts or commensal microbial signatures define the negative direction. Examining both sides of each axis clarifies whether a principal component reflects a true biological gradient rather than a unidirectional cluster of correlated variables.</p>
<p>The following code extracts the ten variables with the strongest positive and negative loadings for each of the first three components. Because PCA was performed on standardized variables, the loadings correspond to variable–component correlations, making the sign and magnitude directly interpretable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract strongest positive and negative loadings for a PC</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co"># INPUT:</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   component -&gt; integer index (1 = PC1)</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co"># STEPS:</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   1. Select loadings for the chosen component.</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   2. Sort in decreasing order for positive loadings.</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   3. Sort in increasing order for negative loadings.</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   4. Keep the 10 strongest on each side.</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>get_signed_loadings <span class="ot">&lt;-</span> <span class="cf">function</span>(component) {</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  load_vec <span class="ot">&lt;-</span> loadings[, component]</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>  top_pos <span class="ot">&lt;-</span> <span class="fu">sort</span>(load_vec, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>  top_neg <span class="ot">&lt;-</span> <span class="fu">sort</span>(load_vec, <span class="at">decreasing =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">positive =</span> <span class="fu">tibble</span>(<span class="at">variable =</span> <span class="fu">names</span>(top_pos),</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">loading  =</span> <span class="fu">as.numeric</span>(top_pos)),</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">negative =</span> <span class="fu">tibble</span>(<span class="at">variable =</span> <span class="fu">names</span>(top_neg),</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">loading  =</span> <span class="fu">as.numeric</span>(top_neg))</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Build signed-loading summaries for PC1–PC3</span></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>PC1_loads <span class="ot">&lt;-</span> <span class="fu">get_signed_loadings</span>(<span class="dv">1</span>)</span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>PC2_loads <span class="ot">&lt;-</span> <span class="fu">get_signed_loadings</span>(<span class="dv">2</span>)</span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>PC3_loads <span class="ot">&lt;-</span> <span class="fu">get_signed_loadings</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>PC1_loads</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$positive
# A tibble: 10 × 2
   variable  loading
   &lt;chr&gt;       &lt;dbl&gt;
 1 gene_538    0.961
 2 gene_364    0.961
 3 gene_862    0.959
 4 gene_415    0.958
 5 gene_404    0.957
 6 gene_988    0.956
 7 gene_1247   0.955
 8 gene_50     0.955
 9 gene_97     0.954
10 gene_897    0.954

$negative
# A tibble: 10 × 2
   variable      loading
   &lt;chr&gt;           &lt;dbl&gt;
 1 DLQI          -0.181 
 2 expo_28       -0.159 
 3 expo_8        -0.137 
 4 NO2           -0.115 
 5 PASI_baseline -0.0982
 6 expo_29       -0.0935
 7 expo_27       -0.0890
 8 PM10          -0.0878
 9 expo_15       -0.0656
10 expo_22       -0.0506</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>PC2_loads</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$positive
# A tibble: 10 × 2
   variable loading
   &lt;chr&gt;      &lt;dbl&gt;
 1 ASV_10     0.896
 2 ASV_235    0.896
 3 ASV_71     0.891
 4 ASV_268    0.891
 5 ASV_292    0.891
 6 ASV_76     0.888
 7 ASV_300    0.886
 8 ASV_264    0.885
 9 ASV_246    0.885
10 ASV_225    0.884

$negative
# A tibble: 10 × 2
   variable      loading
   &lt;chr&gt;           &lt;dbl&gt;
 1 gene_943       -0.134
 2 expo_6         -0.133
 3 gene_191       -0.131
 4 gene_362       -0.124
 5 gene_1349      -0.119
 6 NO2            -0.119
 7 cytokine_12    -0.105
 8 PASI_baseline  -0.103
 9 gene_659       -0.103
10 gene_1464      -0.102</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>PC3_loads</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$positive
# A tibble: 10 × 2
   variable    loading
   &lt;chr&gt;         &lt;dbl&gt;
 1 cytokine_5    0.631
 2 cytokine_9    0.627
 3 cytokine_6    0.613
 4 cytokine_13   0.609
 5 cytokine_4    0.607
 6 cytokine_1    0.605
 7 cytokine_10   0.601
 8 cytokine_18   0.597
 9 cytokine_15   0.597
10 cytokine_8    0.595

$negative
# A tibble: 10 × 2
   variable  loading
   &lt;chr&gt;       &lt;dbl&gt;
 1 gene_158   -0.516
 2 gene_721   -0.500
 3 gene_117   -0.487
 4 gene_917   -0.462
 5 gene_317   -0.461
 6 gene_1493  -0.440
 7 gene_14    -0.424
 8 gene_388   -0.402
 9 gene_1157  -0.401
10 gene_1165  -0.389</code></pre>
</div>
</div>
<p>These tables help define the biological interpretation of each PC. PC1 may separate patients along an inflammatory gradient, with high-expression inflammatory genes on the positive side and barrier-related transcripts or microbial signatures on the negative side. PC2 may separate alternative microbial communities in opposite directions, while PC3 may distinguish distinct cytokine patterns that represent systemic immune activation. By examining positive and negative contributions jointly, the latent structure of each component becomes clearer and better grounded in biological mechanisms.</p>
</section>
<section id="interpretation-unifying-contributions-and-loadings-signals" class="level3" data-number="7.7.6">
<h3 data-number="7.7.6" class="anchored" data-anchor-id="interpretation-unifying-contributions-and-loadings-signals"><span class="header-section-number">7.7.6</span> Interpretation Unifying Contributions and Loadings Signals</h3>
<p>The contribution profiles and signed loadings provide two complementary perspectives on the PCA structure: contributions show which variables build the component, while loadings reveal how strongly and in which direction they pull the component axis. Interpreting both together allows a precise reconstruction of the biological meaning of each PC.</p>
<p>PC1 – Local inflammatory transcriptomic axis</p>
<p>PC1 is dominated almost exclusively by gene-expression features. The top ten contributors all lie between 7.69% and 7.79%, an extremely tight range that indicates a highly coherent molecular module rather than isolated drivers. Their signed loadings are also extraordinarily large, with values around 0.954–0.961, meaning these genes correlate almost perfectly with the PC1 axis.</p>
<p>Biologically, this is exactly what one expects from a coordinated inflammatory programme. Such modules in real psoriasis data typically represent:</p>
<p>IL-17 / IL-23 inflammatory pathways</p>
<p>keratinocyte activation transcriptional signatures</p>
<p>generic immune up-regulation genes</p>
<p>The negative side of PC1 is weak: the strongest negative loadings (DLQI = –0.181, NO₂ = –0.115, PM10 = –0.088) are very small in magnitude compared with the gene-driven positive loadings (~0.96). This asymmetry shows that PC1 is not a balanced contrast but rather a unipolar inflammatory transcriptomic axis. High PC1 scores reflect strong up-regulation of inflammatory genes; low scores correspond to a quieter molecular state.</p>
<p>PC2 – Microbial community structure</p>
<p>PC2 presents an entirely different pattern. The top ten contributors are all microbiome ASVs with contributions between 0.383 and 0.394, nearly an order of magnitude larger than the gene contributions in PC1. Their loadings are also very strong and tightly grouped (0.884–0.896), marking a highly cohesive ecological gradient.</p>
<p>The negative loadings are again small: gene_943 (–0.134), PASI_baseline (–0.103), cytokine_12 (–0.105). This polarity shows that PC2 is another unipolar axis, now capturing a microbial dysbiosis vs.&nbsp;commensal community structure, independent of the transcriptomic signals of PC1.</p>
<p>The near-orthogonality between PC1 and PC2 directions is reflected numerically by the absence of gene or cytokine variables among the top PC2 contributors, reinforcing that PC2 encodes an orthogonal, microbiome-specific layer of variation.</p>
<p>PC3 – Systemic cytokine activation</p>
<p>PC3 is overwhelmingly dominated by cytokines. Contributions for the top 10 cytokines lie between 0.738 and 0.831, by far the largest contribution values among all PCs. The associated loadings are also very strong (0.595–0.631). This pattern reveals another tightly coordinated biological module — now representing systemic immune signalling rather than local transcriptional inflammation.</p>
<p>On the negative side, PC3 loadings include several genes (e.g., gene_158 = –0.516, gene_721 = –0.500), showing a moderate inverse relationship between certain gene modules and systemic cytokine levels. Unlike PC1 and PC2, PC3 is more balanced, with both strong positive and moderately strong negative loadings. This indicates that PC3 captures a contrast between systemic cytokine activation (positive direction) and specific gene-expression programmes (negative direction).</p>
<p>Biologically, PC3 therefore reflects systemic inflammatory activation, distinct from:</p>
<p>local/transcriptomic inflammation (PC1)</p>
<p>microbial structure (PC2)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 23%">
<col style="width: 46%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>Component</th>
<th>Dominant Contributors (numeric evidence)</th>
<th>Loadings (direction &amp; magnitude)</th>
<th>Biological Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>PC1</strong></td>
<td>Genes: 7.69–7.79% contrib</td>
<td>Very strong positive loadings 0.954–0.961; weak negatives</td>
<td>Local/transcriptomic inflammation</td>
</tr>
<tr class="even">
<td><strong>PC2</strong></td>
<td>ASVs: 0.383–0.394 contrib</td>
<td>Strong positive loadings 0.884–0.896; small negatives</td>
<td>Microbial dysbiosis / ecological gradient</td>
</tr>
<tr class="odd">
<td><strong>PC3</strong></td>
<td>Cytokines: 0.738–0.831 contrib</td>
<td>Strong positives 0.595–0.631; moderate negative gene loadings –0.516 to –0.389</td>
<td>Systemic immune activation</td>
</tr>
</tbody>
</table>
</section>
<section id="geometric-visualisation-through-scores" class="level3" data-number="7.7.7">
<h3 data-number="7.7.7" class="anchored" data-anchor-id="geometric-visualisation-through-scores"><span class="header-section-number">7.7.7</span> Geometric Visualisation Through Scores</h3>
<p>Once the PCA model has been fitted, each patient can be projected into the space defined by the principal components. These new coordinates—called scores—represent the locations of the individuals after the original high-dimensional cloud has been rotated into a smaller set of orthogonal directions.</p>
<p>The first two components often provide the most informative low-dimensional view of the data. The plot below displays the scores of all individuals along PC1 and PC2. Points are coloured according to their 12-week PASI change, but this colour gradient is not used by PCA during computation; it is merely overlaid afterward to allow qualitative inspection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span>(</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  res.pca,</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.ind =</span> df<span class="sc">$</span>Outcome_PASI12,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">gradient.cols =</span> <span class="fu">c</span>(<span class="st">"blue"</span>,<span class="st">"yellow"</span>,<span class="st">"red"</span>),</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">addEllipses =</span> <span class="cn">FALSE</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>At this stage, interpretation is deliberately limited to the geometric structure visible in the projection. PCA is an unsupervised method: it has no awareness of clinical outcomes, diagnostic groups, or biological pathways. The geometry of the scores plot reflects only the directions of maximal variance in the quantitative variables that were provided to the algorithm.</p>
<p>Several points follow from this:</p>
<p>PC1 represents the direction of greatest variation in the dataset. It is the axis along which individuals differ most strongly in terms of the original standardized variables. No biological meaning should yet be assigned to it; it is simply the mathematically dominant direction.</p>
<p>PC2 captures the second-largest remaining variation under the constraint of orthogonality. This ensures that PC1 and PC2 describe independent directions of variation, forming a natural coordinate system for exploring individual differences.</p>
<p>Distances in the scores plot approximate similarity. Individuals close together have similar profiles across all quantitative variables, whereas individuals far apart differ strongly. This geometry comes directly from the rotation and scaling inherent in PCA.</p>
<p>Colour conveys the outcome but does not influence the PCA. The gradient applied to PASI change is merely a visual overlay. Clusters or gradients in colour should not yet be interpreted as causal or mechanistic patterns; they serve only as a visual hint that outcome might align with one of the major dimensions of variation.</p>
</section>
<section id="visualising-variable-structure-the-correlation-circle-pc1pc2-focus" class="level3" data-number="7.7.8">
<h3 data-number="7.7.8" class="anchored" data-anchor-id="visualising-variable-structure-the-correlation-circle-pc1pc2-focus"><span class="header-section-number">7.7.8</span> Visualising Variable Structure: The Correlation Circle (PC1–PC2 Focus)</h3>
<p>While the scores plot reveals how patients distribute themselves across the dominant PCA axes, the correlation circle answers a complementary question:</p>
<p>Which variables shape PC1 and PC2, and how do these variables relate to each other?</p>
<p>In FactoMineR, each standardized variable is projected into the PC1–PC2 plane according to its correlation with each component. This provides a geometric summary of the high-dimensional structure after PCA has reorganised the dataset.</p>
<section id="the-standard-correlation-circle-pc1pc2" class="level4" data-number="7.7.8.1">
<h4 data-number="7.7.8.1" class="anchored" data-anchor-id="the-standard-correlation-circle-pc1pc2"><span class="header-section-number">7.7.8.1</span> The Standard Correlation Circle (PC1–PC2)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># STANDARD FULL CORRELATION CIRCLE (all variables)</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  res.pca,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.var =</span> <span class="st">"contrib"</span>,</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gradient.cols =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>),</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">repel =</span> <span class="cn">FALSE</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `aes_string()` was deprecated in ggplot2 3.0.0.
ℹ Please use tidy evaluation idioms with `aes()`.
ℹ See also `vignette("ggplot2-in-packages")` for more information.
ℹ The deprecated feature was likely used in the factoextra package.
  Please report the issue at &lt;https://github.com/kassambara/factoextra/issues&gt;.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plot displays every variable—all genes, ASVs, exposome variables, and cytokines—projected into the PC1–PC2 plane. The colour scale indicates contribution: darker red arrows exert stronger influence on the components.</p>
</section>
<section id="how-to-read-the-correlation-circle" class="level4" data-number="7.7.8.2">
<h4 data-number="7.7.8.2" class="anchored" data-anchor-id="how-to-read-the-correlation-circle"><span class="header-section-number">7.7.8.2</span> How to Read the Correlation Circle</h4>
<p>Several principles guide interpretation:</p>
<p>Distance from the origin Variables far from the centre are well represented by PC1–PC2 (high cos²). Variables near the centre are poorly explained by these two components.</p>
<p>Angle between vectors:</p>
<ul>
<li><p>Small angle → strongly positively correlated variables</p></li>
<li><p>180° apart → strongly negatively correlated variables</p></li>
</ul>
<p>90° apart → uncorrelated variables</p>
<p>Length of vectors:</p>
<p>Long arrows indicate strong correlation with the components; short arrows indicate weak correlation.</p>
<p>Clusters of arrows:</p>
<p>Groups of variables pointing in similar directions indicate biological modules:</p>
<ul>
<li><p>inflammatory gene clusters</p></li>
<li><p>microbial ASV communities</p></li>
<li><p>exposome gradients</p></li>
<li><p>cytokine signalling</p></li>
</ul>
<p>These clusters reveal the statistical manifestation of latent processes in the dataset.</p>
</section>
<section id="why-the-full-correlation-circle-fails-in-multi-omics" class="level4" data-number="7.7.8.3">
<h4 data-number="7.7.8.3" class="anchored" data-anchor-id="why-the-full-correlation-circle-fails-in-multi-omics"><span class="header-section-number">7.7.8.3</span> Why the Full Correlation Circle Fails in Multi-Omics</h4>
<p>In high-dimensional datasets (like ours, with ~2000 variables), the full correlation circle becomes:</p>
<ul>
<li><p>visually overloaded</p></li>
<li><p>unreadable due to label collisions</p></li>
<li><p>dominated by density rather than structure</p></li>
<li><p>unhelpful for identifying which specific variables drive a component</p></li>
<li><p>misleading when poorly represented variables crowd near the origin</p></li>
</ul>
<p>In short: the plot contains the right information but presents it in the wrong way.</p>
<p>What we want is a plot that:</p>
<ul>
<li>highlights the key variables</li>
<li>shows their alignment along PC1 and PC2</li>
<li>clarifies biological modules</li>
<li>avoids the “hairball” effect</li>
</ul>
<p>To fix this, we build reduced correlation circles that show only the top contributing variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  res.pca,</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">select.var =</span> <span class="fu">list</span>(<span class="at">name =</span> top10_PC1<span class="sc">$</span>variable),</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.var =</span> <span class="st">"contrib"</span>,</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gradient.cols =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>),</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">repel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Reduced Correlation Circle – Top Contributors to PC1"</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  res.pca,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">select.var =</span> <span class="fu">list</span>(<span class="at">name =</span> top10_PC2<span class="sc">$</span>variable),</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.var =</span> <span class="st">"contrib"</span>,</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gradient.cols =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>),</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">repel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Reduced Correlation Circle – Top Contributors to PC2"</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can add the circles above with the barplots already created to have an alternative representation like the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>p_PC1_bar <span class="ot">&lt;-</span> <span class="fu">plot_top10</span>(<span class="dv">1</span>)   <span class="co"># Top 10 contributors to PC1</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>p_PC2_bar <span class="ot">&lt;-</span> <span class="fu">plot_top10</span>(<span class="dv">2</span>)   <span class="co"># Top 10 contributors to PC2</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>p_PC1_circle <span class="ot">&lt;-</span> <span class="fu">fviz_pca_var</span>(</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  res.pca,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">select.var =</span> <span class="fu">list</span>(<span class="at">name =</span> top10_PC1<span class="sc">$</span>variable),</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.var =</span> <span class="st">"contrib"</span>,</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">gradient.cols =</span> <span class="fu">c</span>(<span class="st">"blue"</span>,<span class="st">"white"</span>,<span class="st">"red"</span>),</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">repel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"PC1 – Reduced Correlation Circle"</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>p_PC2_circle <span class="ot">&lt;-</span> <span class="fu">fviz_pca_var</span>(</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>  res.pca,</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">select.var =</span> <span class="fu">list</span>(<span class="at">name =</span> top10_PC2<span class="sc">$</span>variable),</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.var =</span> <span class="st">"contrib"</span>,</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">gradient.cols =</span> <span class="fu">c</span>(<span class="st">"blue"</span>,<span class="st">"white"</span>,<span class="st">"red"</span>),</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">repel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"PC2 – Reduced Correlation Circle"</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine barplots and circles for interpretability</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>(p_PC1_bar <span class="sc">|</span> p_PC1_circle) <span class="sc">/</span></span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>(p_PC2_bar <span class="sc">|</span> p_PC2_circle)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The top-left barplot lists the ten variables that contribute most to PC1. All are gene-expression features, and their contribution values are highly similar. This pattern indicates that PC1 captures a coherent transcriptomic axis along which many genes vary in a coordinated fashion.</p>
<p>In the reduced correlation circle (top-right):</p>
<ul>
<li><p>The top PC1 genes cluster tightly along the positive direction of the PC1 axis.</p></li>
<li><p>Their vectors share nearly identical angles, reflecting strong positive correlations among these genes.</p></li>
<li><p>Their distance from the origin shows that they are well represented by the first two components.</p></li>
</ul>
<p>This configuration reafirms our conclusions regarding PCs and their interpretation</p>
<p>The four panels together illustrate several important characteristics of the dataset:</p>
<ul>
<li><p>PC1 and PC2 reflect different biological layers.</p></li>
<li><p>PC1 is dominated by gene-expression variables.</p></li>
<li><p>PC2 is dominated by microbiome variables.</p></li>
</ul>
<p>The two layers are largely independent.</p>
<p>The near-orthogonality between the gene and ASV vectors indicates that transcriptional and microbial variations contribute separate, non-overlapping sources of structure.</p>
<p>The PCA axes acquire a clear biological interpretation reaffirming that PC1 can be viewed as a transcriptional variation axis and PC2 can be viewed as a microbiome-composition axis.</p>
</section>
</section>
</section>
<section id="introducing-another-example-of-interest-for-the-next-methods" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="introducing-another-example-of-interest-for-the-next-methods"><span class="header-section-number">7.8</span> Introducing another example of interest for the next methods</h2>
<p>In this second part of the chapter, we work with a compact dataset drawn from a hypothetical digital clinical trial involving 500 participants. Each patient contributes a combination of inflammatory biomarkers, wearable-sensor metrics and traditional clinical measurements collected across the study period. Although small, the dataset reflects the type of multimodal structure that routinely arises in digitally augmented trials—where physiological, behavioural and biological signals interact in ways that are often nonlinear.</p>
<p>The central goal of this dataset is to illustrate how different dimension-reduction methods reveal complementary aspects of the underlying patient landscape. Digital trials frequently involve high-frequency sensor streams, multichannel biomarkers and continuous response measures. Even when the number of features is modest, the relationships among them tend to bend, saturate, cluster locally or interact in complex ways. This makes the dataset particularly well suited for exploring methods such as t-SNE, UMAP, Self-Organizing Maps (SOMs) and Locally Linear Embedding (LLE), which are designed precisely for uncovering hidden geometry in such contexts.</p>
<p>Understanding the variables</p>
<p>Despite its simplicity, the dataset captures three major pillars typically monitored in digital clinical trials:</p>
<p>Inflammatory biomarkers (cytokine_1–cytokine_4)</p>
<p>These four measurements represent circulating cytokines commonly tracked to quantify systemic inflammatory activity and treatment effects. They reflect gradual biological shifts, intermittent rises in inflammatory tone, and coordinated behaviour across related pathways. Because cytokine responses rarely change in a straight line, these variables naturally carry curved or folded patterns—ideal for methods that focus on local biological neighbourhoods.</p>
<p>Wearable-sensor metrics (wearable_1–wearable_4)</p>
<p>These features summarise patient-level signals extracted from continuous monitoring devices such as wrist-worn sensors or patches. They capture fluctuations in rest–activity cycles, movement variability, autonomic signatures and broad physiological rhythms. Wearable data are known for their smooth transitions and subtle drifts, often producing clusters or arcs in reduced-dimensional projections.</p>
<p>Clinical assessments (clinical_1–clinical_3)</p>
<p>These variables represent conventional clinical endpoints collected during follow-up visits—composite severity scores, symptom indices, or laboratory-based measures. They anchor the digital biomarkers in clinically interpretable space and often evolve along slower trajectories that intersect with cytokine and wearable patterns.</p>
<p>Treatment response (delta_score)</p>
<p>The endpoint of interest, delta_score, reflects the change in each patient’s outcome over time. Although numerical, it encodes a combination of biological, behavioural and clinical processes, making linear separability unlikely and nonlinear shifts common. We also define a binary responder label to distinguish patients who achieved clinically meaningful improvement from those who did not.</p>
</section>
<section id="t-sne-recovering-local-biological-neighbourhoods-in-the-digital-clinical-trial-dataset" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="t-sne-recovering-local-biological-neighbourhoods-in-the-digital-clinical-trial-dataset"><span class="header-section-number">7.9</span> t-SNE: Recovering Local Biological Neighbourhoods in the Digital Clinical Trial Dataset</h2>
<p>In the second part of the chapter we work with a digital clinical-trial dataset containing multimodal information from several hundred patients—cytokine biomarkers, wearable-sensor patterns and clinical measurements. As in real advanced-therapeutic trials, these features interact in nonlinear ways: inflammatory markers rise along curved trajectories, wearable rhythms drift or bend, and clinical patterns cluster locally rather than aligning along straight axes. This makes the dataset a natural candidate for nonlinear dimension-reduction.</p>
<p>t-distributed Stochastic Neighbour Embedding (t-SNE) is designed precisely for this type of structure. Instead of searching for global linear directions, as PCA does, t-SNE focuses entirely on preserving local neighbourhoods. The algorithm assumes that what matters biologically is who each patient is similar to, not the overall orientation of the feature space. Patients with comparable cytokine profiles or wearable rhythms should remain close together even if the global geometry is curved or distorted.</p>
<p>To achieve this, t-SNE converts pairwise distances into similarity probabilities. Close patients receive high probabilities; distant ones receive values near zero. Each patient uses its own local bandwidth, controlled by the perplexity, which acts as the effective neighbourhood size. For datasets of this scale, perplexity values around 30–50 typically balance fine detail and broader structure.</p>
<p>With these similarity relationships defined, t-SNE searches for a two-dimensional layout that reproduces them. Points start in random positions and are iteratively moved so that neighbours in the original space remain neighbours in the embedding. A Student’s t distribution (with heavy tails) is used in 2-D, which forces dissimilar patients apart and prevents the crowding that occurs when collapsing high-dimensional data. The optimisation continues until the mismatch between high- and low-dimensional similarities (quantified by the KL divergence) is minimised.</p>
<p>The resulting map preserves local biological structure extremely well. Patients with similar inflammatory and wearable signatures cluster together, and smooth physiological transitions often appear as arcs or curved pathways. However, global distances should not be over-interpreted; the space is faithful locally, not globally.</p>
</section>
<section id="implementing-t-sne" class="level2" data-number="7.10">
<h2 data-number="7.10" class="anchored" data-anchor-id="implementing-t-sne"><span class="header-section-number">7.10</span> Implementing t-SNE</h2>
<p>To explore nonlinear structure in the digital clinical-trial dataset, we apply t-distributed Stochastic Neighbour Embedding (t-SNE) to the full set of numeric cytokine, wearable, and clinical measurements. Whereas PCA searches for straight, linear axes summarising the data, t-SNE reconstructs the local neighbourhoods of the original high-dimensional space. Patients who are similar across dozens of biological and digital features remain close together in the two-dimensional embedding, while patients with divergent profiles are pushed apart.</p>
<p>The workflow begins by loading the dataset and selecting only numeric variables. Identifier columns and the clinical outcome (delta_score) are removed to ensure that the embedding is driven solely by observed biological and digital signals rather than labels or outcomes. The resulting feature matrix is scaled and passed to Rtsne(), using a perplexity of 40—appropriate for a cohort of a few hundred patients, and effective at balancing fine-grained detail with broader cohort structure.</p>
<p>After t-SNE converges, we merge the two-dimensional coordinates with key variables such as the clinical response and a binary responder label. This allows us to examine how patterns in response, inflammation, or wearable behaviour map onto the learned manifold. The first plot colours each patient by delta_score, revealing the nonlinear organisation of states across the cohort.</p>
<p>The full implementation is shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rtsne)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Load the pedagogical digital trial dataset</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a> df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/att_ai_ml/DigitalTrial_ManifoldPedagogy.rds"</span>)</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="co"># assuming df is already in memory with the columns you showed</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "patient_id"  "cytokine_1"  "cytokine_2"  "cytokine_3"  "cytokine_4" 
 [6] "wearable_1"  "wearable_2"  "wearable_3"  "wearable_4"  "clinical_1" 
[11] "clinical_2"  "clinical_3"  "delta_score" "responder"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Build the feature matrix for t-SNE</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    - keep only numeric variables used as features</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    - remove identifiers and outcome / labels</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(df)[<span class="fu">sapply</span>(df, is.numeric)]</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>cols_to_remove <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"patient_id"</span>, <span class="st">"delta_score"</span>) </span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>numeric_keep <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(numeric_cols, cols_to_remove)</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>X_tsne <span class="ot">&lt;-</span> df[, numeric_keep] <span class="sc">|&gt;</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>() <span class="sc">|&gt;</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(X_tsne)   <span class="co"># should be 500 × (number of numeric predictors kept)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 500  11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Run t-SNE</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2026</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>tsne_fit <span class="ot">&lt;-</span> <span class="fu">Rtsne</span>(</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  X_tsne,</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">dims       =</span> <span class="dv">2</span>,</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">perplexity =</span> <span class="dv">40</span>,</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta      =</span> <span class="fl">0.5</span>,</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_iter   =</span> <span class="dv">1500</span>,</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose    =</span> <span class="cn">TRUE</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performing PCA
Read the 500 x 11 data matrix successfully!
Using no_dims = 2, perplexity = 40.000000, and theta = 0.500000
Computing input similarities...
Building tree...
Done in 0.02 seconds (sparsity = 0.294688)!
Learning embedding...
Iteration 50: error is 59.427653 (50 iterations in 0.02 seconds)
Iteration 100: error is 54.915475 (50 iterations in 0.02 seconds)
Iteration 150: error is 54.720570 (50 iterations in 0.02 seconds)
Iteration 200: error is 54.767592 (50 iterations in 0.02 seconds)
Iteration 250: error is 54.765601 (50 iterations in 0.01 seconds)
Iteration 300: error is 0.426183 (50 iterations in 0.02 seconds)
Iteration 350: error is 0.387879 (50 iterations in 0.01 seconds)
Iteration 400: error is 0.375316 (50 iterations in 0.01 seconds)
Iteration 450: error is 0.370638 (50 iterations in 0.01 seconds)
Iteration 500: error is 0.369975 (50 iterations in 0.01 seconds)
Iteration 550: error is 0.368768 (50 iterations in 0.01 seconds)
Iteration 600: error is 0.367549 (50 iterations in 0.01 seconds)
Iteration 650: error is 0.367283 (50 iterations in 0.01 seconds)
Iteration 700: error is 0.366735 (50 iterations in 0.01 seconds)
Iteration 750: error is 0.367664 (50 iterations in 0.01 seconds)
Iteration 800: error is 0.366811 (50 iterations in 0.01 seconds)
Iteration 850: error is 0.366994 (50 iterations in 0.01 seconds)
Iteration 900: error is 0.366301 (50 iterations in 0.01 seconds)
Iteration 950: error is 0.366323 (50 iterations in 0.01 seconds)
Iteration 1000: error is 0.365508 (50 iterations in 0.01 seconds)
Iteration 1050: error is 0.365973 (50 iterations in 0.01 seconds)
Iteration 1100: error is 0.366026 (50 iterations in 0.01 seconds)
Iteration 1150: error is 0.365795 (50 iterations in 0.01 seconds)
Iteration 1200: error is 0.365993 (50 iterations in 0.01 seconds)
Iteration 1250: error is 0.366089 (50 iterations in 0.01 seconds)
Iteration 1300: error is 0.365688 (50 iterations in 0.01 seconds)
Iteration 1350: error is 0.365264 (50 iterations in 0.01 seconds)
Iteration 1400: error is 0.365237 (50 iterations in 0.01 seconds)
Iteration 1450: error is 0.364811 (50 iterations in 0.01 seconds)
Iteration 1500: error is 0.365480 (50 iterations in 0.01 seconds)
Fitting performed in 0.42 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Merge embedding with outcome / labels</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>tsne_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tSNE1       =</span> tsne_fit<span class="sc">$</span>Y[, <span class="dv">1</span>],</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tSNE2       =</span> tsne_fit<span class="sc">$</span>Y[, <span class="dv">2</span>],</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">delta_score =</span> df<span class="sc">$</span>delta_score,</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">responder   =</span> df<span class="sc">$</span>responder</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Plot t-SNE embedding colored by response</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tsne_df, <span class="fu">aes</span>(tSNE1, tSNE2, <span class="at">colour =</span> delta_score)) <span class="sc">+</span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"t-SNE embedding of digital clinical trial features"</span>,</span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"ΔScore"</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="interpreting-the-t-sne-embedding" class="level3" data-number="7.10.1">
<h3 data-number="7.10.1" class="anchored" data-anchor-id="interpreting-the-t-sne-embedding"><span class="header-section-number">7.10.1</span> Interpreting the t-SNE embedding</h3>
<p>The t-SNE map offers a compact, two-dimensional view of how patients relate to one another across all clinical, cytokine, behavioural, and wearable features collected in the digital trial. Instead of forming neat, linear clusters, the patients occupy several curved, irregular structures—an indication that their profiles vary along nonlinear physiological and behavioural gradients rather than along simple straight axes.</p>
<p>Colours represent the clinical response (ΔScore), and the smooth transitions in colour across the map highlight that treatment response changes gradually along these trajectories. In the upper region of the map, where points cluster more tightly, patients tend to share similar cytokine levels and clinical markers, producing a band of relatively high ΔScore values. In contrast, the lower region contains a more diffuse arrangement of patients with lower response, reflecting greater heterogeneity in their wearable and behavioural patterns.</p>
<p>Although the horizontal and vertical axes have no direct interpretation in t-SNE, the spatial relationships do: patients positioned close together share highly similar multimodal profiles, while those far apart differ across several biological or digital domains. The figure therefore serves as a visual summary of how complex patient data coalesce into meaningful local neighbourhoods—highlighting where similar physiological states appear and where clinically relevant differences emerge within the cohort.</p>
</section>
<section id="faceted-t-sne-examining-individual-variable-gradients" class="level3" data-number="7.10.2">
<h3 data-number="7.10.2" class="anchored" data-anchor-id="faceted-t-sne-examining-individual-variable-gradients"><span class="header-section-number">7.10.2</span> Faceted t-SNE: examining individual variable gradients</h3>
<p>To better understand how specific trial variables vary along the manifold, we create a faceted version of the t-SNE map. Each facet displays the same two-dimensional embedding but colours the points according to a single feature, such as a cytokine, wearable metric, or clinical variable.</p>
<p>The code below constructs the faceted plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:reshape2':

    smiths</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Select variables to facet (update for new dataset)</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>vars_to_facet <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cytokine_1"</span>,</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cytokine_3"</span>,</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wearable_1"</span>,</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wearable_3"</span>,</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"clinical_1"</span>,</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"clinical_3"</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Merge embedding with the selected variables</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a>tsne_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(vars_to_facet), delta_score) <span class="sc">%&gt;%</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">tSNE1 =</span> tsne_fit<span class="sc">$</span>Y[, <span class="dv">1</span>],</span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">tSNE2 =</span> tsne_fit<span class="sc">$</span>Y[, <span class="dv">2</span>],</span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">responder =</span> <span class="fu">ifelse</span>(</span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a>      delta_score <span class="sc">&gt;</span> <span class="fu">median</span>(delta_score),</span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"High response"</span>,</span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Low response"</span></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Reshape for faceting</span></span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a>tsne_long <span class="ot">&lt;-</span> tsne_df <span class="sc">%&gt;%</span></span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb118-35"><a href="#cb118-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">all_of</span>(vars_to_facet),</span>
<span id="cb118-36"><a href="#cb118-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Variable"</span>,</span>
<span id="cb118-37"><a href="#cb118-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb118-38"><a href="#cb118-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb118-39"><a href="#cb118-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-40"><a href="#cb118-40" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb118-41"><a href="#cb118-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Faceted t-SNE plot (Figure 14.7 style)</span></span>
<span id="cb118-42"><a href="#cb118-42" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb118-43"><a href="#cb118-43" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tsne_long, <span class="fu">aes</span>(tSNE1, tSNE2, <span class="at">color =</span> Value, <span class="at">shape =</span> responder)) <span class="sc">+</span></span>
<span id="cb118-44"><a href="#cb118-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb118-45"><a href="#cb118-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Variable, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb118-46"><a href="#cb118-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb118-47"><a href="#cb118-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb118-48"><a href="#cb118-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb118-49"><a href="#cb118-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"t-SNE1 vs t-SNE2 faceted by trial variables"</span>,</span>
<span id="cb118-50"><a href="#cb118-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Colour = variable value | Shape = responder type"</span>,</span>
<span id="cb118-51"><a href="#cb118-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"tSNE1"</span>,</span>
<span id="cb118-52"><a href="#cb118-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"tSNE2"</span>,</span>
<span id="cb118-53"><a href="#cb118-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Value"</span>,</span>
<span id="cb118-54"><a href="#cb118-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"Responder"</span></span>
<span id="cb118-55"><a href="#cb118-55" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The faceted t-SNE figure shows how individual trial variables behave across the same nonlinear patient manifold. Each panel uses identical t-SNE coordinates, but colours the points by a single feature, allowing us to visually compare molecular, wearable, and clinical patterns on a shared 2-D map. Shapes indicate responder status, helping connect biological patterns with clinical improvement.</p>
<p>Across variables, consistent structure emerges. The two clinical markers display broad, smooth gradients that follow the main arms of the manifold, suggesting that clinical severity and recovery potential change gradually along patient trajectories. The cytokine variables show more localized shifts: in some regions, cytokine values rise sharply or form pockets with distinct expression levels, hinting at immune-driven sub-phenotypes embedded within the cohort. Wearable features, in contrast, tend to highlight behavioural and physiological rhythms, often producing bands or compact regions where activity or sensor-derived signals deviate from the rest of the manifold.</p>
<p>Responder shapes overlay this structure and reveal where improvement concentrates. Areas with a higher proportion of high-response patients align with zones where clinical and cytokine gradients shift favorably, whereas regions dominated by low-response patients correspond to less favourable molecular or wearable patterns. Together, these faceted panels show how diverse data modalities vary across the same patient manifold and help clarify which biological or behavioural signatures are most closely linked to treatment response.</p>
</section>
</section>
<section id="uniform-manifold-approximation-and-projection-umap" class="level2" data-number="7.11">
<h2 data-number="7.11" class="anchored" data-anchor-id="uniform-manifold-approximation-and-projection-umap"><span class="header-section-number">7.11</span> Uniform Manifold Approximation and Projection (UMAP)</h2>
<p>Where t-SNE concentrates on preserving very local neighbourhoods, UMAP approaches the problem from a geometric perspective. Instead of focusing only on pairwise similarities, UMAP attempts to learn the shape of the space in which the patients live—the manifold formed by their combined cytokine, wearable, and clinical features. Once this manifold is estimated in high dimensions, UMAP builds a lower-dimensional version that preserves both local detail and broader structural relationships.</p>
<p>This makes UMAP especially suitable for digital clinical trial data. Multimodal measurements—such as inflammatory cytokines, sensor-derived behaviour, and clinical scores—rarely follow linear directions. Instead, they tend to form curved trajectories, branching patterns, and regions with very different density, all of which UMAP captures naturally. In contrast to t-SNE, UMAP often reveals clearer large-scale organisation, produces more stable embeddings across repeated runs, and scales efficiently to datasets with many patients and features.</p>
<p>UMAP constructs its representation by assuming that the high-dimensional data lie on an underlying manifold. Around each patient, it defines a “fuzzy” neighbourhood whose width adapts to local density: tight where many similar patients cluster together, broader where data are sparse. These neighbourhoods form the weighted edges of a graph that approximates the dataset’s intrinsic structure. The algorithm then searches for a two-dimensional layout whose relationships mirror this graph as closely as possible.</p>
<section id="three-hyperparameters-control-how-umap-views-the-data" class="level3" data-number="7.11.1">
<h3 data-number="7.11.1" class="anchored" data-anchor-id="three-hyperparameters-control-how-umap-views-the-data"><span class="header-section-number">7.11.1</span> Three hyperparameters control how UMAP views the data:</h3>
<p>Several hyperparameters shape the behaviour of UMAP, and understanding them helps interpret the resulting patient manifold. The first is n_neighbors, which controls how large each neighbourhood is in the high-dimensional space. Small values make UMAP focus on very local structure, highlighting sharp molecular or behavioural transitions. Larger values smooth over these fine details and reveal broader cohort-level organisation, often producing cleaner global trajectories.</p>
<p>The min_dist hyperparameter determines how tightly points may cluster in the final embedding. When min_dist is small, UMAP allows compact, sharply defined regions; when it is larger, the map spreads points more evenly across the plane. This helps balance visual clarity with the preservation of meaningful biological variation.</p>
<p>The metric argument specifies how distances are computed in the original feature space. Euclidean distance is standard and works well for mixed clinical, cytokine, and wearable features, but alternative metrics can emphasise different relationships if needed.</p>
<p>A key practical advantage of UMAP is that, unlike t-SNE, it is deterministic when the random seed is fixed and can project new patients onto an existing embedding. This makes it suitable for machine-learning pipelines and for real-time monitoring scenarios in digital or decentralised clinical trials—where new patients may need to be visually integrated into an established patient-state manifold.</p>
</section>
<section id="implementing-umap" class="level3" data-number="7.11.2">
<h3 data-number="7.11.2" class="anchored" data-anchor-id="implementing-umap"><span class="header-section-number">7.11.2</span> Implementing UMAP</h3>
<p>The code follows the same structure: identify the numeric features to use, build the model matrix, compute the UMAP embedding, and visualise the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(umap)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Load dataset</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/att_ai_ml/DigitalTrial_ManifoldPedagogy.rds"</span>)</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Identify numeric variables</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(df)[<span class="fu">sapply</span>(df, is.numeric)]</span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove identifiers and the clinical outcome</span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>cols_to_remove <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"patient_id"</span>, <span class="st">"delta_score"</span>)</span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>numeric_keep <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(numeric_cols, cols_to_remove)</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Build UMAP feature matrix</span></span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>X_umap <span class="ot">&lt;-</span> df[, numeric_keep] <span class="sc">%&gt;%</span></span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(X_umap)   <span class="co"># should be 500 × 11 (or similar depending on dataset)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 500  11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Configure and run UMAP</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2026</span>)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>umap_config <span class="ot">&lt;-</span> umap.defaults</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>umap_config<span class="sc">$</span>n_neighbors <span class="ot">&lt;-</span> <span class="dv">20</span>      <span class="co"># size of the neighbourhood</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>umap_config<span class="sc">$</span>min_dist    <span class="ot">&lt;-</span> <span class="fl">0.15</span>    <span class="co"># cluster tightness</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>umap_config<span class="sc">$</span>metric      <span class="ot">&lt;-</span> <span class="st">"euclidean"</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>umap_fit <span class="ot">&lt;-</span> <span class="fu">umap</span>(X_umap, <span class="at">config =</span> umap_config)</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Merge embedding with the dataset</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>umap_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">UMAP1 =</span> umap_fit<span class="sc">$</span>layout[, <span class="dv">1</span>],</span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">UMAP2 =</span> umap_fit<span class="sc">$</span>layout[, <span class="dv">2</span>]</span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Plot UMAP embedding</span></span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(umap_df, <span class="fu">aes</span>(UMAP1, UMAP2, <span class="at">colour =</span> delta_score)) <span class="sc">+</span></span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.8</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"UMAP embedding of digital clinical trial features"</span>,</span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"ΔScore"</span></span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpreting-the-umap-embedding" class="level3" data-number="7.11.3">
<h3 data-number="7.11.3" class="anchored" data-anchor-id="interpreting-the-umap-embedding"><span class="header-section-number">7.11.3</span> Interpreting the UMAP embedding</h3>
<p>The UMAP embedding provides a compact view of how the digital-trial features organise across the cohort. Unlike t-SNE, which tends to emphasise very local structures, UMAP balances local and global relationships. The result is a map where patients form several smoothly connected regions, each reflecting distinct combinations of cytokine, wearable, and clinical measurements.</p>
<p>In this embedding, points are coloured by ΔScore, the trial’s continuous clinical outcome. The colour gradient makes it easy to see where stronger or weaker responses occur across the manifold. In the current figure, these patterns appear as:</p>
<p>Smooth arcs of increasing ΔScore, where neighbouring patients show gradually higher clinical response. These arcs correspond to coordinated changes across multiple clinical and digital variables.</p>
<p>Compact pockets of lower ΔScore, typically at the lower part of the manifold. These regions group patients with more limited improvement, reflecting similar biological and behavioural profiles.</p>
<p>Distinct transitions, where the colour shifts steadily from low to high values. These transitional zones often represent intermediate physiological states rather than sharp subgroup boundaries.</p>
<p>Because UMAP preserves more global geometry than t-SNE, the spacing between patient groups is informative: regions that appear close in the 2-D map correspond to patients who were genuinely similar across the high-dimensional feature set. Conversely, areas that are clearly separated reflect meaningful multi-modal differences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Select variables to facet (adapted to new dataset)</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>vars_to_facet <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cytokine_1"</span>,</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cytokine_3"</span>,</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wearable_1"</span>,</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wearable_3"</span>,</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"clinical_1"</span>,</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"clinical_3"</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Build UMAP dataframe with responder classification</span></span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a>umap_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(vars_to_facet), delta_score) <span class="sc">%&gt;%</span></span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">UMAP1 =</span> umap_fit<span class="sc">$</span>layout[, <span class="dv">1</span>],</span>
<span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">UMAP2 =</span> umap_fit<span class="sc">$</span>layout[, <span class="dv">2</span>],</span>
<span id="cb122-25"><a href="#cb122-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">responder =</span> <span class="fu">ifelse</span>(delta_score <span class="sc">&gt;</span> <span class="fu">median</span>(delta_score),</span>
<span id="cb122-26"><a href="#cb122-26" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"High response"</span>, <span class="st">"Low response"</span>)</span>
<span id="cb122-27"><a href="#cb122-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb122-28"><a href="#cb122-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-29"><a href="#cb122-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb122-30"><a href="#cb122-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Reshape for faceting</span></span>
<span id="cb122-31"><a href="#cb122-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb122-32"><a href="#cb122-32" aria-hidden="true" tabindex="-1"></a>umap_long <span class="ot">&lt;-</span> umap_df <span class="sc">%&gt;%</span></span>
<span id="cb122-33"><a href="#cb122-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb122-34"><a href="#cb122-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="fu">all_of</span>(vars_to_facet),</span>
<span id="cb122-35"><a href="#cb122-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="st">"Variable"</span>,</span>
<span id="cb122-36"><a href="#cb122-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb122-37"><a href="#cb122-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb122-38"><a href="#cb122-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-39"><a href="#cb122-39" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb122-40"><a href="#cb122-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Faceted UMAP figure (Figure 14.7 style)</span></span>
<span id="cb122-41"><a href="#cb122-41" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb122-42"><a href="#cb122-42" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(umap_long, <span class="fu">aes</span>(UMAP1, UMAP2, <span class="at">color =</span> Value, <span class="at">shape =</span> responder)) <span class="sc">+</span></span>
<span id="cb122-43"><a href="#cb122-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb122-44"><a href="#cb122-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Variable, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb122-45"><a href="#cb122-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb122-46"><a href="#cb122-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb122-47"><a href="#cb122-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb122-48"><a href="#cb122-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"UMAP1 vs UMAP2 faceted by trial variables"</span>,</span>
<span id="cb122-49"><a href="#cb122-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Color = variable value | Shape = responder type"</span>,</span>
<span id="cb122-50"><a href="#cb122-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"UMAP1"</span>,</span>
<span id="cb122-51"><a href="#cb122-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"UMAP2"</span>,</span>
<span id="cb122-52"><a href="#cb122-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Value"</span>,</span>
<span id="cb122-53"><a href="#cb122-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"Responder"</span></span>
<span id="cb122-54"><a href="#cb122-54" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The faceted UMAP view allows us to examine how individual trial variables vary across the same two-dimensional embedding. Each panel shows the identical UMAP manifold, but the points are coloured according to a specific cytokine, wearable feature, or clinical marker. This makes it possible to see whether a variable changes smoothly along the manifold, forms local peaks, or concentrates within particular patient regions.</p>
<p>Across the panels, several patterns emerge. Some clinical markers (e.g., clinical_1) show broad gradients that sweep across large areas of the embedding, suggesting they capture global physiological trends shared by multiple patient subgroups. Cytokine measurements often display more localised or curved gradients, reflecting the nonlinear biological transitions embedded in the high-dimensional space. Wearable features tend to highlight behaviourally distinct regions, with pockets of higher or lower values appearing in specific segments of the manifold.</p>
<p>Responder status, represented by point shapes, overlays an additional layer of interpretation. Regions enriched for high-response patients often coincide with specific value ranges of cytokine or wearable variables, whereas low-response patients cluster in areas characterised by different physiological or behavioural patterns. This visual alignment between variable intensity and response category helps connect mechanistic factors to clinical outcomes.</p>
</section>
<section id="comparing-t-sne-and-umap" class="level3" data-number="7.11.4">
<h3 data-number="7.11.4" class="anchored" data-anchor-id="comparing-t-sne-and-umap"><span class="header-section-number">7.11.4</span> Comparing t-SNE and UMAP</h3>
<p>t-SNE and UMAP produce visually different but complementary views of the same high-dimensional patient profiles. Plotting the two embeddings side-by-side makes it easier to understand what each method preserves and how these differences matter for clinical interpretation.</p>
<p>In this dataset, t-SNE arranges patients into several compact regions connected by curved paths. This layout emphasises local neighbourhoods: patients who look similar across cytokine, wearable, and clinical measurements cluster tightly together, but the relative spacing between different clusters should not be interpreted literally. t-SNE excels at revealing fine-grained structure and subtle transitions, which appear as smooth colour gradients in ΔScore within each local group.</p>
<p>UMAP, by contrast, produces an embedding with clearer global organisation. Patient regions that appear distinct under t-SNE often unfold into a broader continuum under UMAP, making large-scale gradients in ΔScore easier to interpret. Neighbourhoods remain coherent, but their arrangement reflects genuine similarities in the original multimodal space, allowing global distances to carry meaning.</p>
<p>When compared side-by-side, the two methods highlight complementary aspects of the trial cohort:</p>
<p>t-SNE reveals tight micro-structures and local continuity in patient profiles.</p>
<p>UMAP reveals broader clinical pathways and how patient subpopulations relate to one another.</p>
<p>Viewing both embeddings together provides a richer picture of the cohort, helping identify regions of consistent improvement, areas of mixed response, and potential mechanistic subtypes that may warrant deeper investigation.</p>
<p>The code below generates the side-by-side comparison:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co"># t-SNE plot</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>p_tsne <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tsne_df, <span class="fu">aes</span>(tSNE1, tSNE2, <span class="at">colour =</span> delta_score)) <span class="sc">+</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.6</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"t-SNE embedding"</span>,</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a><span class="at">colour =</span> <span class="st">"ΔScore"</span></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a><span class="co"># UMAP plot</span></span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>p_umap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(umap_df, <span class="fu">aes</span>(UMAP1, UMAP2, <span class="at">colour =</span> delta_score)) <span class="sc">+</span></span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.6</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"UMAP embedding"</span>,</span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a><span class="at">colour =</span> <span class="st">"ΔScore"</span></span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Side-by-side</span></span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>p_tsne <span class="sc">+</span> p_umap <span class="sc">+</span></span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_annotation</span>(</span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"Comparison of t-SNE and UMAP embeddings"</span>,</span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"t-SNE preserves local neighbourhoods; UMAP captures both local and global structure"</span></span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="high_dims_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/danilosarti\.github\.io\/att_ml_ai_book");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro_missing.html" class="pagination-link" aria-label="Introduction to missing data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to missing data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./clustering.html" class="pagination-link" aria-label="Clustering">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Clustering</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>