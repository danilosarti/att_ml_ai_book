<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Introduction to Bayesian methods – Introduction to Machine Learning and AI for Health and Sciences</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./intro_missing.html" rel="next">
<link href="./neural_networks.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./introd_bayesian.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Bayesian methods</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Machine Learning and AI for Health and Sciences</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction_AI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to AI and Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supervised_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Supervised Learning: Regression tasks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./three_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Supervised Learning: Tree Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./neural_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Neural networks and deep learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introd_bayesian.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Bayesian methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_missing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to missing data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./high_dims.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">High Dimension Data Strategies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Clustering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interpretable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Interpretable AI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./genai_foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">GenAI: Foundations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./genai_app.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">GenAI: Applications</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation"><span class="header-section-number">5.1</span> Motivation</a></li>
  <li><a href="#understanding-probabilities-models-and-likelihood" id="toc-understanding-probabilities-models-and-likelihood" class="nav-link" data-scroll-target="#understanding-probabilities-models-and-likelihood"><span class="header-section-number">5.2</span> Understanding Probabilities, Models, and Likelihood</a></li>
  <li><a href="#what-is-statistical-inference" id="toc-what-is-statistical-inference" class="nav-link" data-scroll-target="#what-is-statistical-inference"><span class="header-section-number">5.3</span> What is statistical inference?</a>
  <ul class="collapse">
  <li><a href="#frequentist-inference." id="toc-frequentist-inference." class="nav-link" data-scroll-target="#frequentist-inference."><span class="header-section-number">5.3.1</span> Frequentist inference.</a></li>
  <li><a href="#bayesian-inference." id="toc-bayesian-inference." class="nav-link" data-scroll-target="#bayesian-inference."><span class="header-section-number">5.3.2</span> Bayesian inference.</a></li>
  </ul></li>
  <li><a href="#the-likelihood-function" id="toc-the-likelihood-function" class="nav-link" data-scroll-target="#the-likelihood-function"><span class="header-section-number">5.4</span> The likelihood function</a></li>
  <li><a href="#maximum-likelihood-estimation-mle-one-of-the-fundamental-frequentist-strategies-is-to-choose-the-parameter-value-that-maximises-the-likelihood" id="toc-maximum-likelihood-estimation-mle-one-of-the-fundamental-frequentist-strategies-is-to-choose-the-parameter-value-that-maximises-the-likelihood" class="nav-link" data-scroll-target="#maximum-likelihood-estimation-mle-one-of-the-fundamental-frequentist-strategies-is-to-choose-the-parameter-value-that-maximises-the-likelihood"><span class="header-section-number">5.5</span> Maximum likelihood estimation (MLE) One of the fundamental frequentist strategies is to choose the parameter value that maximises the likelihood:</a></li>
  <li><a href="#introducing-bayesian-reasoning" id="toc-introducing-bayesian-reasoning" class="nav-link" data-scroll-target="#introducing-bayesian-reasoning"><span class="header-section-number">5.6</span> Introducing Bayesian reasoning</a>
  <ul class="collapse">
  <li><a href="#bayes-theorem" id="toc-bayes-theorem" class="nav-link" data-scroll-target="#bayes-theorem"><span class="header-section-number">5.6.1</span> Bayes Theorem</a></li>
  </ul></li>
  <li><a href="#bayesian-linear-regression" id="toc-bayesian-linear-regression" class="nav-link" data-scroll-target="#bayesian-linear-regression"><span class="header-section-number">5.7</span> Bayesian linear regression</a>
  <ul class="collapse">
  <li><a href="#frequentist-vs-bayesian-regression" id="toc-frequentist-vs-bayesian-regression" class="nav-link" data-scroll-target="#frequentist-vs-bayesian-regression"><span class="header-section-number">5.7.1</span> Frequentist vs Bayesian Regression</a></li>
  <li><a href="#frequentist-regression-example" id="toc-frequentist-regression-example" class="nav-link" data-scroll-target="#frequentist-regression-example"><span class="header-section-number">5.7.2</span> Frequentist Regression Example</a></li>
  </ul></li>
  <li><a href="#bayesian-linear-regression-model-specification" id="toc-bayesian-linear-regression-model-specification" class="nav-link" data-scroll-target="#bayesian-linear-regression-model-specification"><span class="header-section-number">5.8</span> Bayesian Linear Regression Model Specification</a>
  <ul class="collapse">
  <li><a href="#understanding-mcmc-how-bayesian-posteriors-are-computed" id="toc-understanding-mcmc-how-bayesian-posteriors-are-computed" class="nav-link" data-scroll-target="#understanding-mcmc-how-bayesian-posteriors-are-computed"><span class="header-section-number">5.8.1</span> Understanding MCMC: how Bayesian posteriors are computed</a></li>
  <li><a href="#the-stan-approach-hamiltonian-monte-carlo-hmc" id="toc-the-stan-approach-hamiltonian-monte-carlo-hmc" class="nav-link" data-scroll-target="#the-stan-approach-hamiltonian-monte-carlo-hmc"><span class="header-section-number">5.8.2</span> The Stan approach: Hamiltonian Monte Carlo (HMC)</a></li>
  <li><a href="#inspecting-the-mcmc-samples" id="toc-inspecting-the-mcmc-samples" class="nav-link" data-scroll-target="#inspecting-the-mcmc-samples"><span class="header-section-number">5.8.3</span> Inspecting the MCMC samples</a></li>
  <li><a href="#mcmc-diagnostics" id="toc-mcmc-diagnostics" class="nav-link" data-scroll-target="#mcmc-diagnostics"><span class="header-section-number">5.8.4</span> MCMC Diagnostics</a></li>
  <li><a href="#interpretation-of-posterior-weights" id="toc-interpretation-of-posterior-weights" class="nav-link" data-scroll-target="#interpretation-of-posterior-weights"><span class="header-section-number">5.8.5</span> Interpretation of Posterior Weights</a></li>
  <li><a href="#posteriors-of-the-weights" id="toc-posteriors-of-the-weights" class="nav-link" data-scroll-target="#posteriors-of-the-weights"><span class="header-section-number">5.8.6</span> Posteriors of the weights</a></li>
  <li><a href="#credible-intervals-vs-confidence-intervals" id="toc-credible-intervals-vs-confidence-intervals" class="nav-link" data-scroll-target="#credible-intervals-vs-confidence-intervals"><span class="header-section-number">5.8.7</span> Credible Intervals vs Confidence Intervals</a></li>
  <li><a href="#frequentist-vs-bayesian-comparison-table" id="toc-frequentist-vs-bayesian-comparison-table" class="nav-link" data-scroll-target="#frequentist-vs-bayesian-comparison-table"><span class="header-section-number">5.8.8</span> Frequentist vs Bayesian comparison table</a></li>
  </ul></li>
  <li><a href="#posterior-distributions-and-treatment-of-pure-risk-measures" id="toc-posterior-distributions-and-treatment-of-pure-risk-measures" class="nav-link" data-scroll-target="#posterior-distributions-and-treatment-of-pure-risk-measures"><span class="header-section-number">5.9</span> Posterior distributions and treatment of pure risk measures</a>
  <ul class="collapse">
  <li><a href="#why-bayesian-risk-modelling-is-more-intuitive" id="toc-why-bayesian-risk-modelling-is-more-intuitive" class="nav-link" data-scroll-target="#why-bayesian-risk-modelling-is-more-intuitive"><span class="header-section-number">5.9.1</span> Why Bayesian risk modelling is more intuitive</a></li>
  <li><a href="#bayesian-modelling-of-event-risk-in-the-wearable-sensor-dataset" id="toc-bayesian-modelling-of-event-risk-in-the-wearable-sensor-dataset" class="nav-link" data-scroll-target="#bayesian-modelling-of-event-risk-in-the-wearable-sensor-dataset"><span class="header-section-number">5.9.2</span> Bayesian modelling of event risk in the wearable-sensor dataset</a></li>
  </ul></li>
  <li><a href="#bayesian-tree-models" id="toc-bayesian-tree-models" class="nav-link" data-scroll-target="#bayesian-tree-models"><span class="header-section-number">5.10</span> Bayesian tree models</a>
  <ul class="collapse">
  <li><a href="#bart-possibilities" id="toc-bart-possibilities" class="nav-link" data-scroll-target="#bart-possibilities"><span class="header-section-number">5.10.1</span> BART possibilities</a></li>
  <li><a href="#fitting-bart-with-r" id="toc-fitting-bart-with-r" class="nav-link" data-scroll-target="#fitting-bart-with-r"><span class="header-section-number">5.10.2</span> Fitting BART with R</a></li>
  </ul></li>
  <li><a href="#bayesian-tree-models-complementing-random-forests-and-xgboost" id="toc-bayesian-tree-models-complementing-random-forests-and-xgboost" class="nav-link" data-scroll-target="#bayesian-tree-models-complementing-random-forests-and-xgboost"><span class="header-section-number">5.11</span> Bayesian Tree Models: Complementing Random Forests and XGBoost</a>
  <ul class="collapse">
  <li><a href="#running-rf-and-xgboosst" id="toc-running-rf-and-xgboosst" class="nav-link" data-scroll-target="#running-rf-and-xgboosst"><span class="header-section-number">5.11.1</span> Running RF and Xgboosst</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Bayesian methods</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="motivation" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="motivation"><span class="header-section-number">5.1</span> Motivation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Reload example</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------------------------------</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>wearable_complete <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/att_ai_ml/att_book/data/dct_wearable_complete.rds"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wearable_complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   500 obs. of  10 variables:
 $ age                  : num  63 47 50 49 66 49 74 26 58 53 ...
 $ baseline_inflammation: num  4.08 3.51 3.54 3.86 3 ...
 $ frailty              : num  0.453 0.441 0.346 0.539 0.454 ...
 $ resting_hr           : num  83.8 63.7 69.8 67.5 83.6 ...
 $ hrv                  : num  29.2 30 20.9 45.5 44 ...
 $ skin_temp            : num  36 34.4 34.7 34.4 34.7 ...
 $ activity_index       : num  27.1 60.7 27.3 37.2 38.5 ...
 $ stress_score         : num  101.6 95.9 96.8 91.3 85.9 ...
 $ event_risk           : num  0.993 0.976 0.976 0.982 0.971 ...
 $ event_occurred       : int  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<p>In this chapter we work with a simulated dataset representing a decentralised clinical trial in which participants are monitored remotely through wearable devices. Although simulated, the structure mirrors the data routinely collected in contemporary digital-health and pharmaceutical pipelines. Each participant contributes baseline clinical information such as age, frailty, and an inflammation score derived from laboratory markers. Alongside these features, the dataset includes continuous physiological measurements obtained from a wearable sensor: resting heart rate, heart rate variability, skin temperature, and a general activity index capturing daily mobility. A composite stress score summarises overall physiological load, and the dataset also contains a modelled probability of clinical deterioration and a binary indicator of adverse events.</p>
<p>Examples like this matter because wearable-derived variables have become central to modern clinical research. Remote monitoring gives investigators the ability to observe physiological dynamics as they unfold in real life rather than only during scheduled clinic visits. Signals such as HRV, resting heart rate, skin temperature, and activity levels are already used as exploratory or surrogate endpoints in ongoing studies by major pharmaceutical companies, and several digital biomarkers are beginning to receive regulatory attention. These measurements also tend to co-move in structured, physiologically meaningful ways: inflammation and frailty are associated with increases in resting heart rate and skin temperature; HRV declines with age and clinical burden; activity levels fall as frailty rises; and an overall stress score reflects these interacting components.</p>
</section>
<section id="understanding-probabilities-models-and-likelihood" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="understanding-probabilities-models-and-likelihood"><span class="header-section-number">5.2</span> Understanding Probabilities, Models, and Likelihood</h2>
<p>Before discussing Bayesian reasoning, we need a shared language for uncertainty. A probability distribution describes how likely different outcomes or parameter values are. For example, resting heart rate recorded by a wearable sensor fluctuates across individuals and days, and part of that variability can be captured by a distribution such as a Normal or Log-Normal.</p>
<p>A probability distribution provides:</p>
<ul>
<li><p>A sample space: all possible values (e.g., heart rate 40–120 bpm)</p></li>
<li><p>A way to assign likelihood to values</p></li>
<li><p>A mathematical structure for modelling variation</p></li>
<li><p>Knowing a distribution allows us to compute quantities such as:</p>
<ul>
<li><p>the probability that resting heart rate exceeds 80 bpm</p></li>
<li><p>the expected average HRV in a population</p></li>
<li><p>the density at specific values</p></li>
</ul></li>
</ul>
<p>Example in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># probability heart rate &gt; 80 under a Normal(70,8)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="dv">80</span>, <span class="at">mean =</span> <span class="dv">70</span>, <span class="at">sd =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1056498</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># density at HR = 75</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dnorm</span>(<span class="dv">75</span>, <span class="at">mean =</span> <span class="dv">70</span>, <span class="at">sd =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.04102012</code></pre>
</div>
</div>
<p>Many physiological measurements in decentralised clinical trials—such as resting heart rate, HRV, skin temperature, or daily activity—are well approximated by a normal distribution. A probability density curve summarises how likely different values are. The peak indicates the most plausible range (around the mean), and the spread reflects biological variability (captured by the standard deviation).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters for illustration</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>mu  <span class="ot">&lt;-</span> <span class="dv">70</span>     <span class="co"># mean</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>sd  <span class="ot">&lt;-</span> <span class="dv">8</span>      <span class="co"># standard deviation</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(mu <span class="sc">-</span> <span class="dv">4</span><span class="sc">*</span>sd, mu <span class="sc">+</span> <span class="dv">4</span><span class="sc">*</span>sd, <span class="at">length.out =</span> <span class="dv">800</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>df_norm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> grid,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">density =</span> <span class="fu">dnorm</span>(grid, <span class="at">mean =</span> mu, <span class="at">sd =</span> sd)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_norm, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#1f77b4"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> mu, <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> mu, <span class="at">y =</span> <span class="fu">max</span>(df_norm<span class="sc">$</span>density)<span class="sc">*</span><span class="fl">0.95</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"mean ="</span>, mu), <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normal Distribution (μ = 70, σ = 8)"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Value"</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="introd_bayesian_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-is-statistical-inference" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="what-is-statistical-inference"><span class="header-section-number">5.3</span> What is statistical inference?</h2>
<p>Statistical inference concerns the process of learning about unknown aspects of a population or a data-generating process using observed data. The central objective is to use measurements collected in a sample to draw conclusions about quantities that cannot be observed directly.</p>
<p>In the context of wearable-sensor data from a decentralised clinical trial, several inferential questions arise naturally:</p>
<p>– What is the true mean resting heart rate in the trial population? – How strongly is frailty associated with heart-rate variability? – What is the probability that an individual will experience an adverse event, given their physiological profile?</p>
<p>To answer such questions, we adopt a statistical model describing how the observed measurements arise. Statistical inference then consists of using the model and the observed data to learn about the unknown model parameters.</p>
<p>Two major inferential paradigms are commonly used.</p>
<section id="frequentist-inference." class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="frequentist-inference."><span class="header-section-number">5.3.1</span> Frequentist inference.</h3>
<p>Here, the parameters of the model are treated as fixed but unknown constants. Randomness arises only from the repeated sampling of data. Estimation therefore focuses on identifying the single parameter values that best explain the observed data.</p>
</section>
<section id="bayesian-inference." class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="bayesian-inference."><span class="header-section-number">5.3.2</span> Bayesian inference.</h3>
<p>In the Bayesian framework, the data are treated as fixed once observed, and uncertainty is expressed through probability distributions over the parameters themselves. The aim is to describe this uncertainty before and after observing the data.</p>
<p>Despite their conceptual differences, both approaches rely on the same fundamental building block: the likelihood.</p>
</section>
</section>
<section id="the-likelihood-function" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="the-likelihood-function"><span class="header-section-number">5.4</span> The likelihood function</h2>
<p>The likelihood function quantifies how compatible a set of parameter values is with the observed data. It is derived from the assumed probability model for the measurements.</p>
<p>Suppose resting heart rate in the trial is modelled as</p>
<p><span class="math display">\[
y_i \sim \mathcal{N}\left(\mu, \sigma^2\right),
\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the population mean and <span class="math inline">\(\sigma^2\)</span> is the measurement variability. For a sample <span class="math inline">\(y_1, \ldots, y_n\)</span>, the likelihood of <span class="math inline">\(\mu\)</span> is</p>
<p><span class="math display">\[
L(\mu)=\prod_{i=1}^n f\left(y_i \mid \mu\right),
\]</span></p>
<p>where <span class="math inline">\(f(\cdot)\)</span> is the Normal density. Although <span class="math inline">\(f(\cdot)\)</span> is interpreted as a probability density when viewed as a function of <span class="math inline">\(y_i\)</span>, it becomes a likelihood when viewed as a function of <span class="math inline">\(\mu\)</span> with the data held fixed. Higher likelihood values indicate that a given value of <span class="math inline">\(\mu\)</span> provides a better explanation of the observed data.</p>
<p>A simple example in R illustrates this idea:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>likelihood <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, y, sigma) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prod</span>(<span class="fu">dnorm</span>(y, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span> <span class="dv">72</span>, <span class="at">sd =</span> <span class="dv">8</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">likelihood</span>(<span class="dv">70</span>, y, <span class="at">sigma =</span> <span class="dv">8</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.95254e-15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">likelihood</span>(<span class="dv">72</span>, y, <span class="at">sigma =</span> <span class="dv">8</span>)  <span class="co"># larger: μ = 72 fits better</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.616298e-15</code></pre>
</div>
</div>
<p>Because likelihoods often take extremely small values, it is common to work with the log-likelihood:</p>
<p><span class="math display">\[
\ell(\mu)=\log L(\mu)=-\frac{n}{2} \log \left(2 \pi \sigma^2\right)-\frac{1}{2 \sigma^2} \sum_{i=1}^n\left(y_i-\mu\right)^2 .
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">mean =</span> <span class="dv">72</span>, <span class="at">sd =</span> <span class="dv">8</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># grid of candidate means</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">60</span>, <span class="dv">85</span>, <span class="at">length.out =</span> <span class="dv">400</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># compute likelihood of each μ (up to a proportionality constant)</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>lik_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(mu_grid, <span class="cf">function</span>(mu) {</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prod</span>(<span class="fu">dnorm</span>(y, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># normalise for visualisation</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>lik_values_scaled <span class="ot">&lt;-</span> lik_values <span class="sc">/</span> <span class="fu">max</span>(lik_values)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>df_lik <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu   =</span> mu_grid,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">like =</span> lik_values_scaled</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_lik, <span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> like)) <span class="sc">+</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.4</span>, <span class="at">color =</span> <span class="st">"#ff7f0e"</span>) <span class="sc">+</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Likelihood Function for μ"</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">expression</span>(mu),</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Likelihood (scaled to 1)"</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="introd_bayesian_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="maximum-likelihood-estimation-mle-one-of-the-fundamental-frequentist-strategies-is-to-choose-the-parameter-value-that-maximises-the-likelihood" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="maximum-likelihood-estimation-mle-one-of-the-fundamental-frequentist-strategies-is-to-choose-the-parameter-value-that-maximises-the-likelihood"><span class="header-section-number">5.5</span> Maximum likelihood estimation (MLE) One of the fundamental frequentist strategies is to choose the parameter value that maximises the likelihood:</h2>
<p><span class="math display">\[
\hat{\mu}_{\mathrm{MLE}}=\arg \max _\mu L(\mu) .
\]</span></p>
<p>For the Normal model with known <span class="math inline">\(\sigma\)</span>, the MLE has a closed form:</p>
<p><span class="math display">\[
\hat{\mu}_{\mathrm{MLE}}=\bar{y} .
\]</span></p>
<p>This result is intuitive: the value of <span class="math inline">\(\mu\)</span> that makes the observed data most probable is the sample mean.</p>
<p>In R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ybar <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ybar  <span class="co"># MLE of μ</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 73.52419</code></pre>
</div>
</div>
<p>For more complex models-such as logistic regression for event risk or hierarchical models describing physiological dependencies-likelihood maximisation may require numerical optimisation (e.g., via optim ( ) or specialized software). Regardless of complexity, the principle is the same: the best-fitting parameter values are those that produce the highest likelihood.</p>
<p>The Bayesian approach, introduced in the next section, expands on this idea by combining the likelihood with prior information to produce a full posterior distribution over the parameters rather than a single best value.</p>
</section>
<section id="introducing-bayesian-reasoning" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="introducing-bayesian-reasoning"><span class="header-section-number">5.6</span> Introducing Bayesian reasoning</h2>
<p>Bayesian modelling provides a coherent framework for reasoning under uncertainty, particularly in digital-health and wearable-sensor settings where physiological signals vary across individuals, time, and context. The central idea is that parameters—such as the average resting heart rate in a decentralised clinical trial—are treated as uncertain quantities, and this uncertainty is represented through probability distributions. Once the data have been collected, they are considered fixed, and all remaining uncertainty lies in the parameters themselves.</p>
<p>This perspective contrasts with the frequentist view but relies on the same building blocks: a probabilistic model for the measurements and the likelihood. What distinguishes Bayesian reasoning is the explicit incorporation of prior knowledge and a formal rule for updating uncertainty as new data arrive.</p>
<section id="bayes-theorem" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="bayes-theorem"><span class="header-section-number">5.6.1</span> Bayes Theorem</h3>
<p>Bayesian inference is grounded in a single identity-Bayes’ theorem-which combines prior information with the likelihood contributed by the data:</p>
<p><span class="math display">\[
p(\theta \mid y)=\frac{p(y \mid \theta) p(\theta)}{p(y)} .
\]</span></p>
<p>Where: - <span class="math inline">\(p(\theta)\)</span> is the prior distribution, representing what is known (or assumed) before observing any wearable data; - <span class="math inline">\(p(y \mid \theta)\)</span> is the likelihood, describing how plausible the observed measurements are for different values of <span class="math inline">\(\theta\)</span>; - <span class="math inline">\(p(\theta \mid y)\)</span> is the posterior distribution, reflecting updated beliefs after the data are observed; - <span class="math inline">\(p(y)\)</span> is the marginal likelihood, ensuring that the posterior integrates to one.</p>
<p>In proportional form:</p>
<p><span class="math display">\[
p(\theta \mid y) \propto p(y \mid \theta) p(\theta),
\]</span></p>
<p>which makes Bayesian inference appear as a learning rule: new evidence reshapes prior beliefs.</p>
<p>A small numerical example of Bayes’ theorem in R To illustrate how Bayes’ theorem works in practice, consider estimating the probability that a participant is highly frail after observing an elevated resting heart rate (&gt;85 bpm).</p>
<p>We assume: - prior probability of high frailty: <span class="math inline">\(p(F=1)=0.30\)</span>; - probability of high HR given frailty: <span class="math inline">\(p(H R&gt;85 \mid F=1)=0.55\)</span>; - probability of high HR given low frailty: <span class="math inline">\(p(H R&gt;85 \mid F=0)=0.12\)</span>.</p>
<p>Using Bayes’ rule:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>p_frail <span class="ot">&lt;-</span> <span class="fl">0.30</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>p_notfrail <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> p_frail</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>p_hr_given_frail <span class="ot">&lt;-</span> <span class="fl">0.55</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>p_hr_given_notfrail <span class="ot">&lt;-</span> <span class="fl">0.12</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> (p_hr_given_frail <span class="sc">*</span> p_frail) <span class="sc">/</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  (p_hr_given_frail <span class="sc">*</span> p_frail <span class="sc">+</span> p_hr_given_notfrail <span class="sc">*</span> p_notfrail)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>posterior</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6626506</code></pre>
</div>
</div>
<p>This calculation yields a posterior probability of approximately 66%, showing how relevant physiological evidence (elevated HR) increases our belief that an individual is frail.</p>
<p>Bayesian updating in physiological monitoring This updating mechanism mirrors clinical reasoning. A clinician assessing resting heart rate or HRV carries implicit prior expectations (based on age, frailty, or inflammatory status) and adjusts these expectations as new wearable-sensor data accumulate. Bayesian models offer a transparent and principled way to represent this process. Priors stabilise inference when data are sparse or noisy; as evidence grows, the likelihood takes over and the posterior becomes increasingly data-driven.</p>
<p>To illustrate Bayesian updating more formally, consider estimating the mean resting heart rate <span class="math inline">\(\mu\)</span> in the trial. Assume that the observed values <span class="math inline">\(y_1, \ldots, y_n\)</span> follow a Normal model with known measurement variability. A prior distribution encodes initial beliefs about <span class="math inline">\(\mu_1\)</span>, and the wearable data update these beliefs through the likelihood, yielding a posterior distribution.</p>
<p>The figure below shows the prior, the likelihood scaled for comparison, and the posterior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated dataset (resting heart rate)</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">72</span>, <span class="at">sd =</span> <span class="dv">8</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>n  <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>ybar <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">8</span>  <span class="co"># assumed known measurement variability</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior: μ ~ Normal(70, 10^2)</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>mu_prior_mean <span class="ot">&lt;-</span> <span class="dv">70</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>mu_prior_sd   <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior parameters (Normal-Normal updating)</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>posterior_mean <span class="ot">&lt;-</span> ( (mu_prior_mean <span class="sc">/</span> mu_prior_sd<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (n <span class="sc">*</span> ybar <span class="sc">/</span> sigma<span class="sc">^</span><span class="dv">2</span>) ) <span class="sc">/</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                  ( (<span class="dv">1</span> <span class="sc">/</span> mu_prior_sd<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (n <span class="sc">/</span> sigma<span class="sc">^</span><span class="dv">2</span>) )</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>posterior_sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>( <span class="dv">1</span> <span class="sc">/</span> ( (<span class="dv">1</span> <span class="sc">/</span> mu_prior_sd<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (n <span class="sc">/</span> sigma<span class="sc">^</span><span class="dv">2</span>) ) )</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Build grid</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">50</span>, <span class="dv">90</span>, <span class="at">length.out =</span> <span class="dv">800</span>)</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>prior_density      <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(grid, mu_prior_mean,   mu_prior_sd)</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>posterior_density  <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(grid, posterior_mean, posterior_sd)</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood of μ (scaled for plotting)</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>likelihood_raw <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(ybar, <span class="at">mean =</span> grid, <span class="at">sd =</span> sigma<span class="sc">/</span><span class="fu">sqrt</span>(n))</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>likelihood_density <span class="ot">&lt;-</span> likelihood_raw <span class="sc">/</span> <span class="fu">max</span>(likelihood_raw) <span class="sc">*</span> <span class="fu">max</span>(prior_density)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Build tidy dataframe</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> grid,</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">Prior      =</span> prior_density,</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">Likelihood =</span> likelihood_density,</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">Posterior  =</span> posterior_density</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"Prior"</span>, <span class="st">"Likelihood"</span>, <span class="st">"Posterior"</span>),</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Distribution"</span>,</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Density"</span>)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> Density, <span class="at">color =</span> Distribution)) <span class="sc">+</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.4</span>) <span class="sc">+</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Prior"</span> <span class="ot">=</span> <span class="st">"#1f77b4"</span>,</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Likelihood"</span> <span class="ot">=</span> <span class="st">"#ff7f0e"</span>,</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Posterior"</span> <span class="ot">=</span> <span class="st">"#2ca02c"</span></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Bayesian Updating: Prior, Likelihood, and Posterior"</span>,</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">expression</span>(mu),</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density (scaled)"</span></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="introd_bayesian_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="bayesian-linear-regression" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="bayesian-linear-regression"><span class="header-section-number">5.7</span> Bayesian linear regression</h2>
<p>Once we understand Bayesian updating in the one-parameter case, the next step is to extend the framework to regression. Regression is a natural modelling tool in decentralised clinical trials: we may wish to quantify how frailty influences resting heart rate, how inflammation shifts HRV, or how physiological variables interact.</p>
<p>In the frequentist framework, a regression yields point estimates of the regression coefficients. In the Bayesian framework, these coefficients—now denoted by weights w are treated as uncertain quantities with full posterior distributions.</p>
<p>This section introduces Bayesian linear regression using the wearable dataset and compares it to classical (frequentist) regression while highlighting conceptual and interpretational differences.</p>
<section id="frequentist-vs-bayesian-regression" class="level3" data-number="5.7.1">
<h3 data-number="5.7.1" class="anchored" data-anchor-id="frequentist-vs-bayesian-regression"><span class="header-section-number">5.7.1</span> Frequentist vs Bayesian Regression</h3>
<p>A simple linear model for resting heart rate may be written as:</p>
<p><span class="math display">\[
\mathrm{HR}_i=w_0+w_1 \cdot \text { frailty }_i+\varepsilon_i, \quad \varepsilon_i \sim \mathcal{N}\left(0, \sigma^2\right) .
\]</span></p>
<p>Frequentist OLS: - The weights <span class="math inline">\(w_0\)</span> and <span class="math inline">\(w_1\)</span> are fixed but unknown constants. - Data are random due to sampling variability. - Estimates <span class="math inline">\(\hat{w}_0, \hat{w}_1\)</span> maximise the likelihood. - Uncertainty is summarised via confidence intervals and p-values.</p>
<p>Bayesian regression: - Data are fixed once observed. - The weights <span class="math inline">\(w_0, w_1\)</span> and variance <span class="math inline">\(\sigma^2\)</span> are uncertain, with probability distributions. - The inferential target is the posterior:</p>
<p><span class="math display">\[
p\left(w_0, w_1, \sigma \mid y, x\right),
\]</span></p>
<p>which describes all plausible values for the weights given the data and prior assumptions.</p>
<p>This allows Bayesian models to answer questions that classical models cannot-e.g., “What is the probability that frailty increases resting heart rate?” (i.e., <span class="math inline">\(\operatorname{Pr}\left(w_1&gt;0 \mid\right.\)</span> data))</p>
</section>
<section id="frequentist-regression-example" class="level3" data-number="5.7.2">
<h3 data-number="5.7.2" class="anchored" data-anchor-id="frequentist-regression-example"><span class="header-section-number">5.7.2</span> Frequentist Regression Example</h3>
<p>We begin with a traditional OLS model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fit_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(resting_hr <span class="sc">~</span> frailty, <span class="at">data =</span> wearable_complete)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = resting_hr ~ frailty, data = wearable_complete)

Residuals:
    Min      1Q  Median      3Q     Max 
-26.863  -8.548   0.353   8.478  33.170 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   51.064      1.532   33.34   &lt;2e-16 ***
frailty       47.618      3.652   13.04   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11.15 on 498 degrees of freedom
Multiple R-squared:  0.2545,    Adjusted R-squared:  0.253 
F-statistic:   170 on 1 and 498 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>This output includes: - point estimates for <span class="math inline">\(w_0\)</span> and <span class="math inline">\(w_1\)</span>; - standard errors; - p-values; - confidence intervals.</p>
<p>These objects quantify sampling variability, but they do not provide probability statements about the weights themselves.</p>
</section>
</section>
<section id="bayesian-linear-regression-model-specification" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="bayesian-linear-regression-model-specification"><span class="header-section-number">5.8</span> Bayesian Linear Regression Model Specification</h2>
<p>Before fitting the Bayesian model, we explicitly state the probabilistic structure. For each individual <span class="math inline">\(i\)</span> in the decentralised clinical trial, resting heart rate is modeled as</p>
<p><span class="math display">\[
\mathrm{HR}_i \sim \mathcal{N}\left(w_0+w_1 \text { frailty }_i, \sigma^2\right) .
\]</span></p>
<p>The Bayesian formulation assigns prior distributions to all unknown quantities:</p>
<p><span class="math display">\[
w_0 \sim \mathcal{N}\left(60,20^2\right), \quad w_1 \sim \mathcal{N}\left(0,20^2\right), \quad \sigma \sim \text { HalfNormal }(10) .
\]</span></p>
<p>These priors represent weak prior beliefs about baseline heart rate (around 60 bpm), an uncertain association between frailty and heart rate, and a plausible scale for residual variability.</p>
<p>Given the data <span class="math inline">\(\left(y_i, x_i\right)\)</span>, Bayes’ theorem yields a posterior distribution:</p>
<p><span class="math display">\[
p\left(w_0, w_1, \sigma \mid y, x\right) \propto p\left(y \mid w_0, w_1, \sigma, x\right) p\left(w_0\right) p\left(w_1\right) p(\sigma) .
\]</span></p>
<p>This posterior cannot be computed analytically; instead, it is approximated using Markov Chain Monte Carlo (MCMC), as implemented in rstanarm::stan_glm().</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Refit Bayesian model (must run BEFORE posterior extraction)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Rcpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is rstanarm version 2.32.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- See https://mc-stan.org/rstanarm/articles/priors for changes to default priors!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- Default priors may change, so it's safest to specify priors, even if equivalent to the defaults.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- For execution on a local, multicore CPU with excess RAM we recommend calling</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  options(mc.cores = parallel::detectCores())</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fit_bayes <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  resting_hr <span class="sc">~</span> frailty,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> wearable_complete,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>),               <span class="co"># prior for w1</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="dv">60</span>, <span class="dv">20</span>),    <span class="co"># prior for w0</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_bayes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glm
 family:       gaussian [identity]
 formula:      resting_hr ~ frailty
 observations: 500
 predictors:   2
------
            Median MAD_SD
(Intercept) 51.7    1.5  
frailty     46.0    3.5  

Auxiliary parameter(s):
      Median MAD_SD
sigma 11.2    0.4  

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
</div>
<section id="understanding-mcmc-how-bayesian-posteriors-are-computed" class="level3" data-number="5.8.1">
<h3 data-number="5.8.1" class="anchored" data-anchor-id="understanding-mcmc-how-bayesian-posteriors-are-computed"><span class="header-section-number">5.8.1</span> Understanding MCMC: how Bayesian posteriors are computed</h3>
<p>Until now the Bayesian examples relied on stan_glm( ), which conveniently returns draws from the posterior. Behind this simplicity is an important computational idea: Monte Carlo sampling via Markov chains (MCMC).</p>
<p>In most realistic models-including regressions, hierarchical structures, or logistic models-the posterior distribution has no closed-form solution. Bayes’ theorem still holds, but the expression</p>
<p><span class="math display">\[
p\left(w_0, w_1, \sigma \mid y, x\right)
\]</span></p>
<p>cannot be written analytically. MCMC approximates this distribution by generating samples:</p>
<p><span class="math display">\[
\left\{w^{(1)}, w^{(2)}, \ldots, w^{(S)}\right\} \sim p(w \mid y) .
\]</span></p>
<p>These samples allow the computation of: - posterior means and medians - credible intervals - probabilities such as <span class="math inline">\(P\left(w_1&gt;0 \mid\right.\)</span> data <span class="math inline">\()\)</span> - predictive distributions</p>
</section>
<section id="the-stan-approach-hamiltonian-monte-carlo-hmc" class="level3" data-number="5.8.2">
<h3 data-number="5.8.2" class="anchored" data-anchor-id="the-stan-approach-hamiltonian-monte-carlo-hmc"><span class="header-section-number">5.8.2</span> The Stan approach: Hamiltonian Monte Carlo (HMC)</h3>
<p>The rstanarm package relies on Stan, which implements Hamiltonian Monte Carlo (HMC) - an efficient MCMC algorithm that avoids slow random-walk behaviour.</p>
<p>Stan returns: - multiple chains - thousands of posterior draws - diagnostics for convergence</p>
<p>This ensures highly reliable approximations to the posterior.</p>
</section>
<section id="inspecting-the-mcmc-samples" class="level3" data-number="5.8.3">
<h3 data-number="5.8.3" class="anchored" data-anchor-id="inspecting-the-mcmc-samples"><span class="header-section-number">5.8.3</span> Inspecting the MCMC samples</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fit_bayes)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(posterior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)  frailty    sigma
1    52.61372 44.30728 12.08584
2    51.09142 48.67930 10.34534
3    52.43520 44.39039 12.04483
4    52.88922 44.30685 12.18157
5    51.12819 46.69388 11.54471
6    54.15898 41.84504 11.76282</code></pre>
</div>
</div>
<p>Each row is one posterior draw; each column corresponds to a parameter ( w0 , w1 , sigma ). Posterior probability that <span class="math inline">\(w_1&gt;0\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(posterior<span class="sc">$</span>frailty <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Interpretation:</p>
<p>“Given the data and the priors, the probability that frailty increases resting HR is 1%.”</p>
<p>A frequentist model cannot provide this probability.</p>
</section>
<section id="mcmc-diagnostics" class="level3" data-number="5.8.4">
<h3 data-number="5.8.4" class="anchored" data-anchor-id="mcmc-diagnostics"><span class="header-section-number">5.8.4</span> MCMC Diagnostics</h3>
<p>Evaluating MCMC convergence is essential. #### Trace plots</p>
<p>Trace plots show parameter trajectories across iterations. Good chains look like overlapping “hairy caterpillars”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>This is bayesplot version 1.14.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- Online documentation and vignettes at mc-stan.org/bayesplot</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- bayesplot theme set to bayesplot::theme_default()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>   * Does _not_ affect other ggplot2 plots</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>   * See ?bayesplot_theme_set for details on theme setting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(<span class="fu">as.array</span>(fit_bayes), <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"frailty"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="introd_bayesian_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Expected behaviour:</p>
<ul>
<li><p>chains overlap</p></li>
<li><p>no visible upward/downward drift</p></li>
<li><p>no sticking</p></li>
</ul>
<p>Additional diagnostic plots:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>posterior_draws <span class="ot">&lt;-</span> <span class="fu">as.array</span>(fit_bayes)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(posterior_draws, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"frailty"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="introd_bayesian_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_dens_overlay</span>(posterior_draws, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"frailty"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="introd_bayesian_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_acf</span>(posterior_draws, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"frailty"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="introd_bayesian_files/figure-html/unnamed-chunk-15-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="r-hat-gelmanrubin-diagnostic" class="level4" data-number="5.8.4.1">
<h4 data-number="5.8.4.1" class="anchored" data-anchor-id="r-hat-gelmanrubin-diagnostic"><span class="header-section-number">5.8.4.1</span> R-hat (Gelman–Rubin diagnostic)</h4>
<p>R-hat close to 1 (≤ 1.01) indicates convergence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>rhat_values <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">summary</span>(fit_bayes<span class="sc">$</span>stanfit)<span class="sc">$</span>summary[ , <span class="st">"Rhat"</span>]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>rhat_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)       frailty         sigma      mean_PPD log-posterior 
    1.0001283     0.9998629     0.9990025     0.9998934     1.0018865 </code></pre>
</div>
</div>
</section>
</section>
<section id="interpretation-of-posterior-weights" class="level3" data-number="5.8.5">
<h3 data-number="5.8.5" class="anchored" data-anchor-id="interpretation-of-posterior-weights"><span class="header-section-number">5.8.5</span> Interpretation of Posterior Weights</h3>
<section id="interpretation-of-w_0-intercept" class="level4" data-number="5.8.5.1">
<h4 data-number="5.8.5.1" class="anchored" data-anchor-id="interpretation-of-w_0-intercept"><span class="header-section-number">5.8.5.1</span> Interpretation of <span class="math inline">\(w_0\)</span> (Intercept)</h4>
<p>Posterior median around 51.7 bpm, with low uncertainty. Represents predicted resting HR when frailty <span class="math inline">\(=0\)</span> (least frail individuals).</p>
</section>
<section id="interpretation-of-w_1-frailty-effect" class="level4" data-number="5.8.5.2">
<h4 data-number="5.8.5.2" class="anchored" data-anchor-id="interpretation-of-w_1-frailty-effect"><span class="header-section-number">5.8.5.2</span> Interpretation of <span class="math inline">\(w_1\)</span> (Frailty effect)</h4>
<p>Posterior median % 46 bpm increase per 1-unit increase in frailty. Credible interval entirely above zero ⇒ very strong evidence of a positive association. #### Noise parameter <span class="math inline">\(\sigma\)</span> Posterior median <span class="math inline">\(\boldsymbol{\approx} \mathbf{1 1 . 2 ~ b p m}\)</span>, consistent with simulated residual noise.</p>
</section>
</section>
<section id="posteriors-of-the-weights" class="level3" data-number="5.8.6">
<h3 data-number="5.8.6" class="anchored" data-anchor-id="posteriors-of-the-weights"><span class="header-section-number">5.8.6</span> Posteriors of the weights</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fit_bayes)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> posterior <span class="sc">|&gt;</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">w0 =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">w1 =</span> frailty</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(w0, w1) <span class="sc">|&gt;</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"weight"</span>,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>posterior<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  posterior<span class="sc">$</span>weight,</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"w0"</span>, <span class="st">"w1"</span>),</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"w₀ (Intercept)"</span>, <span class="st">"w₁ (Effect of Frailty)"</span>)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(posterior, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> weight)) <span class="sc">+</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> weight, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#8dbdff"</span>, <span class="st">"#95d0a3"</span>)) <span class="sc">+</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Posterior Distributions of Regression Weights"</span>,</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weight value"</span>,</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="introd_bayesian_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="credible-intervals-vs-confidence-intervals" class="level3" data-number="5.8.7">
<h3 data-number="5.8.7" class="anchored" data-anchor-id="credible-intervals-vs-confidence-intervals"><span class="header-section-number">5.8.7</span> Credible Intervals vs Confidence Intervals</h3>
<p>A 95% Bayesian credible interval means: There is a 95% probability that the true weight lies in this interval, given the data and the priors.</p>
<p>A 95% frequentist confidence interval means: If we repeated the experiment infinitely many times, <span class="math inline">\(95 \%\)</span> of the computed intervals would contain the true value.</p>
<p>It does not express probability about the parameter.</p>
</section>
<section id="frequentist-vs-bayesian-comparison-table" class="level3" data-number="5.8.8">
<h3 data-number="5.8.8" class="anchored" data-anchor-id="frequentist-vs-bayesian-comparison-table"><span class="header-section-number">5.8.8</span> Frequentist vs Bayesian comparison table</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th>Concept</th>
<th>Bayesian credible interval</th>
<th>Frequentist confidence interval</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>What is uncertain?</td>
<td>The parameter (w)</td>
<td>The interval</td>
</tr>
<tr class="even">
<td>Interpretation</td>
<td><span class="math inline">\(Prob((w) in interval | data)\)</span></td>
<td>95% of intervals would contain (w) under repeated sampling</td>
</tr>
<tr class="odd">
<td>Depends on prior?</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr class="even">
<td>Can answer “Is (w_1 &gt; 0)?”</td>
<td><strong>Yes</strong></td>
<td>No</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="posterior-distributions-and-treatment-of-pure-risk-measures" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="posterior-distributions-and-treatment-of-pure-risk-measures"><span class="header-section-number">5.9</span> Posterior distributions and treatment of pure risk measures</h2>
<p>Before introducing how Bayesian posterior distributions help quantify clinical risk, it is useful to clarify what we mean by risk in the first place. In clinical and digital-health settings, risk typically refers to the probability that an adverse outcome will occur. Whether the outcome is deterioration, infection, hospitalisation, or early physiological instability, the risk attached to a participant is fundamentally a probability statement. A higher probability indicates greater uncertainty about the future—but in a clinically dangerous direction.</p>
<p>Probability is therefore a natural mathematical language for expressing risk. If a model gives a participant a 25% deterioration probability, we can interpret this directly: out of many individuals with similar physiology, about one in four would be expected to deteriorate. When probability distributions themselves are uncertain—because data are limited, noisy, or highly variable—the model should express that uncertainty as well. This is where Bayesian methods excel: rather than producing a single risk estimate, they produce an entire distribution describing all plausible values of that risk.</p>
<p>From this perspective, Bayesian models do not simply output numbers; they yield risk objects: posterior distributions over clinically meaningful quantities. These risk objects fully encode our uncertainty, allow us to compute thresholds, credible intervals, and tail probabilities, and directly address the kinds of questions clinicians ask: “How likely is it that this participant will deteriorate?”, “What is the uncertainty around this risk?”, and “How does new data update that risk?”</p>
<section id="why-bayesian-risk-modelling-is-more-intuitive" class="level3" data-number="5.9.1">
<h3 data-number="5.9.1" class="anchored" data-anchor-id="why-bayesian-risk-modelling-is-more-intuitive"><span class="header-section-number">5.9.1</span> Why Bayesian risk modelling is more intuitive</h3>
<p>Risk measures are probabilities by definition or imply the usage of a precise measure of risk.</p>
<p>A Bayesian posterior distribution gives probability statements about: - the likelihood that a physiologic burden exceed the threshold - the probability that a digital biomarker crosses a critical clinical value - the probability that an individual will experience an event, given their physiology - the probability that a model weight (such as the frailty effect) is positive or negative - the full predictive distribution of outcomes for a new patient</p>
<p>These are direct expressions of uncertainty, not the indirect repeated-sampling logic of frequentist inference.</p>
<p>For example: - A clinician does not want to know whether the association between HRV and adverse events is “significant at 0.05”. - They want to know: “What is the probability that this participant experiences an event within the next 7 days?” Posterior distributions answer these questions immediately.</p>
</section>
<section id="bayesian-modelling-of-event-risk-in-the-wearable-sensor-dataset" class="level3" data-number="5.9.2">
<h3 data-number="5.9.2" class="anchored" data-anchor-id="bayesian-modelling-of-event-risk-in-the-wearable-sensor-dataset"><span class="header-section-number">5.9.2</span> Bayesian modelling of event risk in the wearable-sensor dataset</h3>
<p>In the DCT dataset used in this chapter, each participant has a simulated probability of deterioration ( event_risk ) influenced by: - frailty - stress score - inflammation - age</p>
<p>A fully <strong>Bayesian logistic regression</strong> model treats these risk contributions as uncertain and estimates directly the posterior distribution of the probability:</p>
<p><span class="math display">\[
P\left(\text { event }_i=1 \mid \text { physiology }_i, \text { data }\right) .
\]</span></p>
<p>The output is a distribution for each participant’s risk, not a single number. Thus we can compute: - posterior mean risk - posterior credible intervals for the risk - posterior probability that risk exceeds a clinically important threshold</p>
<p>For example, after fitting a Bayesian logistic model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bayesian event-risk model</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>fit_event <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  event_occurred <span class="sc">~</span> stress_score <span class="sc">+</span> frailty <span class="sc">+</span> age <span class="sc">+</span> baseline_inflammation,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> wearable_complete,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can obtain the posterior distribution of risk for any participant:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior risk for the first patient</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>posterior_risk <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit_event)[ , <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each of these directly addresses clinical or monitoring questions: - “What is the probability that this participant’s true risk exceeds a critical threshold?” - “What is the <span class="math inline">\(95 \%\)</span> credible interval for the deterioration risk?” - “How uncertain are we about the risk estimate itself?”</p>
<p>These are quantities clinicians can reason about naturally. Posterior predictive distributions as risk objects Bayesian models provide not only parameter posteriors but also posterior predictive distributions, which are essential in risk modelling. For a future observation:</p>
<p><span class="math display">\[
y_{\text {new }} \sim p\left(y_{\text {new }} \mid x_{\text {new }}, \text { data }\right),
\]</span></p>
<p>we can simulate entire distributions of likely outcomes.</p>
<p>For a new participant with given physiology:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>new_patient <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">age                  =</span> <span class="dv">72</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_inflammation =</span> <span class="fl">4.1</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">frailty              =</span> <span class="fl">0.55</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">resting_hr           =</span> <span class="dv">82</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrv                  =</span> <span class="dv">45</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">skin_temp            =</span> <span class="fl">33.8</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">activity_index       =</span> <span class="dv">52</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">stress_score         =</span> <span class="dv">67</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior event probability draws</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>posterior_prob <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit_event, <span class="at">newdata =</span> new_patient)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>mean_risk <span class="ot">&lt;-</span> <span class="fu">mean</span>(posterior_prob)</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>quantile_risk <span class="ot">&lt;-</span> <span class="fu">quantile</span>(posterior_prob, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>mean_risk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9893163</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>quantile_risk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     2.5%       50%     97.5% 
0.9578845 0.9928815 0.9988782 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior predictive binary outcomes</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(fit_event, <span class="at">newdata =</span> new_patient)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summaries</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pp
   0    1 
  19 1981 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(pp)   <span class="co"># predictive event probability</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9905</code></pre>
</div>
</div>
<p>The previous code block computes posterior event-risk estimates for a new participant by passing their clinical and wearable-sensor profile through the Bayesian logistic regression model. For illustration, consider the following patient:</p>
<ul>
<li><p>age <span class="math inline">\(=72\)</span></p></li>
<li><p>baseline inflammation = 4.1</p></li>
<li><p>frailty <span class="math inline">\(=0.55\)</span></p></li>
<li><p>resting <span class="math inline">\(\mathrm{HR}=82 \mathrm{bpm}\)</span></p></li>
<li><p>HRV <span class="math inline">\(=45 \mathrm{~ms}\)</span></p></li>
<li><p>skin temperature <span class="math inline">\(=33.8^{\circ} \mathrm{C}\)</span></p></li>
<li><p>activity index = 52</p></li>
<li><p>stress score <span class="math inline">\(=67\)</span></p></li>
</ul>
<p>Using the fitted Bayesian model, the posterior distribution for this patient’s event probability is extremely concentrated near 1 . The posterior mean risk is approximately 0.99 , with a <span class="math inline">\(95 \%\)</span> credible interval spanning roughly 0.97-0.999. This reflects very strong evidence-given the model, data, and priors-that the patient belongs to a highrisk profile.</p>
<p>The posterior predictive distribution (which generates full simulated outcomes rather than probabilities) tells the same story. Across 2,000 posterior predictive draws, 1,974 simulated outcomes were events and 26 were non-events, yielding a predictive event rate of about 0.987 .</p>
<p>Both summaries communicate the same conclusion: given this physiological and clinical profile, the model assigns an extremely high probability of deterioration.</p>
</section>
</section>
<section id="bayesian-tree-models" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="bayesian-tree-models"><span class="header-section-number">5.10</span> Bayesian tree models</h2>
<p>Up to this point we focused on Bayesian regression, where relationships between predictors and outcomes are represented through linear weights. However, physiological data collected in decentralised trials often involve nonlinear effects, threshold behaviours, and interactions that are difficult to capture with simple parametric models.</p>
<p>Decision trees and random forests (introduced earlier in the course) address this by partitioning the predictor space into regions and fitting simple models within each leaf. Bayesian tree models follow the same philosophy but add a fully probabilistic framework, yielding posterior uncertainty, credible intervals for predictions, and principled regularisation.</p>
<p>Among such models, the most widely used is BART - Bayesian Additive Regression Trees.</p>
<p>The BART Model BART represents the response as a sum of many small regression trees:</p>
<p><span class="math display">\[
y_i=\sum_{t=1}^m g\left(x_i ; T_t, M_t\right)+\varepsilon_i, \quad \varepsilon_i \sim \mathcal{N}\left(0, \sigma^2\right) .
\]</span></p>
<p>Each component includes:</p>
<ul>
<li><p><span class="math inline">\(T_t\)</span> : the structure of the <span class="math inline">\(t\)</span>-th tree (its splits),</p></li>
<li><p><span class="math inline">\(M_t\)</span> : the set of leaf parameters for that tree,</p></li>
</ul>
<p>- <span class="math inline">\(g(\cdot)\)</span> : a function that assigns the appropriate leaf mean to input <span class="math inline">\(x_i\)</span>.</p>
<p>The Bayesian specification places priors on all unknowns:</p>
<p>1. Tree structure prior</p>
<p>Shallow trees are favoured. For a node at depth <span class="math inline">\(d\)</span> :</p>
<p><span class="math display">\[
p(\text { node splits })=\alpha(1+d)^{-\beta},
\]</span></p>
<p><span class="math display">\[
p(\text { node splits })=\alpha(1+d)^{-\beta},
\]</span></p>
<p>encouraging regularization via many small trees.</p>
<p>2. Leaf parameter priors</p>
<p><span class="math display">\[
\mu_{t \ell} \sim \mathcal{N}\left(0, \tau^2 / m\right),
\]</span></p>
<p>where <span class="math inline">\(m\)</span> is the total number of trees (often 50-200), and <span class="math inline">\(\tau\)</span> controls shrinkage. 3. Error variance prior</p>
<p><span class="math display">\[
\sigma^2 \sim \operatorname{Inverse-Gamma}(\nu / 2, \nu \lambda / 2) .
\]</span></p>
<p>Together, these priors ensure that no single tree dominates; instead, the model builds a smooth ensemble whose posterior is sampled via MCMC.</p>
<p>The resulting posterior is:</p>
<p><span class="math display">\[
p\left(T_1, M_1, \ldots, T_m, M_m, \sigma \mid y, X\right)
\]</span></p>
<p>and predictions are obtained by averaging over thousands of posterior tree ensembles.</p>
<section id="bart-possibilities" class="level3" data-number="5.10.1">
<h3 data-number="5.10.1" class="anchored" data-anchor-id="bart-possibilities"><span class="header-section-number">5.10.1</span> BART possibilities</h3>
<p>Bayesian Additive Regression Trees offer a natural extension of Bayesian modelling when physiological relationships become too irregular, nonlinear, or interaction-driven for simple regression to capture. In decentralised clinical-trial datasets, wearable signals often show threshold behaviour—resting heart rate may rise smoothly with frailty until a particular physiological burden is reached, after which the change accelerates sharply. Skin temperature may react differently depending on whether inflammation is mild or severe, and HRV frequently interacts with both age and frailty in ways that defy linear specification. Models that assume a single straight-line relationship can miss these patterns.</p>
<p>This is precisely where BART excels. Instead of committing to one functional form, BART models the outcome as the sum of many small regression trees, each capturing a different local pattern in the data. The ensemble adapts automatically to nonlinearity, varying slopes, threshold effects, and interactions—without requiring the analyst to specify those structures in advance. Because the model is Bayesian, every prediction comes with a full posterior distribution. This allows us to express questions in clinically meaningful terms: not only <em>what is the predicted event risk for this participant</em>, but <em>how certain are we about that risk</em>, taking into account all nonlinear physiological interactions implied by the data.</p>
<p>In contrast to the linear Bayesian model introduced earlier—which focuses on uncertainty about specific regression weights such as w1w_1w1​—BART centres its uncertainty on the <em>predictions themselves</em>. This shift often aligns more naturally with clinical decision-making. For example, instead of asking whether frailty has a positive effect on resting heart rate, a BART model directly answers questions such as: <em>Given the full physiological profile of a participant, what is the posterior distribution of their probability of deterioration?</em> In digital-health applications where risk stratification matters more than explicit coefficient interpretation, BART provides a flexible, uncertainty-aware alternative.</p>
</section>
<section id="fitting-bart-with-r" class="level3" data-number="5.10.2">
<h3 data-number="5.10.2" class="anchored" data-anchor-id="fitting-bart-with-r"><span class="header-section-number">5.10.2</span> Fitting BART with R</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("dbarts")</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbarts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dbarts'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> wearable_complete[, <span class="fu">c</span>(<span class="st">"frailty"</span>, <span class="st">"baseline_inflammation"</span>)]</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> wearable_complete<span class="sc">$</span>resting_hr</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>bart_fit <span class="ot">&lt;-</span> dbarts<span class="sc">::</span><span class="fu">bart</span>(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.train =</span> X,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y.train =</span> y,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree   =</span> <span class="dv">50</span>,      <span class="co"># number of trees</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ndpost  =</span> <span class="dv">2000</span>,    <span class="co"># posterior draws</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">nskip   =</span> <span class="dv">1000</span>,    <span class="co"># burn-in</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">keeptrees =</span> <span class="cn">TRUE</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Running BART with numeric y

number of trees: 50
number of chains: 1, default number of threads 1
tree thinning rate: 1
Prior:
    k prior fixed to 2.000000
    degrees of freedom in sigma prior: 3.000000
    quantile in sigma prior: 0.900000
    scale in sigma prior: 0.003912
    power and base for tree prior: 2.000000 0.950000
    use quantiles for rule cut points: false
    proposal probabilities: birth/death 0.50, swap 0.10, change 0.40; birth 0.50
data:
    number of training observations: 500
    number of test observations: 0
    number of explanatory variables: 2
    init sigma: 8.854226, curr sigma: 8.854226

Cutoff rules c in x&lt;=c vs x&gt;c
Number of cutoffs: (var: number of possible c):
(1: 100) (2: 100) 
Running mcmc loop:
iteration: 100 (of 2000)
iteration: 200 (of 2000)
iteration: 300 (of 2000)
iteration: 400 (of 2000)
iteration: 500 (of 2000)
iteration: 600 (of 2000)
iteration: 700 (of 2000)
iteration: 800 (of 2000)
iteration: 900 (of 2000)
iteration: 1000 (of 2000)
iteration: 1100 (of 2000)
iteration: 1200 (of 2000)
iteration: 1300 (of 2000)
iteration: 1400 (of 2000)
iteration: 1500 (of 2000)
iteration: 1600 (of 2000)
iteration: 1700 (of 2000)
iteration: 1800 (of 2000)
iteration: 1900 (of 2000)
iteration: 2000 (of 2000)
total seconds in loop: 0.251041

Tree sizes, last iteration:
[1] 2 2 2 4 3 2 2 2 2 4 3 3 2 3 2 2 2 2 
2 1 3 2 5 2 2 1 2 3 2 2 2 2 3 3 3 2 3 2 
3 2 2 2 2 2 2 2 4 3 2 2 

Variable Usage, last iteration (var:count):
(1: 39) (2: 30) 
DONE BART</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior predictions for the training data</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>bart_pred <span class="ot">&lt;-</span> bart_fit<span class="sc">$</span>yhat.train</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior mean and 95% credible interval for first individual</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>mean_pred <span class="ot">&lt;-</span> <span class="fu">mean</span>(bart_pred[, <span class="dv">1</span>])</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>ci_pred   <span class="ot">&lt;-</span> <span class="fu">quantile</span>(bart_pred[, <span class="dv">1</span>], <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>mean_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 78.34089</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>ci_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    2.5%    97.5% 
74.50905 82.38365 </code></pre>
</div>
</div>
<p>In the previous section we introduced Bayesian Additive Regression Trees (BART) as a flexible, fully Bayesian non-parametric regression model. After fitting the model with the wearable-sensor features frailty and baseline_inflammation as predictors of resting_hr, the BART sampler produced 2,000 posterior draws after a 1,000-iteration burn-in phase. These draws represent the posterior uncertainty over the entire ensemble of regression trees.</p>
<p>BART naturally provides posterior predictive samples for each individual in the dataset. Extracting these samples allows us to summarise the expected resting heart rate for any participant and to compute uncertainty bands directly from the posterior.</p>
<p>For illustration, the following summary corresponds to the first participant in the dataset:</p>
<ul>
<li><p>Posterior mean prediction: approximately 78.3 bpm</p></li>
<li><p>95% posterior credible interval: [74.3, 82.5] bpm</p></li>
</ul>
<p>This interval quantifies genuine uncertainty about the individual’s true resting heart rate under the model—incorporating nonlinear effects, interactions, and the full posterior over tree structures. Unlike classical intervals derived from linear regression, BART’s uncertainty directly reflects the model’s flexibility and the posterior distribution of all trees.</p>
<p>These posterior predictive summaries are directly usable in clinical decision-support settings. Instead of producing a single point forecast, BART offers a full distribution describing all plausible physiological values, making it naturally aligned with risk-aware modelling of wearable-trial data.</p>
</section>
</section>
<section id="bayesian-tree-models-complementing-random-forests-and-xgboost" class="level2" data-number="5.11">
<h2 data-number="5.11" class="anchored" data-anchor-id="bayesian-tree-models-complementing-random-forests-and-xgboost"><span class="header-section-number">5.11</span> Bayesian Tree Models: Complementing Random Forests and XGBoost</h2>
<p>In the previous chapter we examined classical tree-based ensemble methods — Random Forests and Gradient Boosted Trees (XGBoost). Both approaches achieve strong predictive performance by aggregating many simple decision trees, and both are well suited to nonlinearities and complex interaction structures commonly observed in wearable-derived physiological signals. What they do not provide, however, is a coherent way to quantify uncertainty. Their predictions are deterministic functions of the training sample, and uncertainty must be approximated through ad-hoc resampling or assumptions that do not fully reflect the model structure.</p>
<p>Bayesian Additive Regression Trees (BART) extends the same foundational idea — representing a regression function as the sum of many small trees — but places the entire ensemble inside a Bayesian framework. This makes BART particularly appealing for clinical and digital-health applications, where risk quantification, uncertainty intervals, and probability statements are more clinically meaningful than point estimates alone.</p>
<p>Revisiting the Structure of a Tree Ensemble Random Forests and XGBoost rely on a common representation:</p>
<p><span class="math display">\[
f(x)=\sum_{t=1}^m g\left(x ; T_t, M_t\right),
\]</span></p>
<p>where each <span class="math inline">\(T_t\)</span> defines a set of splits, and the leaf parameters <span class="math inline">\(M_t\)</span> give the predicted value within each region. These methods differ in how the trees are constructed - RF uses bootstrap samples and decorrelated predictors, XGBoost uses sequential boosting - but the structure is always an additive sum of trees.</p>
<p>BART adopts exactly the same form, but interprets all unknowns as random variables with prior distributions. Instead of producing a single fitted ensemble, BART samples thousands of different ensembles from the posterior, each a plausible explanation of the data. This makes its predictions <strong>inherently probabilistic.</strong></p>
<p>Why BART is Different Where Random Forests and XGBoost return a single prediction, BART returns a posterior predictive distribution. For every participant in a decentralised trial, we obtain a distribution of likely physiological values or event risks, not just a central estimate.</p>
<p>This improves modelling in several ways: - nonlinearities such as abrupt increases in resting HR at high frailty levels are learned in a fully datadriven way; - interactions among physiology measures emerge naturally (e.g., inflammation modifying the effect of frailty); - uncertainty is preserved and propagated through all layers of the model, making predictions interpretable as risk distributions rather than isolated numbers.</p>
<p>In contexts where clinical decisions depend not only on expected values but on the range of plausible outcomes, BART offers a more intuitive probabilistic interpretation than traditional ensembles.</p>
<section id="running-rf-and-xgboosst" class="level3" data-number="5.11.1">
<h3 data-number="5.11.1" class="anchored" data-anchor-id="running-rf-and-xgboosst"><span class="header-section-number">5.11.1</span> Running RF and Xgboosst</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>randomForest 4.7-1.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type rfNews() to see new features/changes/bug fixes.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'randomForest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    margin</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'xgboost'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    slice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest model</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> X, <span class="at">y =</span> y,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">500</span>,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry  =</span> <span class="dv">2</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co"># XGBoost model</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>dmat <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(X), <span class="at">label =</span> y)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>xgb_fit <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dmat,</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>,</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">300</span>,</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.05</span>,</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">3</span>,</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>rf_pred  <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_fit, X)</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>xgb_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_fit, <span class="fu">as.matrix</span>(X))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE helper</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="cf">function</span>(truth, pred) {</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">mean</span>((truth <span class="sc">-</span> pred)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co"># BART posterior mean prediction for each individual</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>bart_mean_pred <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(bart_pred)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSEs</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>rmse_bart <span class="ot">&lt;-</span> <span class="fu">rmse</span>(y, bart_mean_pred)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>rmse_rf   <span class="ot">&lt;-</span> <span class="fu">rmse</span>(y, rf_pred)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>rmse_xgb  <span class="ot">&lt;-</span> <span class="fu">rmse</span>(y, xgb_pred)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>rmse_bart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12.90669</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>rmse_rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.350984</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>rmse_xgb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.349438</code></pre>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>RMSE (↓ better)</th>
<th>Handles Nonlinearity</th>
<th>Uncertainty Quantification</th>
<th>Interactions Automatically</th>
<th>Posterior Predictive Dist.</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>BART</strong></td>
<td><strong>12.89</strong></td>
<td>Yes</td>
<td><strong>Full posterior</strong></td>
<td>Yes</td>
<td><strong>Yes</strong></td>
<td>Lower accuracy but richest uncertainty + Bayesian structure</td>
</tr>
<tr class="even">
<td><strong>Random Forest</strong></td>
<td><strong>4.35</strong></td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Best predictive RMSE but no probabilistic interpretation</td>
</tr>
<tr class="odd">
<td><strong>XGBoost</strong></td>
<td><strong>6.35</strong></td>
<td>Yes</td>
<td>No</td>
<td>Yes (via splits)</td>
<td>No</td>
<td>Strong performance, tunable, deterministic</td>
</tr>
</tbody>
</table>
<p>Although Random Forests and XGBoost do not provide native posterior uncertainty, approximate measures can sometimes be obtained through resampling. In practice this is typically done by:</p>
<p>Bootstrapping the training data (fit many RF/XGB models on resampled datasets)</p>
<p>Estimating variability across predictions</p>
<p>However, these procedures are not Bayesian, they do not propagate structural model uncertainty, and they lack a coherent probabilistic interpretation. The resulting intervals are often wider, unstable, or sensitive to tuning choices. This stands in contrast to BART, where uncertainty arises directly from the posterior distribution over entire ensembles of trees.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/danilosarti\.github\.io\/att_ml_ai_book");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./neural_networks.html" class="pagination-link" aria-label="Neural networks and deep learning">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Neural networks and deep learning</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./intro_missing.html" class="pagination-link" aria-label="Introduction to missing data">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to missing data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>