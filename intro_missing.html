<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; Introduction to missing data – Introduction to Machine Learning and AI for Health Sciences</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./high_dims.html" rel="next">
<link href="./introd_bayesian.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intro_missing.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to missing data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Machine Learning and AI for Health Sciences</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction_AI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to AI and Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supervised_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Supervised Learning: Regression tasks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./three_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Supervised Learning: Tree Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./neural_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Neural networks and deep learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introd_bayesian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Bayesian methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_missing.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to missing data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./high_dims.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">High Dimension Data Strategies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Clustering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interpretable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Interpretable AI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./genai_foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">GenAI: Foundations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./genai_app.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">GenAI: Applications</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section"><span class="header-section-number">6.1</span> </a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation"><span class="header-section-number">6.2</span> Motivation</a></li>
  <li><a href="#missing-mechanisms" id="toc-missing-mechanisms" class="nav-link" data-scroll-target="#missing-mechanisms"><span class="header-section-number">6.3</span> Missing mechanisms</a>
  <ul class="collapse">
  <li><a href="#ilustrating-mnar-mechanism" id="toc-ilustrating-mnar-mechanism" class="nav-link" data-scroll-target="#ilustrating-mnar-mechanism"><span class="header-section-number">6.3.1</span> Ilustrating MNAR mechanism</a></li>
  </ul></li>
  <li><a href="#how-to-deal-with-missingness-rates" id="toc-how-to-deal-with-missingness-rates" class="nav-link" data-scroll-target="#how-to-deal-with-missingness-rates"><span class="header-section-number">6.4</span> How to deal with missingness rates?</a></li>
  <li><a href="#other-imputation-methods-available-in-mice" id="toc-other-imputation-methods-available-in-mice" class="nav-link" data-scroll-target="#other-imputation-methods-available-in-mice"><span class="header-section-number">6.5</span> Other Imputation Methods Available in mice</a>
  <ul class="collapse">
  <li><a href="#choosing-an-imputation-method-practical-guidance" id="toc-choosing-an-imputation-method-practical-guidance" class="nav-link" data-scroll-target="#choosing-an-imputation-method-practical-guidance"><span class="header-section-number">6.5.1</span> Choosing an Imputation Method: Practical Guidance</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to missing data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="section" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="section"><span class="header-section-number">6.1</span> </h2>
</section>
<section id="motivation" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="motivation"><span class="header-section-number">6.2</span> Motivation</h2>
<p>This chapter introduces the statistical foundations and practical tools for analysing datasets with missing values, using the amputated version of the wearable-sensor dataset introduced in the previous chapter. Although simulated, the dataset mirrors the types of incomplete streams routinely encountered in decentralised clinical trials, where remote monitoring depends on device adherence, sensor quality, and participant characteristics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#install.packages("tidyverse")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  wear <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/att_ai_ml/att_book/data/dct_wearable_amputated.rds"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  wear_complete <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/att_ai_ml/att_book/data/dct_wearable_complete.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>## Why missing data matters</p>
<p>Missing data is often introduced as a technical inconvenience - something that “just happens” in realworld datasets. But its implications are far deeper. To appreciate why careful methods are needed, we begin with the simplest possible statistical quantity: the sample mean.</p>
<p>Even this basic calculation becomes ambiguous as soon as one value is missing. 1. The mean requires all values to be known</p>
<p>The sample mean is defined as:</p>
<p><span class="math display">\[
  \bar{x}=\frac{1}{n} \sum_{i=1}^n x_i= x_1+x_2+....+n_n
  \]</span></p>
<p>This formula contains an implicit assumption: every value <span class="math inline">\(x_i\)</span> exists and is observed.</p>
<p>If one value is missing, the formula does not tell us what to do. There is no instruction in: <span class="math display">\[
  \sum_{i=1}^n x_i
  \]</span></p>
<p>that explains how to add something that does not exist.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">16</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13</code></pre>
</div>
</div>
<p>The computation is straightforward:</p>
<p><span class="math display">\[
  \bar{x}=\frac{10+12+14+16}{4}=13
  \]</span></p>
<p>Everything works.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>, <span class="cn">NA</span>, <span class="dv">16</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>Because mathematically we are now trying to compute:</p>
<p><span class="math display">\[
  \bar{x}=\frac{10+12+?+16}{4}
  \]</span></p>
<p>There is no rule for the missing term. The mean is effectively undefined without further assumptions.</p>
<p>If we ignore the missing value, we change the problem</p>
<p>R allows this option:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12.66667</code></pre>
</div>
</div>
<p>This corresponds to:</p>
<p><span class="math display">\[
  \frac{10+12+16}{3}=12.67
  \]</span></p>
<p>But notice: - one value was dropped, - the total number of values changed from 4 to 3, - and the resulting mean answers a different question.</p>
<p>This is equivalent to assuming the data are MCAR (Missing Completely At Random), a concept we will discuss later in this chapter. If that assumption is not true, the result is biased - even for a simple mean.</p>
<p>### Arbitrary replacements produce arbitrarily different means</p>
<p>Suppose someone fills the missing value with zero:</p>
<p>::: {.cell}</p>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>x_zero <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x), <span class="dv">0</span>, x)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x_zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>::: {.cell-output .cell-output-stdout}</p>
<pre><code>[1] 9.5</code></pre>
<p>::: :::</p>
<p>We obtain:</p>
<p><span class="math display">\[
  (10+12+0+16) / 4=9.5
  \]</span></p>
<p>Now the mean has changed drastically simply because we chose an arbitrary replacement.</p>
<p>Or we could replace the missing value with the observed mean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>  x_meanfilled <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x), <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), x)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(x_meanfilled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12.66667</code></pre>
</div>
</div>
<p>This returns the same mean as the complete-case mean (12.67), but again, this is not the true mean of the original data — it is a constructed quantity.</p>
<p>Even the simplest statistic — the mean — becomes:</p>
<ul>
<li><p>undefined</p></li>
<li><p>sensitive to assumptions</p></li>
<li><p>biased if assumptions are incorrect</p></li>
<li><p>as soon as missing data appear.</p></li>
</ul>
<p>This motivates why missing data mechanisms (MCAR, MAR, MNAR) must be understood and why naive fixes such as dropping rows or plugging in arbitrary values rarely produce valid results. We will address these terms later.</p>
<p>This simple example sets up the core idea:</p>
<p>If we cannot define a mean without assumptions, then regression models — which involve multiple variables and complex relationships — are even more sensitive to missing data.</p>
<p>This naturally leads into your next section that show how missingness may affect modelling.</p>
<p>## Naive approaches to handling missing data</p>
<p>Before introducing principled statistical approaches, it is helpful to examine the simplistic strategies that analysts often apply when confronted with missing values. These methods are appealing because they are easy to use and require no modelling assumptions. However, as the examples below demonstrate, they frequently distort statistical relationships and lead to biased or unstable results.</p>
<p>One of the most common strategies is listwise deletion, sometimes called complete-case analysis. In this approach, any row that contains at least one missing value is entirely removed from the dataset. Many statistical functions in R use this strategy by default, so it often happens silently. To illustrate how aggressively this approach reduces the number of observations, consider the amputated wearable dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(wear)                     <span class="co"># original number of rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 500</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">complete.cases</span>(wear))    <span class="co"># number of rows with any missing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 134</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(<span class="fu">na.omit</span>(wear))           <span class="co"># rows remaining after listwise deletion</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 366</code></pre>
</div>
</div>
<p>This shows how many complete observations remain after removing all incomplete ones. The key point is that the resulting dataset is smaller and may no longer reflect the population originally sampled. Even simple descriptive statistics can change after discarding incomplete cases. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(wear<span class="sc">$</span>hrv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)                 <span class="co"># using all available HRV values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 43.67949</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">na.omit</span>(wear)<span class="sc">$</span>hrv)                      <span class="co"># HRV mean among complete cases only</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 46.40513</code></pre>
</div>
</div>
<p>These two values are rarely identical. The second is computed on a substantially reduced subset of participants.</p>
<p>A slightly more flexible naive strategy is pairwise deletion, which uses each available pair of variables when computing correlations or covariances. Instead of removing a whole row, pairwise deletion removes only the missing component for the calculation at hand. This often yields more data points for each correlation but leads to inconsistencies because each correlation may be based on a different subset of individuals. Consider the following comparisons:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(wear<span class="sc">$</span>hrv, wear<span class="sc">$</span>frailty, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4985907</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(wear<span class="sc">$</span>hrv, wear<span class="sc">$</span>resting_hr, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.7745626</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(wear<span class="sc">$</span>frailty, wear<span class="sc">$</span>resting_hr, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4838572</code></pre>
</div>
</div>
<p>Each correlation uses a different sample size:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>  n_obs_hrv_frailty     <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">complete.cases</span>(wear[, <span class="fu">c</span>(<span class="st">"hrv"</span>, <span class="st">"frailty"</span>)]))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  n_obs_hrv_rhr         <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">complete.cases</span>(wear[, <span class="fu">c</span>(<span class="st">"hrv"</span>, <span class="st">"resting_hr"</span>)]))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  n_obs_frailty_rhr     <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">complete.cases</span>(wear[, <span class="fu">c</span>(<span class="st">"frailty"</span>, <span class="st">"resting_hr"</span>)]))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(n_obs_hrv_frailty, n_obs_hrv_rhr, n_obs_frailty_rhr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 452 427 470</code></pre>
</div>
</div>
<p>Because the number of observations differs across pairs, the resulting covariance matrix can become internally inconsistent, which can cause multivariate methods (e.g.&nbsp;PCA, factor analysis, some ML algorithms) to fail or behave erratically.</p>
<p>Another widely used naive strategy is single-value imputation, where missing values are replaced with a constant such as zero, the mean, or the median. This makes the dataset look complete, but at the cost of altering its statistical structure. For instance, replacing missing values with the mean collapses variability and suppresses natural relationships between variables. Below is an example using HRV:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>  hrv_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(wear<span class="sc">$</span>hrv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  hrv_imputed <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(wear<span class="sc">$</span>hrv), hrv_mean, wear<span class="sc">$</span>hrv)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sd</span>(wear<span class="sc">$</span>hrv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)      <span class="co"># true variability</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20.98012</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sd</span>(hrv_imputed)                 <span class="co"># variability after mean substitution</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19.94555</code></pre>
</div>
</div>
<p>The second standard deviation is always smaller, because this imputation pushes missing values toward a single central point. The effect on correlations can also be demonstrated:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(wear<span class="sc">$</span>hrv, wear<span class="sc">$</span>frailty, <span class="at">use =</span> <span class="st">"complete.obs"</span>)  <span class="co"># using true observed values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4985907</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(hrv_imputed, wear<span class="sc">$</span>frailty, <span class="at">use =</span> <span class="st">"complete.obs"</span>)  <span class="co"># after mean imputation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4819104</code></pre>
</div>
</div>
<p>Mean imputation often shrinks correlations toward zero, weakening relationships that may be scientifically meaningful.</p>
<p>Using a fixed constant such as zero can create even more distortion, especially when the variable lacks a natural zero point. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>  hrv_zero <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(wear<span class="sc">$</span>hrv), <span class="dv">0</span>, wear<span class="sc">$</span>hrv)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(hrv_zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 -13.06   23.49   40.12   39.49   57.99   99.40 </code></pre>
</div>
</div>
<p>Suddenly, the dataset contains physiologically implausible values, which can create artificial clusters or misleading model behaviour downstream.</p>
<p>Median substitution works similarly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>  hrv_median <span class="ot">&lt;-</span> <span class="fu">median</span>(wear<span class="sc">$</span>hrv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  hrv_median_imp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(wear<span class="sc">$</span>hrv), hrv_median, wear<span class="sc">$</span>hrv)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(hrv_median_imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 -13.06   29.69   43.67   43.68   57.99   99.40 </code></pre>
</div>
</div>
<p>Although more robust to outliers, median imputation still collapses variability and reduces correlation strength.</p>
<p>These naive strategies all share a common problem: they treat missing values through arbitrary conventions rather than statistical reasoning. Removing rows, dropping individual entries, or filling gaps with constants alters the distribution of the data and breaks relationships among variables. Even before we discuss more formal missing data frameworks, the R examples above already suggest that each naive strategy produces a dataset that differs in meaningful ways from the original measurements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(patchwork)   <span class="co"># to arrange side-by-side</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data for pairwise (only remove missing frailty)</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  df_pair <span class="ot">&lt;-</span> wear <span class="sc">%&gt;%</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(frailty, hrv) <span class="sc">%&gt;%</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(frailty))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data for listwise (remove rows missing frailty OR HRV)</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  df_list <span class="ot">&lt;-</span> df_pair <span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(hrv))</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Plot A: Pairwise available --------------------------------------------</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  p_pair <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_pair, <span class="fu">aes</span>(<span class="at">x =</span> frailty, <span class="at">y =</span> hrv)) <span class="sc">+</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"#1f77b4"</span>) <span class="sc">+</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Pairwise Available"</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Uses all available Frailty–HRV pairs"</span>,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Frailty"</span>,</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"HRV (ms)"</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Plot B: Listwise deletion ---------------------------------------------</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  p_list <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_list, <span class="fu">aes</span>(<span class="at">x =</span> frailty, <span class="at">y =</span> hrv)) <span class="sc">+</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"#d62728"</span>) <span class="sc">+</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Listwise Deletion"</span>,</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Rows with ANY missing value are removed"</span>,</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Frailty"</span>,</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"HRV (ms)"</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Combine side-by-side --------------------------------------------------</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>  p_pair <span class="sc">+</span> p_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 48 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 48 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The first pair of scatterplots shows how two common deletion strategies reshape the observed relationship between Frailty and HRV.</p>
<p>The pairwise deletion panel uses every available Frailty–HRV pair, regardless of whether the same participant has missing values elsewhere. Because almost all observed pairs are retained, the point cloud preserves the full physiological range of both variables. The negative association between frailty and HRV remains clearly visible, and the fitted regression line reflects the true structure of the data.</p>
<p>In the listwise deletion panel, any participant with any missing variable is removed entirely. This eliminates many individuals who tend to be older, frailer, or have low HRV — precisely the groups more prone to missingness in this simulated dataset. The resulting point cloud is therefore a biased slice of the population, concentrated in a narrower region. The regression line shifts accordingly, reflecting the selective loss of extreme values. The figure makes explicit that listwise deletion is not just a reduction in sample size; it changes the analytic population itself.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(patchwork)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  hrv_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(wear<span class="sc">$</span>hrv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  df_imp <span class="ot">&lt;-</span> wear <span class="sc">%&gt;%</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">hrv_original =</span> hrv,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">hrv_meanimp  =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(hrv), hrv_mean, hrv)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot A: Original HRV distribution</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  p_orig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_imp, <span class="fu">aes</span>(<span class="at">x =</span> hrv_original)) <span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"#1b9e77"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Original HRV Distribution"</span>,</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"HRV (ms)"</span>, <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot B: Mean-imputed HRV distribution</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  p_imp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_imp, <span class="fu">aes</span>(<span class="at">x =</span> hrv_meanimp)) <span class="sc">+</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"#7570b3"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Mean-Imputed HRV Distribution"</span>,</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"All missing values accumulate at one point"</span>,</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"HRV (ms)"</span>, <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine side by side</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>  p_orig <span class="sc">+</span> p_imp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 48 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The second pair of histograms demonstrates what happens when missing HRV values are filled in with a single constant — the sample mean. In the original distribution, HRV shows a wide, natural spread driven by true physiological variation between participants.</p>
<p>After mean imputation, however, all missing HRV values collapse to a single point. This produces a tall, unnatural spike in the histogram and compresses the variability of the variable. The imputed distribution no longer reflects real measurements but instead a mixture of genuine values and an artificial pile-up at the mean. This collapse reduces variance, distorts density, and weakens downstream correlations.</p>
<p>The figure highlights the core issue: single-value imputation does not reconstruct the missing information — it injects new artefacts into the data.</p>
<p>This is why more principled methods—such as likelihood-based approaches, fully conditional specification, and multiple imputation—have become standard in modern statistical practice. Before reaching those techniques, the next section illustrates how these naive methods affect regression modelling, showing that even a correctly specified linear model can yield biased coefficients when missing values are handled in simplistic ways.</p>
<p>## Missingness affect models</p>
<p>To understand how missing data affects real modelling tasks, we compare the behaviour of a simple linear regression under two conditions:</p>
<ol type="1">
<li>A complete dataset, where all variables are fully observed</li>
<li>An amputated dataset, where several variables contain missing values due to MCAR and MAR mechanisms</li>
</ol>
<p>The model of interest predicts the continuous physiological endpoint stress_score from three key predictors: frailty, HRV, and resting heart rate.</p>
<p>The two models are fitted as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Regression on complete dataset (true underlying coefficients)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    fit_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(stress_score <span class="sc">~</span> frailty <span class="sc">+</span> hrv <span class="sc">+</span> resting_hr, <span class="at">data =</span> wear_complete)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Regression on amputated dataset (listwise deletion)</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    fit_drop <span class="ot">&lt;-</span> <span class="fu">lm</span>(stress_score <span class="sc">~</span> frailty <span class="sc">+</span> hrv <span class="sc">+</span> resting_hr, <span class="at">data =</span> wear)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(fit_full)    <span class="co"># reference model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = stress_score ~ frailty + hrv + resting_hr, data = wear_complete)

Residuals:
     Min       1Q   Median       3Q      Max 
-24.1154  -4.4675  -0.0522   4.8940  24.8463 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 51.76130    3.79907  13.625  &lt; 2e-16 ***
frailty     11.06184    2.84225   3.892 0.000113 ***
hrv         -0.51474    0.02552 -20.170  &lt; 2e-16 ***
resting_hr   0.67950    0.04163  16.321  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.365 on 496 degrees of freedom
Multiple R-squared:  0.8731,    Adjusted R-squared:  0.8723 
F-statistic:  1138 on 3 and 496 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(fit_drop)    <span class="co"># biased estimates under missingness</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = stress_score ~ frailty + hrv + resting_hr, data = wear)

Residuals:
     Min       1Q   Median       3Q      Max 
-23.9040  -4.5572  -0.0739   4.7204  24.6786 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 50.27216    4.21299  11.933  &lt; 2e-16 ***
frailty      9.40451    3.18137   2.956  0.00329 ** 
hrv         -0.50889    0.02815 -18.078  &lt; 2e-16 ***
resting_hr   0.70808    0.04670  15.161  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.496 on 423 degrees of freedom
  (73 observations deleted due to missingness)
Multiple R-squared:  0.8665,    Adjusted R-squared:  0.8655 
F-statistic: 915.1 on 3 and 423 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The outputs below illustrate clearly how missingness distorts model estimation. We begin with the regression fitted on the wear_complete dataset, where all variables are fully observed. The estimated coefficients represent the true underlying relationships from the simulated system: the intercept is approximately 51.76, frailty has a strong positive effect of about 11.06 units on the stress score, HRV has a negative effect of roughly –0.515, and resting heart rate contributes positively with a coefficient of 0.679. These values align perfectly with the data-generating mechanism, in which frailty and resting HR increase physiological load while HRV reduces it. Because the regression formula matches the structure of the simulation, the model fits extremely well, with an R² around 0.87 and stable residual behaviour.</p>
<p>When we fit the same regression to the amputated dataset—using R’s default behaviour of listwise deletion—the picture changes. The estimated coefficients shift to (Intercept) ≈ 50.27, frailty ≈ 9.40, HRV ≈ –0.509, and resting HR ≈ 0.708. At first glance, the results might appear similar, but the changes are meaningful. R silently removes 73 observations from the dataset, reducing the sample size from 500 to 427. Crucially, these dropped observations are not a random slice of the population. HRV is missing disproportionately among older individuals, resting heart rate is missing more frequently among frail participants, and skin temperature tends to be missing when stress levels are high. Only the missingness in the activity index is MCAR, and this alone is not enough to preserve the overall population structure.</p>
<p>Because these missingness mechanisms are MAR rather than MCAR, listwise deletion effectively fits the regression on a reweighted subset of individuals—those who happen, by the rules of the simulation, to be younger, less frail, and under less physiological stress. As a result, the model systematically underestimates the effect of frailty: in the complete dataset, frailty has a coefficient of 11.06, but under listwise deletion it drops to 9.40. This downward bias arises because the frailest participants are precisely those most likely to have missing HR or HRV measurements, and therefore the sample used in the regression underrepresents the part of the distribution where the frailty–stress relationship is strongest. The other coefficients also shift, though less dramatically: HRV changes from –0.5147 to –0.5089, and resting HR moves from 0.6795 to 0.7081. These are smaller distortions but still reflect the same underlying issue—regression coefficients estimated from a non-random subset of the data no longer represent population-level effects.</p>
<p>Model fit deteriorates as well. The residual standard error increases from 7.36 to 7.50, the degrees of freedom fall from 496 to 423, and R² decreases slightly from 0.873 to 0.866. These changes arise from two sources: a loss of information due to discarding valid observations, and a distortion of the sample because the missingness mechanism selectively removes specific groups of individuals. Both consequences are typical of listwise deletion under MAR or MNAR conditions.</p>
<p>The broader lesson is that missing data can bias model estimates even when the model is correctly specified and even when the proportion of missingness is not very large. Listwise deletion wastes information, is only unbiased under the strong MCAR assumption, and often yields coefficients that differ from the truth in subtle or non-obvious ways. It alters the composition of the analytic sample and produces results that may no longer reflect the underlying population relationships. These issues motivate more principled approaches such as multiple imputation, Bayesian treatments of missingness, and model-based procedures such as EM or fully conditional specification. The comparison between the complete-data regression and the listwise-deletion regression shows that ignoring missing data is not a benign choice—it fundamentally alters the scientific conclusions.</p>
</section>
<section id="missing-mechanisms" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="missing-mechanisms"><span class="header-section-number">6.3</span> Missing mechanisms</h2>
<p>Once we have seen that naïve approaches distort even the simplest statistical quantities, we arrive at a more foundational question: why do observations go missing in the first place? This question is not a nuisance or a side issue; it is the core of the missing-data problem. From a statistical point of view, the process that generates missingness is itself a random variable. It has its own probability distribution, just like the physiological variables in the wearable dataset, and should be modelled accordingly. This viewpoint connects naturally with the Bayesian perspective discussed in the previous chapter: unobserved values are uncertain quantities, and the act of becoming missing is also governed by uncertainty that can, in principle, be described probabilistically.</p>
<p>Formally, we represent missingness with an indicator <span class="math inline">\(R_{\text {, }}\)</span> where <span class="math inline">\(R_i=1\)</span> if an observation is present and <span class="math inline">\(R_i=0\)</span> if it is missing. The full dataset consists of the observed values <span class="math inline">\(Y_{\text {obs }}\)</span>, the unobserved values <span class="math inline">\(Y_{\text {mis, }}\)</span> and the missingness indicators <span class="math inline">\(R\)</span>. Understanding the mechanism means describing the conditional distribution <span class="math inline">\(P\left(R \mid Y_{\text {obs }}, Y_{\text {mis }}, X\right)\)</span>, where <span class="math inline">\(X\)</span> may contain other covariates. Rubin’s framework distinguishes three broad types of mechanisms, which differ in how missingness relates to the data themselves and ultimately determine which analysis methods are valid.</p>
<p>The most restrictive mechanism is Missing Completely At Random (MCAR). Under MCAR, the probability of a value being missing does not depend on anything in the dataset-not on observed measurements, not on unobserved ones, and not on any auxiliary in <span class="math inline">\({ }^{\prime} \downarrow\)</span> nation. Mathematically this corresponds to <span class="math inline">\(P(R \mid Y_{\text {obs }}, Y_{\text {mis }, X}=P(R)\)</span>. Missingness is thus pure random noise. When MCAR holds, the observedsample is essentially a random subsample of the full dataset, which implies that complete-case analyses remain unbiased. In practice, MCAR is rare. In your simulated wearable dataset, the only MCAR process appears in the activity index, where a set of observations was removed by random selection without reference to any physiological variable. A diagnostic plot comparing frailty between observed and missing groups for activity index typically shows nearly identical distributions, which visually reinforces the MCAR assumption.</p>
<p>A more realistic mechanism for most real-world datasets is Missing At Random (MAR). Here, the probability of missingness may depend on observed quantities but not on the missing value itself. The formal expression is <span class="math inline">\(P\left(R \mid Y_{\text {obs }}, Y_{\text {mis }}, X\right)=P\left(R \mid Y_{\text {obs }}, X\right)\)</span>. The key idea is that once we condition on what we have already measured, the missingness process no longer depends on unobserved values. This is still an assumption, but it is often plausible. The wearable dataset provides natural examples. Heart-rate variability is missing more frequently among older participants; resting heart rate tends to be missing among frailer individuals; and skin temperature drops out more often when stress levels are high. In all of these cases, the missingness is related to variables that are themselves observed. Visualizing these relationships is straightforward: we can contrast the distribution of age across observed versus missing HRV, or the distribution of stress for observed versus missing skin temperature. The boxplots show clear separation between groups, indicating that missingness is systematically linked to measured covariates. This MAR structure is precisely what caused the bias in the earlier regression example: listwise deletion removed older, frailer, and highly stressed individuals at higher rates, producing a distorted analytic sample.</p>
<p>The most complex mechanism is Missing Not At Random (MNAR). Under MNAR, the probability of missingness depends on unobserved information, including the missing value itself. In formal terms, <span class="math inline">\(P\left(R \mid Y_{\text {obs }}, Y_{\text {mis }}, X\right)\)</span> cannot be simplified to depend only on <span class="math inline">\(Y_{\text {obs }}\)</span> and <span class="math inline">\(X\)</span>. This arises, for instance, if low HRV values fail to record because the device malfunctions specifically at low HRV, or if individuals with extremely high stress deliberately hide their sensor data. In such cases, neither complete-case analysis nor multiple imputation under MAR will fully correct the bias, because the source of missingness is tied directly to values we do not get to observe. Addressing MNAR typically requires explicit modelling of the missingness mechanism itself, using selection models, pattern-mixture models, or fully Bayesian joint models in which missingness is part of the likelihood.</p>
<p>These mechanisms matter because each one leads to different analytical consequences. Under MCAR, simply deleting incomplete rows yields unbiased estimates, although with reduced efficiency. Under MAR, deletion becomes biased, but likelihood-based methods and multiple imputation remain valid because the missingness can be explained by variables already present in the dataset. Under MNAR, neither deletion nor standard imputation methods are reliable, since the missingness process depends on information we never observe. The wearable simulation, by including MCAR and MAR mechanisms but avoiding MNAR, provides an ideal environment for demonstrating both the failure of naïve methods and the success of principled approaches such as multiple imputation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>    <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Diagnostics for Missing Data Mechanisms</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Applied to the DCT wearable dataset</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#install.packages("naniar")</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(tidyverse)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(naniar)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reload datasets (in case this chunk runs independently)</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#wear &lt;- readRDS("~/att_ai_ml/att_book/data/dct_wearable_amputated.rds")</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#wear_complete &lt;- readRDS("~/att_ai_ml/att_book/data/dct_wearable_complete.rds")</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 2. MCAR example: Activity Index missing completely at random</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    wear <span class="sc">%&gt;%</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">miss_act =</span> <span class="fu">is.na</span>(activity_index)) <span class="sc">%&gt;%</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> miss_act, <span class="at">y =</span> frailty)) <span class="sc">+</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"#66c2a5"</span>) <span class="sc">+</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Activity Index Missingness vs Frailty"</span>,</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Distributions are similar → consistent with MCAR"</span>,</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Activity Index Missing?"</span>,</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Frailty"</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## MCAR Probability Curve (Activity Index)</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Missingness does NOT depend on frailty</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Build dataset: frailty + missingness indicator</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  df_mcar <span class="ot">&lt;-</span> wear <span class="sc">%&gt;%</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">miss_act =</span> <span class="fu">is.na</span>(activity_index)) <span class="sc">%&gt;%</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># group frailty for smoothing</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">frailty_bin =</span> <span class="fu">cut</span>(frailty, <span class="at">breaks =</span> <span class="dv">30</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(frailty_bin) <span class="sc">%&gt;%</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">frailty_mid =</span> <span class="fu">mean</span>(frailty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_miss =</span> <span class="fu">mean</span>(miss_act)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>()</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot probability curve</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_mcar, <span class="fu">aes</span>(<span class="at">x =</span> frailty_mid, <span class="at">y =</span> p_miss)) <span class="sc">+</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#66c2a5"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Probability of Activity Index Missingness"</span>,</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Flat pattern → consistent with MCAR"</span>,</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Frailty"</span>,</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Pr(Missing)"</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The code above performs an exploratory diagnostic aimed at assessing whether the activity index follows a Missing Completely At Random (MCAR) mechanism. The logic is simple: we construct an indicator marking whether the activity index is missing and then compare the distribution of frailty between the missing and observed groups using a boxplot. If missingness truly behaves like random noise, these two distributions should look similar.</p>
<p>In this example, the resulting figure shows that the frailty distributions overlap almost perfectly. The medians align, the interquartile ranges are comparable, and there is no systematic shift that would suggest frailty influences the probability of missing activity data. This pattern is compatible with an MCAR process, where the missingness is independent of participant characteristics.</p>
<p>It is important, however, to emphasize that such a visual comparison is only exploratory. Boxplots offer a convenient summary, but they are not a formal test of the missingness mechanism. Even if the distributions appear similar, this does not prove MCAR; it merely suggests an absence of obvious violations. If stronger evidence were required, we could complement the visual inspection with statistical comparisons—such as a t-test, a Wilcoxon rank-sum test, or a logistic regression predicting missingness from frailty—but even these tests cannot definitively confirm MCAR. Missingness mechanisms refer to underlying population processes, and no finite sample can conclusively validate the assumption.</p>
<p>In this simulated dataset, the similarity between groups is expected, since the activity index was deliberately designed to drop out at random. Real-world data seldom display such clean patterns. The example therefore provides a helpful baseline for what MCAR might look like in practice while also illustrating why genuine MCAR mechanisms are rare and why conclusions should be drawn cautiously.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>    <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 3. MAR example: HRV missing more often at older ages</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    wear <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">miss_hrv =</span> <span class="fu">is.na</span>(hrv)) <span class="sc">%&gt;%</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> miss_hrv, <span class="at">y =</span> age)) <span class="sc">+</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"#fc8d62"</span>) <span class="sc">+</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"HRV Missingness vs Age"</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Older participants have more missing HRV → MAR"</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"HRV Missing?"</span>,</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Age"</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## MAR Probability Curve (HRV Missingness vs Age)</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Missingness increases with age → MAR</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  df_mar <span class="ot">&lt;-</span> wear <span class="sc">%&gt;%</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">miss_hrv =</span> <span class="fu">is.na</span>(hrv)) <span class="sc">%&gt;%</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># group Age for smoothing</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_bin =</span> <span class="fu">cut</span>(age, <span class="at">breaks =</span> <span class="dv">30</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(age_bin) <span class="sc">%&gt;%</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">age_mid =</span> <span class="fu">mean</span>(age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_miss =</span> <span class="fu">mean</span>(miss_hrv)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>()</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot MAR curve</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_mar, <span class="fu">aes</span>(<span class="at">x =</span> age_mid, <span class="at">y =</span> p_miss)) <span class="sc">+</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#fc8d62"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Probability of HRV Missingness"</span>,</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Increasing probability with age → MAR"</span>,</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Pr(Missing)"</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The code above performs an exploratory diagnostic aimed at understanding whether the missingness of HRV depends on participant age. We construct an indicator variable marking whether each HRV value is missing and compare the age distribution between the missing and observed groups using a boxplot. The resulting figure shows a substantial and systematic difference: participants with missing HRV measurements are noticeably older, with both the median and the interquartile range shifted upward compared with those whose HRV is observed. This pattern is consistent with a Missing At Random (MAR) mechanism because the probability that HRV is missing appears to depend on another observed variable—age. Under MAR, missingness is not purely random but is explainable using information already present in the dataset.</p>
<p>As before, the boxplot provides an informative visualisation but should be treated as exploratory rather than definitive. A formal comparison could be carried out using statistical tests, such as a two-sample t-test, a Wilcoxon rank-sum test, or a logistic regression of the missingness indicator on age. These tests would quantify the difference more formally, although their interpretation must still be informed by domain knowledge about device behaviour and participant characteristics. The simulated dataset was explicitly designed so that HRV becomes more likely to be missing in older individuals, which is why the MAR pattern appears so cleanly here. In real-world wearable datasets, the structure is often more subtle, but this example illustrates clearly what a MAR signal looks like and why MAR mechanisms are far more common than true MCAR.</p>
<p>The next diagnostic examines missing values in resting heart rate. As before, we create a logical indicator marking whether the measurement is missing and then compare the distribution of frailty across missing and non-missing groups using a boxplot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>    <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 4. MAR example: Resting HR missing at high frailty</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    wear <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">miss_rhr =</span> <span class="fu">is.na</span>(resting_hr)) <span class="sc">%&gt;%</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> miss_rhr, <span class="at">y =</span> frailty)) <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"#8da0cb"</span>) <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Resting HR Missingness vs Frailty"</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Missingness increases with frailty → MAR"</span>,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Resting HR Missing?"</span>,</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Frailty"</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The resulting figure makes the pattern immediately apparent: participants with missing resting heart rate tend to have higher frailty scores. The median frailty in the missing group is clearly elevated, and the interquartile ranges do not overlap with those of the observed group. This signals that frailty influences the probability that resting HR is recorded. In other words, the missingness mechanism depends on an observed variable and is therefore consistent with Missing At Random (MAR).</p>
<p>Just as in the previous examples, it is important to emphasise that the plot is not a formal test. Boxplots are descriptive tools: they reveal structure, highlight contrasts, and often alert us to important dependencies. But they cannot on their own confirm a statistical mechanism. A more rigorous assessment might involve modelling the missingness indicator as an outcome in a logistic regression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(<span class="fu">is.na</span>(resting_hr) <span class="sc">~</span> frailty, <span class="at">data =</span> wear, <span class="at">family =</span> binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = is.na(resting_hr) ~ frailty, family = binomial, 
    data = wear)

Coefficients:
(Intercept)      frailty  
     -9.913       14.556  

Degrees of Freedom: 499 Total (i.e. Null);  498 Residual
Null Deviance:      227 
Residual Deviance: 157.1    AIC: 161.1</code></pre>
</div>
</div>
<p>The logistic regression output provides a simple numerical confirmation of what we saw visually in the boxplot. When we regress the missingness indicator for resting heart rate on frailty, the estimated slope is strongly positive (≈ 14.56) and highly significant relative to the null model. In practical terms, this means that as frailty increases, the log-odds of having a missing resting HR value increase sharply. The intercept is strongly negative (≈ –9.91), indicating that missingness is extremely unlikely among participants with very low frailty, but rises rapidly as frailty grows.</p>
<p>The reduction in deviance (from 227 to 157) shows that frailty explains a substantial proportion of the variation in missingness, which is reflected in the large drop in AIC as well. While this simple model does not prove the exact missing-data mechanism — no statistical test can definitively distinguish MAR from MNAR — it does provide quantitative evidence that missingness is systematically related to an observed variable. This pattern is characteristic of a Missing At Random (MAR) process, consistent with how the dataset was simulated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5. MAR example: Skin temperature missing at high stress</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  wear <span class="sc">%&gt;%</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">miss_temp =</span> <span class="fu">is.na</span>(skin_temp)) <span class="sc">%&gt;%</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> miss_temp, <span class="at">y =</span> stress_score)) <span class="sc">+</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"#e78ac3"</span>) <span class="sc">+</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Skin Temperature Missingness vs Stress Score"</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Missingness increases at high stress → MAR"</span>,</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Skin Temperature Missing?"</span>,</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Stress Score"</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="ilustrating-mnar-mechanism" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="ilustrating-mnar-mechanism"><span class="header-section-number">6.3.1</span> Ilustrating MNAR mechanism</h3>
<p>To illustrate a true MNAR mechanism in a controlled way, we introduce a synthetic variable called hydration_level. This variable is not used in the modelling of the stress score and serves purely didactic purposes. We then impose a missingness mechanism that depends directly on the unobserved values themselves: lower hydration levels are assigned a higher probability of being missing. Because missingness is a function of the value that is missing, this produces a textbook case of MNAR. No combination of the other variables (frailty, age, HRV, resting HR, etc.) can explain the pattern; the missingness is inherently tied to the variable being partially unobserved. This behaviour is rarely identifiable in real datasets and cannot be reliably corrected without modelling assumptions. The example is included to help students visualise an MNAR pattern and understand why principled statistical methods struggle in this setting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## NEW MNAR VARIABLE FOR DIDACTIC PURPOSES</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## hydration_level: fictitious physiological marker</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## MNAR mechanism: low hydration → higher probability of missingness</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">2027</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create variable in complete dataset (no missing)</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  wear_complete<span class="sc">$</span>hydration_level <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(wear_complete),</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="dv">50</span>,</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="dv">10</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Copy to amputated dataset</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  wear<span class="sc">$</span>hydration_level <span class="ot">&lt;-</span> wear_complete<span class="sc">$</span>hydration_level</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># MNAR mechanism:</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lower hydration → higher Pr(missing)</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>  p_miss <span class="ot">&lt;-</span> <span class="fu">plogis</span>(<span class="sc">-</span>(wear<span class="sc">$</span>hydration_level <span class="sc">-</span> <span class="dv">40</span>) <span class="sc">/</span> <span class="dv">5</span>)</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply MNAR dropout</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">2028</span>)</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>  wear<span class="sc">$</span>hydration_level[<span class="fu">runif</span>(<span class="fu">nrow</span>(wear)) <span class="sc">&lt;</span> p_miss] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Construct helper dataset for plotting</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>  df_hyd <span class="ot">&lt;-</span> wear <span class="sc">%&gt;%</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">miss_hydration =</span> <span class="fu">is.na</span>(hydration_level),</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_miss =</span> p_miss</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>  df_hyd <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> miss_hydration, <span class="at">y =</span> hydration_level)) <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"#8dd3c7"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Hydration Missingness vs Hydration Level"</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Missingness increases at low hydration → MNAR"</span>,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Hydration Missing?"</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Hydration Level"</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>  df_hyd <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hydration_level, <span class="at">y =</span> p_miss)) <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#1b9e77"</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Probability of Hydration Missingness"</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Lower hydration levels have higher Pr(missing) → MNAR"</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Hydration Level"</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Pr(Missing)"</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The hydration variable was introduced solely for didactic purposes to demonstrate a Missing Not at Random (MNAR) mechanism, where the probability of missingness depends directly on the unobserved value itself. In this synthetic example, lower hydration levels have a higher probability of being missing.</p>
<p>The first figure compares hydration values between observed and missing groups: the missing group shows substantially lower values, a pattern incompatible with MCAR or MAR.</p>
<p>The second figure depicts the actual missingness probability encoded in the simulation. The curve shows a monotonic decline: as hydration decreases, Pr(missing) increases. This explicit dependency on the variable’s own value is the defining feature of MNAR and highlights why MNAR cannot be diagnosed from the observed data alone — here we know the mechanism only because we constructed it in simulation.</p>
<p>Its usuall also to prsent the missing proportions for each variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 6. Missingness proportions (simple but extremely useful)</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## -----------------------------------------------------------</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  missing_prop <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">colMeans</span>(<span class="fu">is.na</span>(wear)), <span class="dv">3</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  missing_prop<span class="sc">*</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  age baseline_inflammation               frailty 
                  0.0                   0.0                   0.0 
           resting_hr                   hrv             skin_temp 
                  6.0                   9.6                   6.2 
       activity_index          stress_score            event_risk 
                  9.0                   0.0                   0.0 
       event_occurred       hydration_level 
                  0.0                  20.2 </code></pre>
</div>
</div>
</section>
</section>
<section id="how-to-deal-with-missingness-rates" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="how-to-deal-with-missingness-rates"><span class="header-section-number">6.4</span> How to deal with missingness rates?</h2>
<p>Once missing data mechanisms are understood, the next practical question is how to handle the quantity of missingness in each variable. The proportion of missing values — the missingness rate — strongly influences whether imputation is advisable, whether a variable should be excluded from modelling, or whether specialised methods (such as multiple imputation or Bayesian models) are needed.</p>
<p>A low missingness rate does not automatically imply that missingness is harmless; in the previous examples, even modest MAR patterns produced measurable bias. Still, the missingness rate often guides decisions in applied data analysis, and it is helpful to understand how different levels of missingness tend to affect model performance and inference.</p>
<p>At very low missingness levels, typically below five percent, imputation rarely introduces substantial artefacts. In such settings, imputing values using principled methods such as predictive mean matching generally stabilises the analysis and avoids the small but systematic distortions introduced by listwise deletion. Most modern statistical workflows treat this range as safe for imputation, particularly when missingness follows MCAR or MAR patterns.</p>
<p>Between five and twenty percent missingness, imputation becomes more clearly necessary. At this level, removing incomplete cases would disproportionately reduce the effective sample size and amplify bias under non-MCAR mechanisms. Multiple imputation is well suited to this regime, as it preserves sample size, propagates uncertainty, and stabilises regression estimates. The examples in this chapter illustrate how deleting only fifteen percent of rows can already shift regression coefficients in non-trivial ways.</p>
<p>When missingness approaches thirty percent or more, decisions become more delicate. High missingness does not automatically disqualify a variable; some variables are scientifically indispensable and must be retained despite large gaps. However, high missingness increases uncertainty, inflates variance in imputed values, and requires a careful assessment of the imputation model. In this regime, imputation is still possible but demands more attention to diagnostics, model compatibility, and convergence of iterative imputation algorithms.</p>
<p>Beyond fifty percent missingness, analysts face a decision that is as much scientific as it is statistical. A variable with more missing data than observed data carries limited direct information about its distribution, and imputation necessarily relies heavily on assumptions and auxiliary variables. If scientific justification is strong — for example, if a key biomarker is missing in half the participants because a device failed during the second half of a trial — the variable may still be retained and imputed. If the variable is weakly related to the outcome or has many weakly correlated predictors, excluding it entirely may lead to more stable models. Importantly, extremely high missingness often indicates structural problems in data collection rather than random loss of information.</p>
<p>There is no universal threshold that determines whether to impute or discard a variable. Instead, the choice depends on a combination of missingness rate, scientific relevance, and the quality of information available for predicting the missing values. Nonetheless, in many applied fields, rough conventions have emerged. Variables with less than twenty percent missingness are typically imputed without hesitation. Variables between twenty and forty percent missingness are imputed if they are scientifically meaningful and sufficiently predictable from the remaining data. Variables above fifty percent missingness require strong justification for inclusion, as imputations will carry substantial uncertainty and may be sensitive to the specification of the imputation model.</p>
<p>Another important point is that missing data themselves can be viewed as random variables, governed by their own probability distribution defined by the missingness mechanism. This aligns naturally with the Bayesian perspective introduced earlier: the missing values and the process that generated them both have uncertainty that must be accounted for. Methods such as multiple imputation, fully conditional specification, and Bayesian joint modelling all treat missing values not as fixed artefacts to be replaced but as unobserved random quantities. In this sense, higher missingness rates do not simply influence whether we impute but also how much uncertainty must be propagated forward after imputation.</p>
<p>In practice, deciding how to handle missingness is a balance between statistical validity and scientific context. Understanding both the mechanism and the magnitude of missingness helps determine when imputation is safe, when it is necessary, and when it may not be justified at all.</p>
<p>## Multiple Imputation: Theory and Intuition Missing data creates uncertainty. Multiple imputation (MI) is a principled way of representing and propagating that uncertainty through the entire analysis pipeline. Instead of filling each missing value with a single “best guess,” MI replaces every missing entry with several plausible values, each drawn from a statistical model that reflects the relationships observed in the data.</p>
<p>At its core, MI treats missing values as random variables with probability distributions. This idea connects naturally with the Bayesian view introduced earlier: if the observed data arise from some joint distribution, then the missing components have a conditional distribution given the observed ones, and this distribution can be sampled.</p>
<p>The classical description of MI comes from Rubin’s framework, which rests on three conceptual steps:</p>
<ol type="1">
<li>Imputation step (create M completed datasets)</li>
</ol>
<p>We replace each missing value <span class="math inline">\(M\)</span> times using draws from an imputation model. For example, if HRV is correlated with age, frailty, and resting heart rate, those predictors are used to generate plausible HRV values.</p>
<p>This yields datasets:</p>
<p><span class="math display">\[
  \left\{D^{(1)}, D^{(2)}, \ldots, D^{(M)}\right\}
  \]</span></p>
<p>Each dataset reflects different possible realisations of the unobserved values. 2. Analysis step (fit the model on each dataset)</p>
<p>We analyse each completed dataset separately using the intended modelling procedure-for example, by fitting a linear regression:</p>
<p><span class="math display">\[
  \hat{\beta}^{(m)}=f\left(D^{(m)}\right), \quad m=1, \ldots, M
  \]</span></p>
<p>Each run yields slightly different estimates because the imputations differ. 3. Pooling step (combine estimates across datasets)</p>
<p>Rubin’s rules combine the estimates and their variances across the M analyses: - The average coefficient is the MI estimate. - The total variance incorporates both within-imputation variance and between-imputation variance, ensuring uncertainty from missingness is fully represented.</p>
<p>This yields final results that: - preserve correct uncertainty, - retain the full sample size, - avoid artificial distortion of correlations, - are valid under MAR and MCAR mechanisms.</p>
<p>Multiple imputation is not “filling the dataset.” It is a full inferential framework that recognises that missing values are uncertain and that this uncertainty must flow into the final estimates.</p>
<p>Why Multiple Imputation Works The key insight is that MI produces valid inferences because it reconstructs the joint distribution of the data as if no observations were missing. Each imputed dataset is one plausible completion of the data. No single imputed value is trusted, but across many datasets, the variation among them reflects the uncertainty induced by missingness.</p>
<p>Compared with listwise deletion: - MI reduces bias under MAR, - improves power by using the full sample - stabilises regression estimates, - and preserves covariance structure.</p>
<p>Compared with single-value imputation (mean/median): - Ml restores variance, - avoids collapsing distributions, - produces correlations and regression slopes consistent with the full data, - and appropriately widens confidence intervals.</p>
<p>Across modern statistics, MI is now considered the standard approach for handling missing data under MCAR/MAR.</p>
<p>## Imputing data with MICE R package</p>
<p>To illustrate how multiple imputation operates in real analyses, we now apply the method to the amputated wearable dataset using the mice package. The goal is to fit the regression model for stress_score while recovering the information lost through missingness and avoiding the biases demonstrated earlier. Each block of code below is followed by a narrative explanation of what it does and how to interpret its output.</p>
<p>The first step is to load the required packages: When mice is attached, R prints a message indicating that some base functions (cbind, rbind, filter) are masked. This is normal and simply reflects that mice defines its own versions for internal use. The tidyverse package is also loaded for convenience in data manipulation and plotting.</p>
<p>We then initiate the imputation with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(mice)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'mice'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    cbind, rbind</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We will impute the amputated dataset</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> wear,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">m =</span> <span class="dv">5</span>,                     <span class="co"># number of imputed datasets</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"pmm"</span>,            <span class="co"># predictive mean matching</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxit =</span> <span class="dv">10</span>,                <span class="co"># number of iterations</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">2025</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 iter imp variable
  1   1  resting_hr  hrv  skin_temp  activity_index  hydration_level
  1   2  resting_hr  hrv  skin_temp  activity_index  hydration_level
  1   3  resting_hr  hrv  skin_temp  activity_index  hydration_level
  1   4  resting_hr  hrv  skin_temp  activity_index  hydration_level
  1   5  resting_hr  hrv  skin_temp  activity_index  hydration_level
  2   1  resting_hr  hrv  skin_temp  activity_index  hydration_level
  2   2  resting_hr  hrv  skin_temp  activity_index  hydration_level
  2   3  resting_hr  hrv  skin_temp  activity_index  hydration_level
  2   4  resting_hr  hrv  skin_temp  activity_index  hydration_level
  2   5  resting_hr  hrv  skin_temp  activity_index  hydration_level
  3   1  resting_hr  hrv  skin_temp  activity_index  hydration_level
  3   2  resting_hr  hrv  skin_temp  activity_index  hydration_level
  3   3  resting_hr  hrv  skin_temp  activity_index  hydration_level
  3   4  resting_hr  hrv  skin_temp  activity_index  hydration_level
  3   5  resting_hr  hrv  skin_temp  activity_index  hydration_level
  4   1  resting_hr  hrv  skin_temp  activity_index  hydration_level
  4   2  resting_hr  hrv  skin_temp  activity_index  hydration_level
  4   3  resting_hr  hrv  skin_temp  activity_index  hydration_level
  4   4  resting_hr  hrv  skin_temp  activity_index  hydration_level
  4   5  resting_hr  hrv  skin_temp  activity_index  hydration_level
  5   1  resting_hr  hrv  skin_temp  activity_index  hydration_level
  5   2  resting_hr  hrv  skin_temp  activity_index  hydration_level
  5   3  resting_hr  hrv  skin_temp  activity_index  hydration_level
  5   4  resting_hr  hrv  skin_temp  activity_index  hydration_level
  5   5  resting_hr  hrv  skin_temp  activity_index  hydration_level
  6   1  resting_hr  hrv  skin_temp  activity_index  hydration_level
  6   2  resting_hr  hrv  skin_temp  activity_index  hydration_level
  6   3  resting_hr  hrv  skin_temp  activity_index  hydration_level
  6   4  resting_hr  hrv  skin_temp  activity_index  hydration_level
  6   5  resting_hr  hrv  skin_temp  activity_index  hydration_level
  7   1  resting_hr  hrv  skin_temp  activity_index  hydration_level
  7   2  resting_hr  hrv  skin_temp  activity_index  hydration_level
  7   3  resting_hr  hrv  skin_temp  activity_index  hydration_level
  7   4  resting_hr  hrv  skin_temp  activity_index  hydration_level
  7   5  resting_hr  hrv  skin_temp  activity_index  hydration_level
  8   1  resting_hr  hrv  skin_temp  activity_index  hydration_level
  8   2  resting_hr  hrv  skin_temp  activity_index  hydration_level
  8   3  resting_hr  hrv  skin_temp  activity_index  hydration_level
  8   4  resting_hr  hrv  skin_temp  activity_index  hydration_level
  8   5  resting_hr  hrv  skin_temp  activity_index  hydration_level
  9   1  resting_hr  hrv  skin_temp  activity_index  hydration_level
  9   2  resting_hr  hrv  skin_temp  activity_index  hydration_level
  9   3  resting_hr  hrv  skin_temp  activity_index  hydration_level
  9   4  resting_hr  hrv  skin_temp  activity_index  hydration_level
  9   5  resting_hr  hrv  skin_temp  activity_index  hydration_level
  10   1  resting_hr  hrv  skin_temp  activity_index  hydration_level
  10   2  resting_hr  hrv  skin_temp  activity_index  hydration_level
  10   3  resting_hr  hrv  skin_temp  activity_index  hydration_level
  10   4  resting_hr  hrv  skin_temp  activity_index  hydration_level
  10   5  resting_hr  hrv  skin_temp  activity_index  hydration_level</code></pre>
</div>
</div>
<p>Once executed, R prints the familiar imputations log. Each row corresponds to an iteration of the chained equations algorithm, and each column indicates which variable is being imputed. The output lists the five parallel imputed datasets (imp = 1 through imp = 5) being updated at each iteration. Seeing the same sequence of variables repeated in each iteration confirms that the chained equations are cycling through all incomplete variables: resting_hr, hrv, skin_temp, activity_index, and hydration_level. Convergence is usually judged informally by the stability of the traces, which we inspect next.</p>
<p>A first visual diagnostic is produced by:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The resulting plot displays the iteration history for each variable’s imputed values. For predictive mean matching, we expect the traces to oscillate around stable ranges rather than drift systematically. In this dataset, the lines settle quickly, suggesting that the algorithm has reached an acceptable equilibrium and that ten iterations are sufficient.</p>
<p>A more granular view is obtained from the stripplot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stripplot</span>(imp, hrv <span class="sc">~</span> .imp, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plot displays the distribution of hrv across the five imputed datasets (.imp = 1…5). The observed values appear as black points, while imputed values appear in coloured panels associated with each completed dataset. Ideally, the imputed values blend naturally into the observed distribution rather than forming implausible clusters. In our case, the imputed hrv values follow the same general range and variability as the observed measurements, indicating that the imputation model is compatible with the data.</p>
<p>We gain further insight from the density plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">densityplot</span>(imp, <span class="sc">~</span> hrv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_missing_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This shows the kernel density curves for both observed and imputed hrv. Predictive mean matching ensures that imputed values are sampled from the neighbourhood of observed ones, and consequently the curves should largely overlap. The diagnostic confirms this: the imputed densities track the observed ones closely, avoiding the artificial spikes or flattened tails that plagued single-value imputation earlier. This is precisely the behaviour that preserves the statistical structure of the data.</p>
<p>With imputation diagnostics completed, we proceed to fit the regression model across all imputed datasets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>  fit_imp <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    imp,</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(stress_score <span class="sc">~</span> frailty <span class="sc">+</span> hrv <span class="sc">+</span> resting_hr)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The command fits the same linear model to each of the five completed datasets. The result is not yet a single pooled model but rather a list of regression fits, one per imputation. To obtain inference that accounts for both within-imputation and between-imputation variability, we pool the estimates using Rubin’s rules:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>  pooled <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit_imp)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(pooled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         term   estimate  std.error  statistic       df      p.value
1 (Intercept) 50.3163707 3.93329986  12.792406 480.0654 1.896494e-32
2     frailty 11.3010872 2.92625091   3.861968 467.4432 1.283310e-04
3         hrv -0.5044780 0.02675060 -18.858565 421.5302 5.748153e-58
4  resting_hr  0.6914724 0.04293115  16.106542 490.5909 3.676140e-47</code></pre>
</div>
</div>
<p>The summary() output displays the combined regression coefficients. For the intercept and three predictors, the pooled estimates are:</p>
<p>Intercept ≈ 50.32</p>
<p>Frailty ≈ 11.30</p>
<p>HRV ≈ –0.504</p>
<p>Resting HR ≈ 0.691</p>
<p>These values are strikingly close to the true coefficients from the complete dataset analysis. In particular, the frailty slope — which listwise deletion biased downwards to about 9.40 — returns to approximately 11.30, almost exactly the complete-data truth (11.06). Standard errors, test statistics, degrees of freedom, and p-values are also provided. Crucially, the degrees of freedom differ from a standard linear model, reflecting the added uncertainty due to imputing missing values across multiple datasets.</p>
<p>To summarise and compare the three strategies — complete data, listwise deletion, and multiple imputation — we collect them into a single tibble:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(broom)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  coef_full <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit_full)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  coef_drop <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit_drop)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  coef_mi   <span class="ot">&lt;-</span> <span class="fu">summary</span>(pooled)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Complete data"</span>, <span class="st">"Listwise deletion"</span>, <span class="st">"Multiple imputation"</span>),</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Frailty =</span> <span class="fu">c</span>(coef_full<span class="sc">$</span>estimate[<span class="dv">2</span>], coef_drop<span class="sc">$</span>estimate[<span class="dv">2</span>], coef_mi<span class="sc">$</span>estimate[<span class="dv">2</span>]),</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">HRV     =</span> <span class="fu">c</span>(coef_full<span class="sc">$</span>estimate[<span class="dv">3</span>], coef_drop<span class="sc">$</span>estimate[<span class="dv">3</span>], coef_mi<span class="sc">$</span>estimate[<span class="dv">3</span>]),</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">RestingHR =</span> <span class="fu">c</span>(coef_full<span class="sc">$</span>estimate[<span class="dv">4</span>], coef_drop<span class="sc">$</span>estimate[<span class="dv">4</span>], coef_mi<span class="sc">$</span>estimate[<span class="dv">4</span>])</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Model               Frailty    HRV RestingHR
  &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
1 Complete data         11.1  -0.515     0.680
2 Listwise deletion      9.40 -0.509     0.708
3 Multiple imputation   11.3  -0.504     0.691</code></pre>
</div>
</div>
<p>The resulting table makes the contrast explicit. Listwise deletion clearly underestimates the effect of frailty and slightly distorts the effects of HRV and resting heart rate. Multiple imputation, by contrast, recovers estimates almost indistinguishable from those obtained from the complete dataset. This is the core advantage of the method: it restores the statistical information that would otherwise be lost or distorted by naive approaches, while appropriately propagating uncertainty due to missingness.</p>
</section>
<section id="other-imputation-methods-available-in-mice" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="other-imputation-methods-available-in-mice"><span class="header-section-number">6.5</span> Other Imputation Methods Available in mice</h2>
<p>Predictive mean matching is a robust default and works well for continuous physiological variables such as HRV, resting heart rate, or skin temperature. However, mice includes a broad family of imputation engines that can be matched to different data types, modelling goals, or complexity levels. Understanding these alternatives provides flexibility when designing imputation workflows, especially in larger clinical or biological datasets where variables have mixed scales, nonlinear behaviour, or structural constraints.</p>
<p>At its core, mice uses Fully Conditional Specification (FCS): each variable with missing values is imputed from a regression model conditional on the other variables. The “method” argument in mice() controls the regression model used for each variable. The choice of method should reflect both the scale of the variable and the assumptions underlying the analysis.</p>
<p>Linear regression for continuous data (“norm”)</p>
<p>The simplest imputation model is ordinary least squares regression. The “norm” method draws imputed values from a normal distribution centered at the fitted mean with added residual noise. Although straightforward, it assumes linearity, homoscedasticity, and normally distributed residuals—conditions that may not hold for skewed biomarkers or device-derived digital features.</p>
<p>This approach is most appropriate when variables follow approximately Gaussian distributions and the primary aim is inferential modelling rather than distributional reconstruction.</p>
<p>Bayesian linear regression (“norm.nob” and “norm.post”)</p>
<p>Two Bayesian variants extend the linear model:</p>
<p>“norm.nob” (no Bayesian step) imputes deterministically from the regression fit.</p>
<p>“norm.post” adds uncertainty by drawing regression coefficients from their posterior distribution, producing more realistic imputations.</p>
<p>These are useful when the analyst wants to propagate model uncertainty formally, especially in low-sample settings or when residual variance is substantial.</p>
<p>Logistic and multinomial regression (“logreg” and “polyreg”)</p>
<p>Binary variables (e.g., event occurrence, device dropout logged as yes/no) can be imputed via logistic regression using “logreg”. Categorical variables with more than two levels use “polyreg”, which fits a multinomial logit model. These methods are natural choices for survey indicators, categorical clinical classifications, and device metadata.</p>
<p>Predictive mean matching should not be used for categorical variables, so logistic/multinomial models become essential for mixed datasets.</p>
<p>Proportional odds models for ordered categories (“polr”)</p>
<p>Ordinal scales—frailty categories, symptom severity scores, Likert responses, or manually adjudicated clinical ratings—benefit from an ordered logit/probit approach. “polr” preserves the ordinal structure, meaning that imputations respect category order rather than treating the variable as simply numeric or unordered.</p>
<p>Random forest imputation (“rf”)</p>
<p>The “rf” method uses Breiman’s random forests to learn complex nonlinear relationships and interactions. This model is particularly useful when:</p>
<p>variables have nonlinear associations,</p>
<p>predictors include many weak signals (e.g., gene expression or sensor-derived features),</p>
<p>there are complicated dependencies that linear models miss.</p>
<p>Random forest imputation is flexible and robust but computationally more expensive. It also produces less transparent models, which is important to consider when interpretability matters.</p>
<p>Two-stage imputation for bounded continuous data (“norm.predict”, “cart”, “2l.norm”)</p>
<p>Digital biomarkers and physiological outputs are often bounded (e.g., percentages, temperatures, accelerometry intensities). Standard linear regression can predict values outside the plausible range. Alternatives include:</p>
<p>“cart”: classification and regression trees, which naturally enforce realistic bounds through partitioning rules.</p>
<p>“norm.predict”: deterministic prediction without added noise, useful for sensitivity analyses.</p>
<p>“2l.norm”: linear mixed-effects models suitable for clustered or longitudinal data.</p>
<p>These are attractive in decentralised clinical trial datasets where repeated measurements per participant introduce hierarchical structure.</p>
<p>Passive imputation and derived variables (“~” and “-”)</p>
<p>When derived quantities depend deterministically on other variables—for example, BMI from height and weight—it is advisable to avoid imputing them separately. Instead, mice allows passive imputation, in which a formula is specified and the variable is recalculated at each iteration rather than modelled:</p>
<p><code>method["BMI"] &lt;- "~ I(weight / (height/100)^2)"</code></p>
<p>This ensures consistency across imputations and prevents biologically impossible combinations.</p>
<section id="choosing-an-imputation-method-practical-guidance" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="choosing-an-imputation-method-practical-guidance"><span class="header-section-number">6.5.1</span> Choosing an Imputation Method: Practical Guidance</h3>
<p>In most applied workflows, predictive mean matching (“pmm”) remains an excellent general-purpose choice for continuous variables. It preserves the distribution and resists outliers or model misspecification. Logistic/multinomial models are the default for categorical variables, and “polr” is ideal for ordinal ones.</p>
<p>Random forest imputation is useful when modelling highly nonlinear relationships but should be applied thoughtfully, as it may interfere with downstream model interpretability or introduce difficulties when pooling estimates.</p>
<p>Finally, when working with longitudinal or multilevel data, two-level imputation models provide a principled way to incorporate within-participant correlation, which is especially relevant in wearable-sensor studies.</p>
<p>Selecting an imputation strategy is not merely a technical choice; it reflects assumptions about the data-generating process and the degree of structure one expects in the relationships between variables. The mice framework provides enough flexibility to tailor imputation to variable type, scientific context, and analytical goals while maintaining the core principle of properly propagating uncertainty.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/danilosarti\.github\.io\/att_ml_ai_book");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./introd_bayesian.html" class="pagination-link" aria-label="Introduction to Bayesian methods">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Bayesian methods</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./high_dims.html" class="pagination-link" aria-label="High Dimension Data Strategies">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">High Dimension Data Strategies</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>